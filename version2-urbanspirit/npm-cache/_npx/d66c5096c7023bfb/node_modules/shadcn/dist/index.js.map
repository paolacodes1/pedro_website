{"version":3,"sources":["../src/commands/add.ts","../src/commands/init.ts","../src/preflights/preflight-init.ts","../src/utils/errors.ts","../src/utils/add-components.ts","../src/utils/is-safe-target.ts","../src/utils/updaters/update-css.ts","../src/utils/updaters/update-css-vars.ts","../src/utils/get-package-manager.ts","../src/utils/updaters/update-dependencies.ts","../src/utils/updaters/update-env-vars.ts","../src/utils/env-helpers.ts","../src/utils/updaters/update-files.ts","../src/utils/transformers/index.ts","../src/utils/transformers/transform-css-vars.ts","../src/utils/icon-libraries.ts","../src/utils/transformers/transform-icons.ts","../src/utils/transformers/transform-import.ts","../src/utils/transformers/transform-jsx.ts","../src/utils/transformers/transform-rsc.ts","../src/utils/transformers/transform-tw-prefix.ts","../src/utils/create-project.ts","../src/utils/updaters/update-tailwind-content.ts","../src/preflights/preflight-add.ts","../src/utils/update-app-index.ts","../src/commands/build.ts","../src/preflights/preflight-build.ts","../src/commands/diff.ts","../src/commands/info.ts","../src/commands/migrate.ts","../src/migrations/migrate-icons.ts","../src/migrations/migrate-radix.ts","../src/preflights/preflight-migrate.ts","../src/commands/registry/build.ts","../src/preflights/preflight-registry.ts","../src/commands/registry/mcp.ts","../src/index.ts","../package.json"],"names":["fs","path","MISSING_DIR_OR_EMPTY_PROJECT","MISSING_CONFIG","TAILWIND_NOT_CONFIGURED","IMPORT_ALIAS_MISSING","UNSUPPORTED_FRAMEWORK","BUILD_MISSING_REGISTRY_FILE","preFlightInit","options","errors","projectSpinner","spinner","logger","highlighter","frameworkSpinner","projectInfo","getProjectInfo","tailwindSpinnerMessage","tailwindSpinner","tsConfigSpinner","isSafeTarget","targetPath","cwd","decodedPath","prevPath","normalizedTarget","normalizedRoot","hasPathTraversal","cleanPath","cleanTarget","cleanDecoded","pattern","resolvedPath","postcss","updateCss","css","config","cssFilepath","cssFilepathRelative","cssSpinner","raw","output","transformCss","input","plugins","updateCssPlugin","root","selector","properties","atRuleMatch","name","params","node","pluginRule","importNodes","pluginNodes","lastPlugin","lastImport","themeInline","keyframesRule","step","stepProps","processRule","utilityAtRule","prop","value","existingDecl","decl","atRule","processAtRule","childSelector","childProps","nestedMatch","nestedName","nestedParams","tempRule","rule","clone","error","parent","nestedSelector","AtRule","z","updateCssVars","cssVars","cssVarsSpinner","transformCssVars","updateCssVarsPlugin","cleanupDefaultNextStylesPlugin","packageInfo","getPackageInfo","addCustomImport","addCustomVariant","updateCssVarsPluginV4","updateThemePlugin","updateTailwindConfigPlugin","updateTailwindConfigAnimationPlugin","updateTailwindConfigKeyframesPlugin","updateBaseLayerPlugin","tailwindVersion","requiredRules","baseLayer","apply","applyRule","key","vars","addOrUpdateVars","removeConflictVars","rootRule","propsToRemove","bodyRule","darkRootRule","ruleNode","newDecl","themeNode","upsertThemeNode","isLocalHSLValue","variables","themeVarNodes","variable","radiusVariables","cssVarNode","isColorValue","propValue","variantNode","customVariantNode","importNode","tailwindConfig","quote","getQuoteType","lastPluginNode","plugin","pluginName","pluginNode","existingKeyFrameNodes","keyframeValueSchema","keyframeName","keyframeValue","parsedKeyframeValue","keyframeNode","values","existingAnimationNodes","parsedAnimationValue","animationNode","chunks","chunk","detect","getPackageManager","targetDir","withFallback","packageManager","userAgent","execa","prompts","updateDependencies","dependencies","devDependencies","dependenciesSpinner","getUpdateDependenciesPackageManager","flag","shouldPromptForNpmFlag","confirmation","installWithPackageManager","hasReact19","hasReactDayPicker8","installWithNpm","installWithDeno","installWithExpo","dep","existsSync","isEnvFile","filePath","fileName","findExistingEnvFile","variants","variant","parseEnvContent","content","lines","env","line","trimmed","equalIndex","getNewEnvKeys","existingContent","newContent","existingEnv","newEnv","newKeys","mergeEnvContent","result","updateEnvVars","envVars","envSpinner","projectRoot","envFilePath","existingEnvFile","envFileExists","envFileName","newEnvContent","envVarsAdded","envFileUpdated","envFileCreated","mergedContent","tmpdir","basename","SyntaxKind","sourceFile","baseColor","valueWithColorMapping","applyColorMapping","splitClassName","className","parts","rest","alpha","split","PREFIXES","mapping","classNames","lightMode","darkMode","modifier","prefix","needle","ICON_LIBRARIES","SOURCE_LIBRARY","transformIcons","registryIcons","getRegistryIcons","sourceLibrary","targetLibrary","targetedIcons","importDeclaration","specifier","iconName","targetedIcon","iconImportDeclaration","icon","_useSemicolon","transformImport","isRemote","utilsImport","importDeclarations","moduleSpecifier","updateImportAliases","i","alias","transformFromAstSync","parse","transformTypescript","recast","PARSE_OPTIONS","transformJsx","ast","code","directiveRegex","transformRsc","first","Project","ScriptKind","transformTwPrefixes","getProjectTailwindVersionFromConfig","defaultClassNames","applyPrefix","callExpression","arg","project","createTempSourceFile","filename","dir","transform","opts","transformers","tempFile","transformer","loadConfig","updateFiles","files","filesCreatedSpinner","getRegistryBaseColor","filesCreated","filesUpdated","filesSkipped","envFile","file","resolveFilePath","findCommonRoot","f","match","alternativeEnvFile","existingFile","existingFileContent","normalizedExisting","normalizedNew","getNormalizedFileContent","overwrite","allFiles","updatedFiles","resolveImports","target","resolvePageTarget","resolveFileTargetDirectory","relativePath","resolveNestedFilePath","paths","normalizedPaths","p","normalizedNeedle","needleDir","needleSegments","testPath","normalizedFilePath","normalizedTargetDir","fileSegments","targetSegments","lastTargetSegment","commonDirIndex","segment","framework","filePaths","tsConfig","filepath","probableImportFilePath","resolveImport","resolvedImportFilePath","resolveModuleByProbablePath","newImport","toAliasedImport","extensions","relativeFiles","fileSet","extInPath","hasExt","absBase","relBase","tryExts","candidates","e","absCand","relCand","absIdx","relIdx","a","b","aExt","bExt","ord","aStrong","bStrong","abs","matches","aliasKey","rootDir","rel","ext","keepExt","noExt","aliasBase","suffix","addComponents","components","workspaceConfig","getWorkspaceConfig","addWorkspaceComponents","addProjectComponents","registrySpinner","tree","registryResolveItemsTree","handleError","validateFilesTarget","updateTailwindConfig","overwriteCssVars","shouldOverwriteCssVars","registryItems","resolveRegistryItems","fetchRegistry","payload","registryItemSchema","registryParentMap","getRegistryParentMap","registryTypeAliasMap","getRegistryTypeAliasMap","item","rootSpinner","component","registryParent","targetConfig","workspaceRoot","packageRoot","findPackageRoot","getRegistryItem","os","MONOREPO_TEMPLATE_URL","TEMPLATES","createProject","template","projectName","nextVersion","isRemoteComponent","meta","type","projectPath","createNextProject","createMonorepoProject","createSpinner","args","templatePath","response","tarPath","extractedPath","updateTailwindContent","tailwindFileRelativePath","transformTailwindContent","_createSourceFile","configObject","property","addTailwindConfigContent","quoteChar","_getQuoteChar","existingProperty","newProperty","initializer","contentItem","newValue","element","Command","initOptionsSchema","val","BASE_COLORS","color","init","isUrl","isLocalFile","runInit","newProjectTemplate","preflight","getConfig","projectConfig","getProjectConfig","promptForMinimalConfig","promptForConfig","proceed","componentSpinner","fullConfig","resolveConfigPaths","defaultConfig","styles","baseColors","getRegistryStyles","getRegistryBaseColors","style","DEFAULT_TAILWIND_CSS","DEFAULT_TAILWIND_CONFIG","DEFAULT_COMPONENTS","DEFAULT_UTILS","rawConfigSchema","cssVariables","preFlightAdd","updateAppIndex","indexPath","registryItem","DEPRECATED_COMPONENTS","addOptionsSchema","add","itemType","confirm","promptForRegistryComponents","deprecatedComponents","isUniversalRegistryItem","minimalConfig","createConfig","shouldUpdateAppIndex","registryIndex","getRegistryIndex","entry","c","preFlightBuild","resolvePaths","buildOptionsSchema","build","registry","registrySchema","buildSpinner","diffLines","updateOptionsSchema","diff","projectComponents","componentsWithUpdates","changes","diffComponent","change","printDiff","fetchTree","getItemTargetPath","fileContent","registryContent","patch","part","info","randomBytes","fg","migrateIcons","uiPath","libraryChoices","iconLibrary","migrateOptions","migrationSpinner","migrateIconsFile","iconsMapping","sourceLibraryImport","targetLibraryImport","toPascalCase","str","processNamedImports","namedImports","isTypeOnly","imports","packageName","namedImportList","importItem","inlineTypeMatch","aliasMatch","importName","importAlias","migrateRadix","foundPackages","replacedPackages","migrateRadixFile","pkg","packageSpinner","packageJson","foundPackagesArray","dependencyTypes","depType","packageJsonPath","radixImportPattern","linesToRemove","quoteStyle","hasSemicolon","fullMatch","typeKeyword","namespaceAlias","semicolon","componentName","uniqueImports","index","self","unifiedImport","imp","typePrefix","acc","transformedLine","offset","string","beforeMatch","openQuotes","openSingleQuotes","uniqueReplacedPackages","preFlightMigrate","migrations","migrateOptionsSchema","migration","migrate","preFlightRegistryBuild","buildRegistry","resolvedRegistry","t","d","absPath","err","results","recursivelyResolveFileImports","StdioServerTransport","mcp","transport","server","package_default","main","program"],"mappings":";kbAAA,OAAOA,OAAQ,KACf,OAAOC,OAAU,OCDjB,OAAS,YAAYD,OAAU,KAC/B,OAAOC,OAAU,OCDjB,OAAOA,OAAU,OCAV,IAAMC,EAA+B,IAErC,IAAMC,EAAiB,IAEvB,IAAMC,GAA0B,IAC1BC,GAAuB,IACvBC,GAAwB,IAM9B,IAAMC,EAA8B,KDL3C,OAAOP,OAAQ,WAGf,eAAsBQ,GACpBC,EACA,CACA,IAAMC,EAAkC,CAAC,EAIzC,GACE,CAACV,GAAG,WAAWS,EAAQ,GAAG,GAC1B,CAACT,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAK,cAAc,CAAC,EAExD,OAAAC,EAAcR,CAA4B,EAAI,GACvC,CACL,OAAAQ,EACA,YAAa,IACf,EAGF,IAAMC,EAAiBC,EAAQ,oBAAqB,CAClD,OAAQH,EAAQ,MAClB,CAAC,EAAE,MAAM,EAGPT,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAK,iBAAiB,CAAC,GAC1D,CAACA,EAAQ,QAETE,GAAgB,KAAK,EACrBE,EAAO,MAAM,EACbA,EAAO,MACL,KAAKC,EAAY,KACf,iBACF,4BAA4BA,EAAY,KACtCL,EAAQ,GACV;AAAA,4BAAiCK,EAAY,KAC3C,iBACF,kBAAkBA,EAAY,KAAK,MAAM,UAC3C,EACAD,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAGhBF,GAAgB,QAAQ,EAExB,IAAMI,EAAmBH,EAAQ,uBAAwB,CACvD,OAAQH,EAAQ,MAClB,CAAC,EAAE,MAAM,EACHO,EAAc,MAAMC,EAAeR,EAAQ,GAAG,GAChD,CAACO,GAAeA,GAAa,UAAU,OAAS,YAClDN,EAAcJ,EAAqB,EAAI,GACvCS,GAAkB,KAAK,EACvBF,EAAO,MAAM,EACTG,GAAa,UAAU,MAAM,cAC/BH,EAAO,MACL,gDAAgDC,EAAY,KAC1DL,EAAQ,GACV;AAAA,QACWK,EAAY,KACnBE,GAAa,UAAU,MAAM,YAC/B;AAAA,wDACJ,EAEFH,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAEhBE,GAAkB,QAChB,8BAA8BD,EAAY,KACxCE,EAAY,UAAU,KACxB,IACF,EAEA,IAAIE,EAAyB,2BAEzBF,EAAY,kBAAoB,OAClCE,EAAyB,yCAAyCJ,EAAY,KAC5E,IACF,MAGF,IAAMK,EAAkBP,EAAQM,EAAwB,CACtD,OAAQT,EAAQ,MAClB,CAAC,EAAE,MAAM,EAEPO,EAAY,kBAAoB,OAC/B,CAACA,GAAa,oBAAsB,CAACA,GAAa,kBAEnDN,EAAcN,EAAuB,EAAI,GACzCe,GAAiB,KAAK,GAEtBH,EAAY,kBAAoB,MAChC,CAACA,GAAa,iBAEdN,EAAcN,EAAuB,EAAI,GACzCe,GAAiB,KAAK,GACZH,EAAY,gBAItBG,GAAiB,QAAQ,GAHzBT,EAAcN,EAAuB,EAAI,GACzCe,GAAiB,KAAK,GAKxB,IAAMC,EAAkBR,EAAQ,2BAA4B,CAC1D,OAAQH,EAAQ,MAClB,CAAC,EAAE,MAAM,EACT,OAAKO,GAAa,YAIhBI,GAAiB,QAAQ,GAHzBV,EAAcL,EAAoB,EAAI,GACtCe,GAAiB,KAAK,GAKpB,OAAO,KAAKV,CAAM,EAAE,OAAS,IAC3BA,EAAcN,EAAuB,IACvCS,EAAO,MAAM,EACbA,EAAO,MACL,0CAA0CC,EAAY,KACpDL,EAAQ,GACV,IACF,EACAI,EAAO,MACL,uFACF,EACAA,EAAO,MAAM,sCAAsC,EAC/CG,GAAa,UAAU,MAAM,UAC/BH,EAAO,MACL,SAASC,EAAY,KACnBE,GAAa,UAAU,MAAM,QAC/B,mBACF,GAIAN,EAAcL,EAAoB,IACpCQ,EAAO,MAAM,EACbA,EAAO,MAAM,mDAAmD,EAC5DG,GAAa,UAAU,MAAM,cAC/BH,EAAO,MACL,SAASC,EAAY,KACnBE,GAAa,UAAU,MAAM,YAC/B,wCACF,GAIJH,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAGT,CACL,OAAAH,EACA,YAAAM,CACF,CACF,CEjKA,OAAOf,MAAU,OCAjB,OAAOA,OAAU,OAEV,SAASoB,GAAaC,EAAoBC,EAAsB,CAErE,GAAID,EAAW,SAAS,IAAI,EAC1B,MAAO,GAIT,IAAIE,EACJ,GAAI,CAEFA,EAAcF,EACd,IAAIG,EAAW,GACf,KAAOD,IAAgBC,GAAYD,EAAY,SAAS,GAAG,GACzDC,EAAWD,EACXA,EAAc,mBAAmBA,CAAW,CAEhD,MAAE,CAEA,MAAO,EACT,CAIA,IAAME,EAAmBzB,GAAK,UAAUuB,EAAY,QAAQ,MAAO,GAAG,CAAC,EACjEG,EAAiB1B,GAAK,UAAUsB,CAAG,EAInCK,EAAoB3B,GAEAA,EAAK,QAAQ,iBAAkB,EAAE,EAClC,SAAS,IAAI,EAGtC,GACE2B,EAAiBF,CAAgB,GACjCE,EAAiBJ,CAAW,GAC5BI,EAAiBN,CAAU,EAE3B,MAAO,GAKT,IAAMO,EAAa5B,GAAiBA,EAAK,QAAQ,iBAAkB,EAAE,EAC/D6B,EAAcD,EAAUP,CAAU,EAClCS,EAAeF,EAAUL,CAAW,EAoB1C,GAlB2B,CACzB,aACA,aACA,OACA,QACA,OACA,aACF,EAGqB,KAChBQ,GAAYA,EAAQ,KAAKF,CAAW,GAAKE,EAAQ,KAAKD,CAAY,CACrE,IAOCT,EAAW,SAAS,GAAG,GAAKE,EAAY,SAAS,GAAG,KACpDF,EAAW,SAAS,KAAK,GAAKE,EAAY,SAAS,KAAK,GAEzD,MAAO,GAKT,GADyB,mBACJ,KAAKA,CAAW,EAEnC,OAAI,QAAQ,WAAa,QAChBA,EAAY,YAAY,EAAE,WAAWD,EAAI,YAAY,CAAC,EAGxD,GAIT,GAAItB,GAAK,WAAWyB,CAAgB,EAClC,OAAOA,EAAiB,WAAWC,EAAiB1B,GAAK,GAAG,EAI9D,IAAMgC,EAAehC,GAAK,QAAQ0B,EAAgBD,CAAgB,EAClE,OACEO,EAAa,WAAWN,EAAiB1B,GAAK,GAAG,GACjDgC,IAAiBN,CAErB,CCjGA,OAAS,YAAY3B,OAAU,KAC/B,OAAOC,OAAU,OAKjB,OAAOiC,MAAa,UAOpB,eAAsBC,GACpBC,EACAC,EACA5B,EAGA,CACA,GACE,CAAC4B,EAAO,cAAc,aACtB,CAACD,GACD,OAAO,KAAKA,CAAG,EAAE,SAAW,EAE5B,OAGF3B,EAAU,CACR,OAAQ,GACR,GAAGA,CACL,EAEA,IAAM6B,EAAcD,EAAO,cAAc,YACnCE,EAAsBtC,GAAK,SAC/BoC,EAAO,cAAc,IACrBC,CACF,EACME,EAAa5B,EACjB,YAAYE,EAAY,KAAKyB,CAAmB,IAChD,CACE,OAAQ9B,EAAQ,MAClB,CACF,EAAE,MAAM,EAEFgC,EAAM,MAAMzC,GAAG,SAASsC,EAAa,MAAM,EAC7CI,EAAS,MAAMC,GAAaF,EAAKL,CAAG,EACxC,MAAMpC,GAAG,UAAUsC,EAAaI,EAAQ,MAAM,EAC9CF,EAAW,QAAQ,CACrB,CAEA,eAAsBG,GACpBC,EACAR,EACA,CACA,IAAMS,EAAU,CAACC,GAAgBV,CAAG,CAAC,EAMjCM,GAJW,MAAMR,EAAQW,CAAO,EAAE,QAAQD,EAAO,CACnD,KAAM,MACR,CAAC,GAEmB,IACpB,OAAAF,EAASA,EAAO,QAAQ,yBAA0B,EAAE,EACpDA,EAASA,EAAO,QAAQ,cAAe;AAAA;AAAA,CAAM,EAC7CA,EAASA,EAAO,QAAQ,EAEjBA,CACT,CAEA,SAASI,GAAgBV,EAA4C,CACnE,MAAO,CACL,cAAe,aACf,KAAKW,EAAY,CACf,OAAW,CAACC,EAAUC,CAAU,IAAK,OAAO,QAAQb,CAAG,EACrD,GAAIY,EAAS,WAAW,GAAG,EAAG,CAE5B,IAAME,EAAcF,EAAS,MAAM,sBAAsB,EACzD,GAAI,CAACE,EAAa,SAElB,GAAM,CAAC,CAAEC,EAAMC,CAAM,EAAIF,EAGzB,GAAIC,IAAS,UASX,GAAI,CAPmBJ,EAAK,OAAO,KAChCM,GACCA,EAAK,OAAS,UACdA,EAAK,OAAS,UACdA,EAAK,SAAWD,CACpB,EAEqB,CACnB,IAAME,EAAapB,EAAQ,OAAO,CAChC,KAAM,SACN,OAAAkB,EACA,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,CAAK,CACxC,CAAC,EAGKG,EAAcR,EAAK,OAAO,OAC7BM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,QAC5C,EAEMG,EAAcT,EAAK,OAAO,OAC7BM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,QAC5C,EAEA,GAAIG,GAAeA,EAAY,OAAS,EAAG,CAEzC,IAAMC,EAAaD,EAAYA,EAAY,OAAS,CAAC,EACrDT,EAAK,YAAYU,EAAYH,CAAU,UAC9BC,GAAeA,EAAY,OAAS,EAAG,CAEhD,IAAMG,EAAaH,EAAYA,EAAY,OAAS,CAAC,EACrDR,EAAK,YAAYW,EAAYJ,CAAU,EAEvCP,EAAK,aACHO,EACApB,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,EAEAa,EAAK,YACHO,EACApB,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,OAGAa,EAAK,QAAQO,CAAU,EAEvBP,EAAK,aACHO,EACApB,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,EAEAa,EAAK,YACHO,EACApB,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,WAKGiB,IAAS,YAAa,CAC7B,IAAIQ,EAAcZ,EAAK,OAAO,KAC3BM,GACCA,EAAK,OAAS,UACdA,EAAK,OAAS,SACdA,EAAK,SAAW,QACpB,EAEKM,IACHA,EAAczB,EAAQ,OAAO,CAC3B,KAAM,QACN,OAAQ,SACR,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,CAAK,CACtD,CAAC,EACDa,EAAK,OAAOY,CAAW,EACvBZ,EAAK,aACHY,EACAzB,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,GAGF,IAAM0B,EAAgB1B,EAAQ,OAAO,CACnC,KAAM,YACN,OAAAkB,EACA,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,GAAO,CACxD,CAAC,EAID,GAFAO,EAAY,OAAOC,CAAa,EAE5B,OAAOX,GAAe,SACxB,OAAW,CAACY,EAAMC,CAAS,IAAK,OAAO,QAAQb,CAAU,EACvDc,GAAYH,EAAeC,EAAMC,CAAS,UAKvCX,IAAS,UAAW,CAC3B,IAAMa,EAAgBjB,EAAK,OAAO,KAC/BM,GACCA,EAAK,OAAS,UACdA,EAAK,OAASF,GACdE,EAAK,SAAWD,CACpB,EAEA,GAAKY,GA8BH,GAAI,OAAOf,GAAe,SACxB,OAAW,CAACgB,EAAMC,CAAK,IAAK,OAAO,QAAQjB,CAAU,EACnD,GAAI,OAAOiB,GAAU,SAAU,CAC7B,IAAMC,EAAeH,EAAc,OAAO,KACvCX,GACCA,EAAK,OAAS,QAAUA,EAAK,OAASY,CAC1C,EAEMG,EAAOlC,EAAQ,KAAK,CACxB,KAAA+B,EACA,MAAOC,EACP,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,KAAS,CAC5C,CAAC,EAEDC,EACIA,EAAa,YAAYC,CAAI,EAC7BJ,EAAc,OAAOI,CAAI,OACpB,OAAOF,GAAU,UAC1BH,GAAYC,EAAeC,EAAMC,CAAK,MAhD1B,CAClB,IAAMG,EAASnC,EAAQ,OAAO,CAC5B,KAAAiB,EACA,OAAAC,EACA,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,CAAK,CACtD,CAAC,EASD,GAPAL,EAAK,OAAOsB,CAAM,EAClBtB,EAAK,aACHsB,EACAnC,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,EAGI,OAAOe,GAAe,SACxB,OAAW,CAACgB,EAAMC,CAAK,IAAK,OAAO,QAAQjB,CAAU,EACnD,GAAI,OAAOiB,GAAU,SAAU,CAC7B,IAAME,EAAOlC,EAAQ,KAAK,CACxB,KAAA+B,EACA,MAAOC,EACP,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,KAAS,CAC5C,CAAC,EACDG,EAAO,OAAOD,CAAI,OACT,OAAOF,GAAU,UAC1BH,GAAYM,EAAQJ,EAAMC,CAAK,QA+BvCI,GAAcvB,EAAMI,EAAMC,EAAQH,CAAU,OAI9Cc,GAAYhB,EAAMC,EAAUC,CAAU,CAG5C,CACF,CACF,CAEA,SAASqB,GACPvB,EACAI,EACAC,EACAH,EACA,CAEA,IAAIoB,EAAStB,EAAK,OAAO,KACtBM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAASF,GAAQE,EAAK,SAAWD,CACpE,EAaA,GAXKiB,IACHA,EAASnC,EAAQ,OAAO,CACtB,KAAAiB,EACA,OAAAC,EACA,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,CAAK,CACtD,CAAC,EACDL,EAAK,OAAOsB,CAAM,EAClBtB,EAAK,aAAasB,EAAQnC,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,GAIhE,OAAOe,GAAe,SACxB,OAAW,CAACsB,EAAeC,CAAU,IAAK,OAAO,QAAQvB,CAAU,EACjE,GAAIsB,EAAc,WAAW,GAAG,EAAG,CAEjC,IAAME,EAAcF,EAAc,MAAM,sBAAsB,EAC9D,GAAIE,EAAa,CACf,GAAM,CAAC,CAAEC,EAAYC,CAAY,EAAIF,EACrCH,GAAcD,EAAQK,EAAYC,EAAcH,CAAU,QAI5DT,GAAYM,EAAQE,EAAeC,CAAU,UAGxC,OAAOvB,GAAe,SAE/B,GAAI,CAGF,IAAM2B,EADS1C,EAAQ,MAAM,SAASe,IAAa,EAC3B,MAExB,GAAI2B,GAAYA,EAAS,MAAO,CAE9B,IAAMC,EAAO3C,EAAQ,KAAK,CACxB,SAAU,OACV,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,GAAO,CACxD,CAAC,EAGD0C,EAAS,MAAM,QAASvB,GAAS,CAC/B,GAAIA,EAAK,OAAS,OAAQ,CACxB,IAAMyB,EAAQzB,EAAK,MAAM,EACzByB,EAAM,KAAK,OAAS;AAAA,MACpBD,EAAK,OAAOC,CAAK,EAErB,CAAC,EAGGD,EAAK,OAAO,QACdR,EAAO,OAAOQ,CAAI,EAGxB,OAASE,EAAP,CACA,cAAQ,MAAM,iCAAkC9B,EAAY8B,CAAK,EAC3DA,CACR,CAEJ,CAEA,SAAShB,GAAYiB,EAAuBhC,EAAkBC,EAAiB,CAC7E,IAAI4B,EAAOG,EAAO,OAAO,KACtB3B,GAAuBA,EAAK,OAAS,QAAUA,EAAK,WAAaL,CACpE,EAUA,GARK6B,IACHA,EAAO3C,EAAQ,KAAK,CAClB,SAAAc,EACA,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,GAAO,CACxD,CAAC,EACDgC,EAAO,OAAOH,CAAI,GAGhB,OAAO5B,GAAe,UACxB,OAAW,CAACgB,EAAMC,CAAK,IAAK,OAAO,QAAQjB,CAAU,EACnD,GAAI,OAAOiB,GAAU,SAAU,CAC7B,IAAME,EAAOlC,EAAQ,KAAK,CACxB,KAAA+B,EACA,MAAOC,EACP,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,KAAS,CAC5C,CAAC,EAGKC,EAAeU,EAAK,OAAO,KAC9BxB,GACCA,EAAK,OAAS,QAAUA,EAAK,OAASY,CAC1C,EAEAE,EAAeA,EAAa,YAAYC,CAAI,EAAIS,EAAK,OAAOT,CAAI,UACvD,OAAOF,GAAU,SAAU,CAEpC,IAAMe,EAAiBhB,EAAK,WAAW,GAAG,EACtCjB,EAAS,QAAQ,WAAY,KAAKiB,EAAK,UAAU,CAAC,GAAG,EACrDA,EACJF,GAAYiB,EAAQC,EAAgBf,CAAK,WAGpC,OAAOjB,GAAe,SAE/B,GAAI,CAGF,IAAM2B,EADS1C,EAAQ,MAAM,SAASe,IAAa,EAC3B,MAEpB2B,GAAYA,EAAS,OAEvBA,EAAS,MAAM,QAASvB,GAAS,CAC/B,GAAIA,EAAK,OAAS,OAAQ,CACxB,IAAMyB,EAAQzB,EAAK,MAAM,EACzByB,EAAM,KAAK,OAAS;AAAA,MACpBD,GAAM,OAAOC,CAAK,EAEtB,CAAC,CAEL,OAASC,EAAP,CACA,cAAQ,MAAM,8BAA+B/B,EAAUC,EAAY8B,CAAK,EAClEA,CACR,CAEJ,CCjYA,OAAS,YAAY/E,OAAU,KAC/B,OAAOC,OAAU,OAUjB,OAAOiC,MAAa,UACpB,OAAOgD,OAAY,sBAGnB,OAAS,KAAAC,MAAS,MAElB,eAAsBC,GACpBC,EACAhD,EACA5B,EAQA,CACA,GAAI,CAAC4B,EAAO,cAAc,aAAe,CAAC,OAAO,KAAKgD,GAAW,CAAC,CAAC,EAAE,OACnE,OAGF5E,EAAU,CACR,yBAA0B,GAC1B,OAAQ,GACR,gBAAiB,KACjB,iBAAkB,GAClB,UAAW,GACX,GAAGA,CACL,EACA,IAAM6B,EAAcD,EAAO,cAAc,YACnCE,EAAsBtC,GAAK,SAC/BoC,EAAO,cAAc,IACrBC,CACF,EACMgD,EAAiB1E,EACrB,6BAA6BE,EAAY,KAAKyB,CAAmB,IACjE,CACE,OAAQ9B,EAAQ,MAClB,CACF,EAAE,MAAM,EACFgC,EAAM,MAAMzC,GAAG,SAASsC,EAAa,MAAM,EAC7CI,EAAS,MAAM6C,GAAiB9C,EAAK4C,GAAW,CAAC,EAAGhD,EAAQ,CAC9D,yBAA0B5B,EAAQ,yBAClC,gBAAiBA,EAAQ,gBACzB,eAAgBA,EAAQ,eACxB,iBAAkBA,EAAQ,iBAC1B,UAAWA,EAAQ,SACrB,CAAC,EACD,MAAMT,GAAG,UAAUsC,EAAaI,EAAQ,MAAM,EAC9C4C,EAAe,QAAQ,CACzB,CAEA,eAAsBC,GACpB3C,EACAyC,EACAhD,EACA5B,EAMI,CACF,yBAA0B,GAC1B,gBAAiB,KACjB,eAAgB,OAChB,iBAAkB,GAClB,UAAW,EACb,EACA,CACAA,EAAU,CACR,yBAA0B,GAC1B,gBAAiB,KACjB,eAAgB,OAChB,iBAAkB,GAClB,UAAW,GACX,GAAGA,CACL,EAEA,IAAIoC,EAAU,CAAC2C,GAAoBH,CAAO,CAAC,EAM3C,GAJI5E,EAAQ,0BACVoC,EAAQ,KAAK4C,GAA+B,CAAC,EAG3ChF,EAAQ,kBAAoB,KAAM,CAIpC,GAHAoC,EAAU,CAAC,EAGPR,EAAO,eAAe,IAAK,CAC7B,IAAMqD,EAAcC,EAAetD,EAAO,cAAc,GAAG,EAEzD,CAACqD,GAAa,eAAe,qBAAqB,GAClD,CAACA,GAAa,kBAAkB,qBAAqB,GACrDjF,EAAQ,WAERoC,EAAQ,KAAK+C,GAAgB,CAAE,OAAQ,gBAAiB,CAAC,CAAC,EAI9D/C,EAAQ,KAAKgD,GAAiB,CAAE,OAAQ,sBAAuB,CAAC,CAAC,EAE7DpF,EAAQ,0BACVoC,EAAQ,KAAK4C,GAA+B,CAAC,EAG/C5C,EAAQ,KACNiD,GAAsBT,EAAS,CAC7B,iBAAkB5E,EAAQ,gBAC5B,CAAC,CACH,EACAoC,EAAQ,KAAKkD,GAAkBV,CAAO,CAAC,EAEnC5E,EAAQ,iBACVoC,EAAQ,KAAKmD,GAA2BvF,EAAQ,cAAc,CAAC,EAC/DoC,EAAQ,KAAKoD,GAAoCxF,EAAQ,cAAc,CAAC,EACxEoC,EAAQ,KAAKqD,GAAoCzF,EAAQ,cAAc,CAAC,GAIxE4B,EAAO,SAAS,cAAgB5B,EAAQ,WAC1CoC,EAAQ,KACNsD,GAAsB,CAAE,gBAAiB1F,EAAQ,eAAgB,CAAC,CACpE,EAOF,IAAIiC,GAJW,MAAMR,EAAQW,CAAO,EAAE,QAAQD,EAAO,CACnD,KAAM,MACR,CAAC,GAEmB,IAEpB,OAAAF,EAASA,EAAO,QAAQ,yBAA0B,EAAE,EAEhDjC,EAAQ,kBAAoB,OAC9BiC,EAASA,EAAO,QAAQ,cAAe;AAAA;AAAA,CAAM,GAGxCA,CACT,CAEA,SAASyD,GAAsB,CAC7B,gBAAAC,CACF,EAEG,CACD,MAAO,CACL,cAAe,oBACf,KAAKrD,EAAY,CACf,IAAMsD,EAAgB,CACpB,CACE,SAAU,IACV,MACED,IAAoB,KAChB,gCACA,eACR,EACA,CAAE,SAAU,OAAQ,MAAO,+BAAgC,CAC7D,EAEIE,EAAYvD,EAAK,MAAM,KACxBM,GACCA,EAAK,OAAS,UACdA,EAAK,OAAS,SACdA,EAAK,SAAW,QAChBgD,EAAc,MAAM,CAAC,CAAE,SAAArD,EAAU,MAAAuD,CAAM,IACrClD,EAAK,OAAO,KACTwB,GACCA,EAAK,OAAS,QACdA,EAAK,WAAa7B,GAClB6B,EAAK,MAAM,KACR2B,GACCA,EAAU,OAAS,UACnBA,EAAU,OAAS,SACnBA,EAAU,SAAWD,CACzB,CACJ,CACF,CACJ,EAEKD,IACHA,EAAYpE,EAAQ,OAAO,CACzB,KAAM,QACN,OAAQ,OACR,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,CAAK,CACtD,CAAC,EACDa,EAAK,OAAOuD,CAAS,EACrBvD,EAAK,aAAauD,EAAWpE,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,GAGvEmE,EAAc,QAAQ,CAAC,CAAE,SAAArD,EAAU,MAAAuD,CAAM,IAAM,CACxBD,GAAW,OAAO,KACpCjD,GACCA,EAAK,OAAS,QAAUA,EAAK,WAAaL,CAC9C,GAGEsD,GAAW,OACTpE,EAAQ,KAAK,CACX,SAAAc,EACA,MAAO,CACLd,EAAQ,OAAO,CACb,KAAM,QACN,OAAQqE,EACR,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,KAAS,CAC5C,CAAC,CACH,EACA,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,GAAO,CACxD,CAAC,CACH,CAEJ,CAAC,CACH,CACF,CACF,CAEA,SAASf,GACPH,EACA,CACA,MAAO,CACL,cAAe,kBACf,KAAKtC,EAAY,CACf,IAAIuD,EAAYvD,EAAK,MAAM,KACxBM,GACCA,EAAK,OAAS,UACdA,EAAK,OAAS,SACdA,EAAK,SAAW,MACpB,EAEMiD,aAAqBpB,KACzBoB,EAAYpE,EAAQ,OAAO,CACzB,KAAM,QACN,OAAQ,OACR,MAAO,CAAC,EACR,KAAM,CACJ,UAAW,GACX,OAAQ;AAAA,EACR,QAAS,GACX,CACF,CAAC,EACDa,EAAK,OAAOuD,CAAS,EACrBvD,EAAK,aAAauD,EAAWpE,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,GAGnEoE,IAAc,QAEhB,OAAO,QAAQjB,CAAO,EAAE,QAAQ,CAAC,CAACoB,EAAKC,CAAI,IAAM,CAC/C,IAAM1D,EAAWyD,IAAQ,QAAU,QAAU,IAAIA,IAEjDE,GAAgBL,EAAqBtD,EAAU0D,CAAI,CACrD,CAAC,CAEL,CACF,CACF,CAEA,SAASE,GAAmB7D,EAAmB,CAC7C,IAAM8D,EAAW9D,EAAK,MAAM,KACzBM,GAAuBA,EAAK,OAAS,QAAUA,EAAK,WAAa,OACpE,EAEA,GAAIwD,EAAU,CACZ,IAAMC,EAAgB,CAAC,eAAgB,cAAc,EAErDD,EAAS,MACN,OACExD,GACCA,EAAK,OAAS,QAAUyD,EAAc,SAASzD,EAAK,IAAI,CAC5D,EACC,QAASA,GAASA,EAAK,OAAO,CAAC,EAE9BwD,EAAS,MAAM,SAAW,GAC5BA,EAAS,OAAO,EAGtB,CAEA,SAASpB,IAAiC,CACxC,MAAO,CACL,cAAe,8BACf,KAAK1C,EAAY,CACf,IAAMgE,EAAWhE,EAAK,MAAM,KACzBM,GAAuBA,EAAK,OAAS,QAAUA,EAAK,WAAa,MACpE,EACI0D,IAEFA,EAAS,MACN,KACE1D,GACCA,EAAK,OAAS,QACdA,EAAK,OAAS,SACd,CAAC,6BAA8B,mBAAmB,EAAE,SAClDA,EAAK,KACP,CACJ,GACE,OAAO,EAGX0D,EAAS,MACN,KAAM1D,GAEHA,EAAK,OAAS,QACdA,EAAK,OAAS,eAEbA,EAAK,MAAM,WAAW,iBAAiB,GACtCA,EAAK,QAAU,oBAEpB,GACC,OAAO,EAGX0D,EAAS,MACN,KACE1D,GACCA,EAAK,OAAS,QACdA,EAAK,OAAS,eACdA,EAAK,QAAU,8BACnB,GACE,OAAO,EAGP0D,EAAS,MAAM,SAAW,GAC5BA,EAAS,OAAO,GAIpBH,GAAmB7D,CAAI,EAEvB,IAAMiE,EAAejE,EAAK,MAAM,KAC7BM,GACCA,EAAK,OAAS,UACdA,EAAK,SAAW,8BACpB,EAEI2D,IACFJ,GAAmBI,CAAY,EAC3BA,EAAa,MAAM,SAAW,GAChCA,EAAa,OAAO,EAG1B,CACF,CACF,CAEA,SAASL,GACPL,EACAtD,EACA0D,EACA,CACA,IAAIO,EAAWX,EAAU,OAAO,KAC7BjD,GAAuBA,EAAK,OAAS,QAAUA,EAAK,WAAaL,CACpE,EAEKiE,GACC,OAAO,KAAKP,CAAI,EAAE,OAAS,IAC7BO,EAAW/E,EAAQ,KAAK,CACtB,SAAAc,EACA,KAAM,CAAE,QAAS,IAAK,OAAQ;AAAA,GAAO,CACvC,CAAC,EACDsD,EAAU,OAAOW,CAAQ,GAI7B,OAAO,QAAQP,CAAI,EAAE,QAAQ,CAAC,CAACD,EAAKvC,CAAK,IAAM,CAC7C,IAAMD,EAAO,KAAKwC,EAAI,QAAQ,MAAO,EAAE,IACjCS,EAAUhF,EAAQ,KAAK,CAC3B,KAAA+B,EACA,MAAAC,EACA,KAAM,CAAE,UAAW,EAAK,CAC1B,CAAC,EAEKC,EAAe8C,GAAU,MAAM,KAClC5D,GACCA,EAAK,OAAS,QAAUA,EAAK,OAASY,CAC1C,EAEAE,EAAeA,EAAa,YAAY+C,CAAO,EAAID,GAAU,OAAOC,CAAO,CAC7E,CAAC,CACH,CAEA,SAASpB,GACPT,EACA5E,EAGA,CACA,MAAO,CACL,cAAe,qBACf,KAAKsC,EAAY,CACf,OAAO,QAAQsC,CAAO,EAAE,QAAQ,CAAC,CAACoB,EAAKC,CAAI,IAAM,CAC/C,IAAI1D,EAAWyD,IAAQ,QAAU,QAAU,IAAIA,IAE/C,GAAIA,IAAQ,QAAS,CACnBzD,EAAW,SACX,IAAMmE,EAAYC,GAAgBrE,CAAI,EACtC,OAAO,QAAQ2D,CAAI,EAAE,QAAQ,CAAC,CAACD,EAAKvC,CAAK,IAAM,CAC7C,IAAMD,EAAO,KAAKwC,EAAI,QAAQ,MAAO,EAAE,IACjCS,EAAUhF,EAAQ,KAAK,CAC3B,KAAA+B,EACA,MAAAC,EACA,KAAM,CAAE,UAAW,EAAK,CAC1B,CAAC,EAEKC,EAAegD,GAAW,OAAO,KACpC9D,GACCA,EAAK,OAAS,QAAUA,EAAK,OAASY,CAC1C,EAMIxD,EAAQ,iBACN0D,EACFA,EAAa,YAAY+C,CAAO,EAEhCC,GAAW,OAAOD,CAAO,EAGtB/C,GACHgD,GAAW,OAAOD,CAAO,CAG/B,CAAC,EACD,OAGF,IAAID,EAAWlE,EAAK,OAAO,KACxBM,GACCA,EAAK,OAAS,QAAUA,EAAK,WAAaL,CAC9C,EAEI,CAACiE,GAAY,OAAO,KAAKP,CAAI,EAAE,OAAS,IAC1CO,EAAW/E,EAAQ,KAAK,CACtB,SAAAc,EACA,MAAO,CAAC,EACR,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,CAAK,CACtD,CAAC,EACDD,EAAK,OAAOkE,CAAQ,EACpBlE,EAAK,aAAakE,EAAU/E,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,GAGtE,OAAO,QAAQwE,CAAI,EAAE,QAAQ,CAAC,CAACD,EAAKvC,CAAK,IAAM,CAC7C,IAAID,EAAO,KAAKwC,EAAI,QAAQ,MAAO,EAAE,IAGjCxC,IAAS,yBACXA,EAAO,aAGLoD,GAAgBnD,CAAK,IACvBA,EAAQ,OAAOA,MAGjB,IAAMgD,EAAUhF,EAAQ,KAAK,CAC3B,KAAA+B,EACA,MAAAC,EACA,KAAM,CAAE,UAAW,EAAK,CAC1B,CAAC,EACKC,EAAe8C,GAAU,MAAM,KAClC5D,GACCA,EAAK,OAAS,QAAUA,EAAK,OAASY,CAC1C,EAMIxD,EAAQ,iBACN0D,EACFA,EAAa,YAAY+C,CAAO,EAEhCD,GAAU,OAAOC,CAAO,EAGrB/C,GACH8C,GAAU,OAAOC,CAAO,CAG9B,CAAC,CACH,CAAC,CACH,CACF,CACF,CAEA,SAASnB,GAAkBV,EAAoD,CAC7E,MAAO,CACL,cAAe,eACf,KAAKtC,EAAY,CAEf,IAAMuE,EAAY,MAAM,KACtB,IAAI,IACF,OAAO,KAAKjC,CAAO,EAAE,QAASoB,GAC5B,OAAO,KAAKpB,EAAQoB,CAA2B,GAAK,CAAC,CAAC,CACxD,CACF,CACF,EAEA,GAAI,CAACa,EAAU,OACb,OAGF,IAAMH,EAAYC,GAAgBrE,CAAI,EAEhCwE,EAAgBJ,EAAU,OAAO,OACpC9D,GACCA,EAAK,OAAS,QAAUA,EAAK,KAAK,WAAW,IAAI,CACrD,EAEA,QAAWmE,KAAYF,EAAW,CAChC,IAAMpD,EAAQ,OAAO,OAAOmB,CAAO,EAAE,KAAMqB,GAASA,EAAKc,CAAQ,CAAC,IAChEA,CACF,EAEA,GAAI,CAACtD,EACH,SAGF,GAAIsD,IAAa,SAAU,CACzB,IAAMC,EAAkB,CACtB,GAAI,4BACJ,GAAI,4BACJ,GAAI,gBACJ,GAAI,2BACN,EACA,OAAW,CAAChB,EAAKvC,CAAK,IAAK,OAAO,QAAQuD,CAAe,EAAG,CAC1D,IAAMC,EAAaxF,EAAQ,KAAK,CAC9B,KAAM,YAAYuE,IAClB,MAAAvC,EACA,KAAM,CAAE,UAAW,EAAK,CAC1B,CAAC,EAECiD,GAAW,OAAO,KACf9D,GACCA,EAAK,OAAS,QAAUA,EAAK,OAASqE,EAAW,IACrD,GAIFP,GAAW,OAAOO,CAAU,EAE9B,SAGF,IAAIzD,EACFoD,GAAgBnD,CAAK,GAAKyD,GAAazD,CAAK,EACxC,WAAWsD,EAAS,QAAQ,MAAO,EAAE,IACrC,KAAKA,EAAS,QAAQ,MAAO,EAAE,IACjCvD,IAAS,+BACXA,EAAO,mBAGT,IAAI2D,EAAY,SAASJ,KACrBvD,IAAS,oBACX2D,EAAY,kBAGd,IAAMF,EAAaxF,EAAQ,KAAK,CAC9B,KAAA+B,EACA,MAAO2D,EACP,KAAM,CAAE,UAAW,EAAK,CAC1B,CAAC,EACoBT,GAAW,OAAO,KACpC9D,GACCA,EAAK,OAAS,QAAUA,EAAK,OAASqE,EAAW,IACrD,IAEMH,GAAe,OACjBJ,GAAW,YACTI,EAAcA,EAAc,OAAS,CAAC,EACtCG,CACF,EAEAP,GAAW,OAAOO,CAAU,GAIpC,CACF,CACF,CAEA,SAASN,GAAgBrE,EAAoB,CAC3C,IAAIoE,EAAYpE,EAAK,MAAM,KACxBM,GACCA,EAAK,OAAS,UACdA,EAAK,OAAS,SACdA,EAAK,SAAW,QACpB,EAEA,OAAK8D,IACHA,EAAYjF,EAAQ,OAAO,CACzB,KAAM,QACN,OAAQ,SACR,MAAO,CAAC,EACR,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,CAAK,CACtD,CAAC,EACDa,EAAK,OAAOoE,CAAS,EACrBpE,EAAK,aAAaoE,EAAWjF,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,GAGhEiF,CACT,CAEA,SAAStB,GAAiB,CAAE,OAAAzC,CAAO,EAAuB,CACxD,MAAO,CACL,cAAe,qBACf,KAAKL,EAAY,CAMf,GAAI,CALkBA,EAAK,MAAM,KAC9BM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,gBAC5C,EAEoB,CAElB,IAAME,EAAcR,EAAK,MAAM,OAC5BM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,QAC5C,EAEMwE,EAAc3F,EAAQ,OAAO,CACjC,KAAM,iBACN,OAAAkB,EACA,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,CAAK,CACxC,CAAC,EAED,GAAIG,EAAY,OAAS,EAAG,CAE1B,IAAMG,EAAaH,EAAYA,EAAY,OAAS,CAAC,EACrDR,EAAK,YAAYW,EAAYmE,CAAW,OAGxC9E,EAAK,YAAYA,EAAK,MAAM,CAAC,EAAG8E,CAAW,EAG7C9E,EAAK,aAAa8E,EAAa3F,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,EAE3E,CACF,CACF,CAEA,SAAS0D,GAAgB,CAAE,OAAAxC,CAAO,EAAuB,CACvD,MAAO,CACL,cAAe,oBACf,KAAKL,EAAY,CACf,IAAMQ,EAAcR,EAAK,MAAM,OAC5BM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,QAC5C,EAGMyE,EAAoB/E,EAAK,MAAM,KAClCM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,gBAC5C,EAOA,GAAI,CAJcE,EAAY,KAC3BF,GAASA,EAAK,OAAO,QAAQ,QAAS,EAAE,IAAMD,CACjD,EAEgB,CACd,IAAM2E,EAAa7F,EAAQ,OAAO,CAChC,KAAM,SACN,OAAQ,IAAIkB,KACZ,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,CAAK,CACxC,CAAC,EAED,GAAIG,EAAY,OAAS,EAAG,CAE1B,IAAMG,EAAaH,EAAYA,EAAY,OAAS,CAAC,EACrDR,EAAK,YAAYW,EAAYqE,CAAU,OAC9BD,GAET/E,EAAK,aAAa+E,EAAmBC,CAAU,EAC/ChF,EAAK,aACH+E,EACA5F,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,IAGAa,EAAK,QAAQgF,CAAU,EACvBhF,EAAK,YAAYgF,EAAY7F,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,GAG3E,CACF,CACF,CAEA,SAAS8D,GACPgC,EACA,CACA,MAAO,CACL,cAAe,yBACf,KAAKjF,EAAY,CACf,GAAI,CAACiF,GAAgB,QACnB,OAIF,IAAMC,EADYC,GAAanF,CAAI,IACP,SAAW,IAAM,IAEvCS,EAAcT,EAAK,MAAM,OAC5BM,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,QAC5C,EAEM8E,EACJ3E,EAAYA,EAAY,OAAS,CAAC,GAAKT,EAAK,MAAM,CAAC,EAErD,QAAWqF,KAAUJ,EAAe,QAAS,CAC3C,IAAMK,EAAaD,EAAO,QAAQ,0BAA2B,EAAE,EAG/D,GACE5E,EAAY,KAAMH,GACTA,EAAK,OAAO,QAAQ,QAAS,EAAE,IAAMgF,CAC7C,EAED,SAGF,IAAMC,EAAapG,EAAQ,OAAO,CAChC,KAAM,SACN,OAAQ,GAAG+F,IAAQI,IAAaJ,IAChC,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,CAAK,CACxC,CAAC,EACDlF,EAAK,YAAYoF,EAAgBG,CAAU,EAC3CvF,EAAK,aAAauF,EAAYpG,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CAAC,EAE1E,CACF,CACF,CAEA,SAASgE,GACP8B,EACA,CACA,MAAO,CACL,cAAe,mCACf,KAAKjF,EAAY,CACf,GAAI,CAACiF,GAAgB,OAAO,QAAQ,UAClC,OAGF,IAAMb,EAAYC,GAAgBrE,CAAI,EAChCwF,EAAwBpB,EAAU,OAAO,OAC5C9D,GACCA,EAAK,OAAS,UAAYA,EAAK,OAAS,WAC5C,EAEMmF,EAAsBrD,EAAE,OAC5BA,EAAE,OAAO,EACTA,EAAE,OAAOA,EAAE,OAAO,EAAGA,EAAE,OAAO,CAAC,CACjC,EAEA,OAAW,CAACsD,EAAcC,CAAa,IAAK,OAAO,QACjDV,EAAe,MAAM,OAAO,SAC9B,EAAG,CACD,GAAI,OAAOS,GAAiB,SAC1B,SAGF,IAAME,EAAsBH,EAAoB,UAAUE,CAAa,EAMvE,GAJI,CAACC,EAAoB,SAKvBJ,GAAuB,KACpBlF,GACCA,EAAK,OAAS,UACdA,EAAK,OAAS,aACdA,EAAK,SAAWoF,CACpB,EAEA,SAGF,IAAMG,EAAe1G,EAAQ,OAAO,CAClC,KAAM,YACN,OAAQuG,EACR,MAAO,CAAC,EACR,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,GAAO,CACxD,CAAC,EAED,OAAW,CAAChC,EAAKoC,CAAM,IAAK,OAAO,QAAQF,EAAoB,IAAI,EAAG,CACpE,IAAM9D,EAAO3C,EAAQ,KAAK,CACxB,SAAUuE,EACV,MAAO,OAAO,QAAQoC,CAAM,EAAE,IAAI,CAAC,CAACpC,EAAKvC,CAAK,IAC5ChC,EAAQ,KAAK,CACX,KAAMuE,EACN,MAAAvC,EACA,KAAM,CAAE,UAAW,GAAM,OAAQ;AAAA,QAAY,QAAS,IAAK,CAC7D,CAAC,CACH,EACA,KAAM,CAAE,UAAW,GAAM,QAAS,IAAK,OAAQ;AAAA,KAAS,CAC1D,CAAC,EACD0E,EAAa,OAAO/D,CAAI,EAG1BsC,EAAU,OAAOyB,CAAY,EAC7BzB,EAAU,aACRyB,EACA1G,EAAQ,QAAQ,CAAE,KAAM,aAAc,CAAC,CACzC,EAEJ,CACF,CACF,CAEA,SAAS+D,GACP+B,EACA,CACA,MAAO,CACL,cAAe,mCACf,KAAKjF,EAAY,CACf,GAAI,CAACiF,GAAgB,OAAO,QAAQ,UAClC,OAGF,IAAMb,EAAYC,GAAgBrE,CAAI,EAChC+F,EAAyB3B,EAAU,OAAO,OAC7C9D,GACCA,EAAK,OAAS,QAAUA,EAAK,KAAK,WAAW,YAAY,CAC7D,EAEM0F,EAAuB5D,EAC1B,OAAOA,EAAE,OAAO,EAAGA,EAAE,OAAO,CAAC,EAC7B,UAAU6C,EAAe,MAAM,OAAO,SAAS,EAClD,GAAKe,EAAqB,QAI1B,OAAW,CAACtC,EAAKvC,CAAK,IAAK,OAAO,QAAQ6E,EAAqB,IAAI,EAAG,CACpE,IAAM9E,EAAO,aAAawC,IAC1B,GACEqC,GAAwB,KACrBzF,GAAsCA,EAAK,OAASY,CACvD,EAEA,SAGF,IAAM+E,EAAgB9G,EAAQ,KAAK,CACjC,KAAA+B,EACA,MAAAC,EACA,KAAM,CAAE,UAAW,GAAM,QAAS,KAAM,OAAQ;AAAA,GAAO,CACzD,CAAC,EACDiD,EAAU,OAAO6B,CAAa,EAElC,CACF,CACF,CAEA,SAASd,GAAanF,EAAiC,CAIrD,OAHkBA,EAAK,MAAM,CAAC,EACR,SAAS,EAEvB,SAAS,GAAG,EACX,SAEF,QACT,CAEO,SAASsE,GAAgBnD,EAAe,CAC7C,GACEA,EAAM,WAAW,KAAK,GACtBA,EAAM,WAAW,KAAK,GACtBA,EAAM,WAAW,GAAG,GACpBA,EAAM,WAAW,OAAO,EAExB,MAAO,GAGT,IAAM+E,EAAS/E,EAAM,MAAM,GAAG,EAE9B,OACE+E,EAAO,SAAW,GAClBA,EAAO,MAAM,EAAG,CAAC,EAAE,MAAOC,GAAUA,EAAM,SAAS,GAAG,CAAC,CAE3D,CAEO,SAASvB,GAAazD,EAAe,CAC1C,OACEA,EAAM,WAAW,KAAK,GACtBA,EAAM,WAAW,KAAK,GACtBA,EAAM,WAAW,GAAG,GACpBA,EAAM,WAAW,OAAO,CAE5B,CCr4BA,OAAS,UAAAiF,OAAc,YAEvB,eAAsBC,GACpBC,EACA,CAAE,aAAAC,CAAa,EAAgC,CAC7C,aAAc,EAChB,EACmD,CACnD,IAAMC,EAAiB,MAAMJ,GAAO,CAAE,aAAc,GAAM,IAAKE,CAAU,CAAC,EAE1E,GAAIE,IAAmB,aAAc,MAAO,OAC5C,GAAIA,IAAmB,SAAU,MAAO,OACxC,GAAIA,IAAmB,MAAO,MAAO,MACrC,GAAIA,IAAmB,OAAQ,MAAO,OACtC,GAAI,CAACD,EACH,OAAOC,GAAkB,MAI3B,IAAMC,EAAY,QAAQ,IAAI,uBAAyB,GAEvD,OAAIA,EAAU,WAAW,MAAM,EACtB,OAGLA,EAAU,WAAW,MAAM,EACtB,OAGLA,EAAU,WAAW,KAAK,EACrB,MAGF,KACT,CC5BA,OAAS,SAAAC,MAAa,QACtB,OAAOC,OAAa,UAEpB,eAAsBC,EACpBC,EACAC,EACAxH,EACA5B,EAGA,CAIA,GAHAmJ,EAAe,MAAM,KAAK,IAAI,IAAIA,CAAY,CAAC,EAC/CC,EAAkB,MAAM,KAAK,IAAI,IAAIA,CAAe,CAAC,EAEjD,CAACD,GAAc,QAAU,CAACC,GAAiB,OAC7C,OAGFpJ,EAAU,CACR,OAAQ,GACR,GAAGA,CACL,EAEA,IAAMqJ,EAAsBlJ,EAAQ,2BAA4B,CAC9D,OAAQH,EAAQ,MAClB,CAAC,GAAG,MAAM,EACJ8I,EAAiB,MAAMQ,GAAoC1H,CAAM,EAGnE2H,EAAO,GACX,GAAIC,GAAuB5H,CAAM,GAAKkH,IAAmB,MACvD,GAAI9I,EAAQ,OACVuJ,EAAO,YACF,CACLF,EAAoB,eAAe,EACnCjJ,EAAO,KACL;AAAA;AAAA;AAAA,CACF,EACA,IAAMqJ,EAAe,MAAMR,GAAQ,CACjC,CACE,KAAM,SACN,KAAM,OACN,QAAS,iCACT,QAAS,CACP,CAAE,MAAO,cAAe,MAAO,OAAQ,EACvC,CAAE,MAAO,yBAA0B,MAAO,kBAAmB,CAC/D,CACF,CACF,CAAC,EAEGQ,IACFF,EAAOE,EAAa,MAK1BJ,GAAqB,MAAM,EAE3B,MAAMK,GACJZ,EACAK,EACAC,EACAxH,EAAO,cAAc,IACrB2H,CACF,EAEAF,GAAqB,QAAQ,CAC/B,CAEA,SAASG,GAAuB5H,EAAgB,CAC9C,IAAMqD,EAAcC,EAAetD,EAAO,cAAc,IAAK,EAAK,EAElE,GAAI,CAACqD,GAAa,cAAc,MAC9B,MAAO,GAGT,IAAM0E,EAAa,kCAAkC,KACnD1E,EAAY,aAAa,KAC3B,EACM2E,EACJ3E,EAAY,aAAa,kBAAkB,GAAG,WAAW,GAAG,EAE9D,OAAO0E,GAAcC,CACvB,CAEA,eAAeN,GAAoC1H,EAAgB,CAIjE,OAHoBsD,EAAetD,EAAO,cAAc,IAAK,EAAK,GAC9D,cAAc,KAKT,OAGF+G,GAAkB/G,EAAO,cAAc,GAAG,CACnD,CAEA,eAAe8H,GACbZ,EAGAK,EACAC,EACAtI,EACAyI,EACA,CACA,GAAIT,IAAmB,MACrB,OAAOe,GAAeV,EAAcC,EAAiBtI,EAAKyI,CAAI,EAGhE,GAAIT,IAAmB,OACrB,OAAOgB,GAAgBX,EAAcC,EAAiBtI,CAAG,EAG3D,GAAIgI,IAAmB,OACrB,OAAOiB,GAAgBZ,EAAcC,EAAiBtI,CAAG,EAGvDqI,GAAc,QAChB,MAAMH,EAAMF,EAAgB,CAAC,MAAO,GAAGK,CAAY,EAAG,CACpD,IAAArI,CACF,CAAC,EAGCsI,GAAiB,QACnB,MAAMJ,EAAMF,EAAgB,CAAC,MAAO,KAAM,GAAGM,CAAe,EAAG,CAAE,IAAAtI,CAAI,CAAC,CAE1E,CAEA,eAAe+I,GACbV,EACAC,EACAtI,EACAyI,EACA,CACIJ,EAAa,QACf,MAAMH,EACJ,MACA,CAAC,UAAW,GAAIO,EAAO,CAAC,KAAKA,GAAM,EAAI,CAAC,EAAI,GAAGJ,CAAY,EAC3D,CAAE,IAAArI,CAAI,CACR,EAGEsI,EAAgB,QAClB,MAAMJ,EACJ,MACA,CAAC,UAAW,GAAIO,EAAO,CAAC,KAAKA,GAAM,EAAI,CAAC,EAAI,KAAM,GAAGH,CAAe,EACpE,CAAE,IAAAtI,CAAI,CACR,CAEJ,CAEA,eAAegJ,GACbX,EACAC,EACAtI,EACA,CACIqI,GAAc,QAChB,MAAMH,EAAM,OAAQ,CAAC,MAAO,GAAGG,EAAa,IAAKa,GAAQ,OAAOA,GAAK,CAAC,EAAG,CACvE,IAAAlJ,CACF,CAAC,EAGCsI,GAAiB,QACnB,MAAMJ,EACJ,OACA,CAAC,MAAO,KAAM,GAAGI,EAAgB,IAAKY,GAAQ,OAAOA,GAAK,CAAC,EAC3D,CAAE,IAAAlJ,CAAI,CACR,CAEJ,CAEA,eAAeiJ,GACbZ,EACAC,EACAtI,EACA,CACIqI,EAAa,QACf,MAAMH,EAAM,MAAO,CAAC,OAAQ,UAAW,GAAGG,CAAY,EAAG,CAAE,IAAArI,CAAI,CAAC,EAG9DsI,EAAgB,QAClB,MAAMJ,EAAM,MAAO,CAAC,OAAQ,UAAW,QAAS,GAAGI,CAAe,EAAG,CACnE,IAAAtI,CACF,CAAC,CAEL,CCjMA,OAAS,cAAAmJ,GAAY,YAAY1K,OAAU,KAC3C,OAAOC,OAAU,OCDjB,OAAS,cAAAyK,OAAkB,KAC3B,OAAOzK,OAAU,OAEV,SAAS0K,EAAUC,EAAkB,CAC1C,IAAMC,EAAW5K,GAAK,SAAS2K,CAAQ,EACvC,MAAO,eAAe,KAAKC,CAAQ,CACrC,CAMO,SAASC,GAAoBzB,EAAmB,CACrD,IAAM0B,EAAW,CACf,aACA,OACA,yBACA,kBACF,EAEA,QAAWC,KAAWD,EAAU,CAC9B,IAAMH,EAAW3K,GAAK,KAAKoJ,EAAW2B,CAAO,EAC7C,GAAIN,GAAWE,CAAQ,EACrB,OAAOA,EAIX,OAAO,IACT,CAKO,SAASK,GAAgBC,EAAiB,CAC/C,IAAMC,EAAQD,EAAQ,MAAM;AAAA,CAAI,EAC1BE,EAA8B,CAAC,EAErC,QAAWC,KAAQF,EAAO,CACxB,IAAMG,EAAUD,EAAK,KAAK,EAE1B,GAAI,CAACC,GAAWA,EAAQ,WAAW,GAAG,EACpC,SAIF,IAAMC,EAAaD,EAAQ,QAAQ,GAAG,EACtC,GAAIC,IAAe,GACjB,SAGF,IAAM9E,EAAM6E,EAAQ,UAAU,EAAGC,CAAU,EAAE,KAAK,EAC5CrH,EAAQoH,EAAQ,UAAUC,EAAa,CAAC,EAAE,KAAK,EAEjD9E,IACF2E,EAAI3E,CAAG,EAAIvC,EAAM,QAAQ,eAAgB,EAAE,GAI/C,OAAOkH,CACT,CAKO,SAASI,GAAcC,EAAyBC,EAAoB,CACzE,IAAMC,EAAcV,GAAgBQ,CAAe,EAC7CG,EAASX,GAAgBS,CAAU,EAEnCG,EAAU,CAAC,EACjB,QAAWpF,KAAO,OAAO,KAAKmF,CAAM,EAC5BnF,KAAOkF,GACXE,EAAQ,KAAKpF,CAAG,EAIpB,OAAOoF,CACT,CAMO,SAASC,GAAgBL,EAAyBC,EAAoB,CAC3E,IAAMC,EAAcV,GAAgBQ,CAAe,EAC7CG,EAASX,GAAgBS,CAAU,EAErCK,EAASN,EAAgB,QAAQ,EACjCM,GAAU,CAACA,EAAO,SAAS;AAAA,CAAI,IACjCA,GAAU;AAAA,GAGZ,IAAMF,EAAoB,CAAC,EAC3B,OAAW,CAACpF,EAAKvC,CAAK,IAAK,OAAO,QAAQ0H,CAAM,EACxCnF,KAAOkF,GACXE,EAAQ,KAAK,GAAGpF,KAAOvC,GAAO,EAIlC,OAAI2H,EAAQ,OAAS,GACfE,IACFA,GAAU;AAAA,GAEZA,GAAUF,EAAQ,KAAK;AAAA,CAAI,EACpBE,EAAS;AAAA,GAIdA,GAAU,CAACA,EAAO,SAAS;AAAA,CAAI,EAC1BA,EAAS;AAAA,EAGXA,CACT,CDlGA,eAAsBC,GACpBC,EACA5J,EACA5B,EAGA,CACA,GAAI,CAACwL,GAAW,OAAO,KAAKA,CAAO,EAAE,SAAW,EAC9C,MAAO,CACL,aAAc,CAAC,EACf,eAAgB,KAChB,eAAgB,IAClB,EAGFxL,EAAU,CACR,OAAQ,GACR,GAAGA,CACL,EAEA,IAAMyL,EAAatL,EAAQ,gCAAiC,CAC1D,OAAQH,EAAQ,MAClB,CAAC,GAAG,MAAM,EAEJ0L,EAAc9J,EAAO,cAAc,IAGrC+J,EAAcnM,GAAK,KAAKkM,EAAa,YAAY,EAC/CE,EAAkBvB,GAAoBqB,CAAW,EAEnDE,IACFD,EAAcC,GAGhB,IAAMC,EAAgB5B,GAAW0B,CAAW,EACtCG,EAActM,GAAK,SAASmM,CAAW,EAGvCI,EAAgB,OAAO,QAAQP,CAAO,EACzC,IAAI,CAAC,CAACxF,EAAKvC,CAAK,IAAM,GAAGuC,KAAOvC,GAAO,EACvC,KAAK;AAAA,CAAI,EAERuI,EAAyB,CAAC,EAC1BC,EAAgC,KAChCC,EAAgC,KAEpC,GAAIL,EAAe,CACjB,IAAMb,EAAkB,MAAMzL,GAAG,SAASoM,EAAa,OAAO,EACxDQ,EAAgBd,GAAgBL,EAAiBe,CAAa,EAGpE,GAFAC,EAAejB,GAAcC,EAAiBe,CAAa,EAEvDC,EAAa,OAAS,GAQxB,GAPA,MAAMzM,GAAG,UAAUoM,EAAaQ,EAAe,OAAO,EACtDF,EAAiBzM,GAAK,SAASkM,EAAaC,CAAW,EAEvDF,GAAY,QACV,oCAAoCpL,EAAY,KAAKyL,CAAW,IAClE,EAEI,CAAC9L,EAAQ,OACX,QAAWgG,KAAOgG,EAChB5L,EAAO,IAAI,KAAKC,EAAY,QAAQ,GAAG,KAAK2F,GAAK,OAIrDyF,GAAY,KAAK,UAInB,MAAMlM,GAAG,UAAUoM,EAAaI,EAAgB;AAAA,EAAM,OAAO,EAC7DG,EAAiB1M,GAAK,SAASkM,EAAaC,CAAW,EACvDK,EAAe,OAAO,KAAKR,CAAO,EAElCC,GAAY,QACV,oCAAoCpL,EAAY,KAAKyL,CAAW,IAClE,EAEI,CAAC9L,EAAQ,OACX,QAAWgG,KAAOgG,EAChB5L,EAAO,IAAI,KAAKC,EAAY,QAAQ,GAAG,KAAK2F,GAAK,EAKvD,MAAI,CAAChG,EAAQ,QAAUgM,EAAa,OAAS,GAC3C5L,EAAO,MAAM,EAGR,CACL,aAAA4L,EACA,eAAAC,EACA,eAAAC,CACF,CACF,CE3GA,OAAS,cAAAjC,GAAY,YAAY1K,MAAU,KAC3C,OAAS,UAAA6M,OAAc,KACvB,OAAO5M,GAAQ,YAAA6M,OAAgB,OCF/B,OAAS,YAAY9M,OAAU,KAC/B,OAAS,UAAA6M,OAAc,KACvB,OAAO5M,OAAU,OCAjB,OAAqB,cAAA8M,OAAkB,WAGhC,IAAMxH,GAAgC,MAAO,CAClD,WAAAyH,EACA,OAAA3K,EACA,UAAA4K,CACF,KAEM5K,EAAO,UAAU,cAAgB,CAAC4K,GAAW,cAqBjDD,EAAW,qBAAqBD,GAAW,aAAa,EAAE,QAAS1J,GAAS,CAC1E,IAAMa,EAAQb,EAAK,QAAQ,EAC3B,GAAIa,EAAO,CACT,IAAMgJ,EAAwBC,GAC5BjJ,EAAM,QAAQ,KAAM,EAAE,EACtB+I,EAAU,YACZ,EACA5J,EAAK,gBAAgB,IAAI6J,EAAsB,KAAK,IAAI,EAE5D,CAAC,EAEMF,GA+DF,SAASI,GAAeC,EAAsC,CACnE,GAAI,CAACA,EAAU,SAAS,GAAG,GAAK,CAACA,EAAU,SAAS,GAAG,EACrD,MAAO,CAAC,KAAMA,EAAW,IAAI,EAG/B,IAAMC,EAA2B,CAAC,EAE9B,CAACC,EAAMC,CAAK,EAAIH,EAAU,MAAM,GAAG,EAGvC,GAAI,CAACE,EAAK,SAAS,GAAG,EACpB,MAAO,CAAC,KAAMA,EAAMC,CAAK,EAI3B,IAAMC,EAAQF,EAAK,MAAM,GAAG,EAGtBpK,EAAOsK,EAAM,IAAI,EAGjBzC,EAAUyC,EAAM,KAAK,GAAG,EAG9B,OAAAH,EAAM,KAAKtC,GAAW,KAAM7H,GAAQ,KAAMqK,GAAS,IAAI,EAEhDF,CACT,CAEA,IAAMI,GAAW,CAAC,MAAO,QAAS,UAAW,eAAgB,OAAO,EAE7D,SAASP,GACdvK,EACA+K,EACA,CAEI/K,EAAM,SAAS,UAAU,IAC3BA,EAAQA,EAAM,QAAQ,WAAY,wBAAwB,GAI5D,IAAMgL,EAAahL,EAAM,MAAM,GAAG,EAC5BiL,EAAY,IAAI,IAChBC,EAAW,IAAI,IACrB,QAAST,KAAaO,EAAY,CAChC,GAAM,CAAC5C,EAAS9G,EAAO6J,CAAQ,EAAIX,GAAeC,CAAS,EACrDW,EAASN,GAAS,KAAMM,GAAW9J,GAAO,WAAW8J,CAAM,CAAC,EAClE,GAAI,CAACA,EAAQ,CACNH,EAAU,IAAIR,CAAS,GAC1BQ,EAAU,IAAIR,CAAS,EAEzB,SAGF,IAAMY,EAAS/J,GAAO,QAAQ8J,EAAQ,EAAE,EACxC,GAAIC,GAAUA,KAAUN,EAAQ,MAAO,CACrCE,EAAU,IACR,CAAC7C,EAAS,GAAGgD,IAASL,EAAQ,MAAMM,CAAM,GAAG,EAC1C,OAAO,OAAO,EACd,KAAK,GAAG,GAAKF,EAAW,IAAIA,IAAa,GAC9C,EAEAD,EAAS,IACP,CAAC,OAAQ9C,EAAS,GAAGgD,IAASL,EAAQ,KAAKM,CAAM,GAAG,EACjD,OAAO,OAAO,EACd,KAAK,GAAG,GAAKF,EAAW,IAAIA,IAAa,GAC9C,EACA,SAGGF,EAAU,IAAIR,CAAS,GAC1BQ,EAAU,IAAIR,CAAS,EAI3B,MAAO,CAAC,GAAG,MAAM,KAAKQ,CAAS,EAAG,GAAG,MAAM,KAAKC,CAAQ,CAAC,EAAE,KAAK,GAAG,EAAE,KAAK,CAC5E,CCtLO,IAAMI,EAAiB,CAC5B,OAAQ,CACN,KAAM,eACN,QAAS,eACT,OAAQ,cACV,EACA,MAAO,CACL,KAAM,wBACN,QAAS,wBACT,OAAQ,uBACV,CACF,ECRA,OAAqB,cAAAnB,OAAkB,WAGvC,IAAMoB,GAAiB,SAEVC,GAA8B,MAAO,CAAE,WAAApB,EAAY,OAAA3K,CAAO,IAAM,CAE3E,GAAI,CAACA,EAAO,aAAe,EAAEA,EAAO,eAAe6L,GACjD,OAAOlB,EAGT,IAAMqB,EAAgB,MAAMC,GAAiB,EACvCC,EAAgBJ,GAChBK,EAAgBnM,EAAO,YAE7B,GAAIkM,IAAkBC,EACpB,OAAOxB,EAGT,IAAIyB,EAA0B,CAAC,EAC/B,QAAWC,KAAqB1B,EAAW,sBAAsB,GAAK,CAAC,EACrE,GACE0B,EAAkB,mBAAmB,GAAG,QAAQ,IAChD,IAAIR,EAAeC,EAAc,EAAE,UAKrC,SAAWQ,KAAaD,EAAkB,gBAAgB,GAAK,CAAC,EAAG,CACjE,IAAME,EAAWD,EAAU,QAAQ,EAE7BE,EAAeR,EAAcO,CAAQ,IAAIJ,CAAa,EAExD,CAACK,GAAgBJ,EAAc,SAASI,CAAY,IAIxDJ,EAAc,KAAKI,CAAY,EAG/BF,EAAU,OAAO,EAGjB3B,EACG,qBAAqBD,GAAW,qBAAqB,EACrD,OAAQ1J,GAASA,EAAK,eAAe,GAAG,QAAQ,IAAMuL,CAAQ,EAC9D,QAASvL,GAASA,EAAK,eAAe,GAAG,gBAAgBwL,CAAY,CAAC,GAIvEH,EAAkB,gBAAgB,GAAG,SAAW,GAClDA,EAAkB,OAAO,EAI7B,GAAID,EAAc,OAAS,EAAG,CAC5B,IAAMK,EAAwB9B,EAAW,qBAAqB,CAC5D,gBACEkB,EAAeM,CAA4C,GAAG,OAChE,aAAcC,EAAc,IAAKM,IAAU,CACzC,KAAMA,CACR,EAAE,CACJ,CAAC,EAEIC,GAAchC,CAAU,GAC3B8B,EAAsB,gBACpBA,EAAsB,QAAQ,EAAE,QAAQ,IAAK,EAAE,CACjD,EAIJ,OAAO9B,CACT,EAEA,SAASgC,GAAchC,EAAwB,CAC7C,OACEA,EAAW,sBAAsB,IAAI,CAAC,GAAG,QAAQ,EAAE,SAAS,GAAG,GAAK,EAExE,CC9EO,IAAMiC,GAA+B,MAAO,CACjD,WAAAjC,EACA,OAAA3K,EACA,SAAA6M,CACF,IAAM,CAEJ,IAAMC,EAAc,IADG9M,EAAO,SAAS,OAAO,MAAM,GAAG,EAAE,CAAC,GAAG,MAAM,CAAC,cAG9D+M,EAAqBpC,EAAW,sBAAsB,EAE5D,GAAI,CAAC,CAAC,OAAQ,MAAO,OAAQ,KAAK,EAAE,SAASA,EAAW,aAAa,CAAC,EACpE,OAAOA,EAGT,QAAW0B,KAAqBU,EAAoB,CAClD,IAAMC,EAAkBC,GACtBZ,EAAkB,wBAAwB,EAC1CrM,EACA6M,CACF,EAEAR,EAAkB,mBAAmBW,CAAe,GAGhDF,IAAgBE,GAAmBA,IAAoB,gBACpCX,EAAkB,gBAAgB,EACzB,KAAMa,GAAMA,EAAE,QAAQ,IAAM,IAAI,GAE5Db,EAAkB,mBAChBS,IAAgBE,EACZA,EAAgB,QAAQF,EAAa9M,EAAO,QAAQ,KAAK,EACzDA,EAAO,QAAQ,KACrB,EAKN,OAAO2K,CACT,EAEA,SAASsC,GACPD,EACAhN,EACA6M,EAAoB,GACpB,CAEA,GAAI,CAACG,EAAgB,WAAW,IAAI,GAAK,CAACH,EACxC,OAAOG,EAST,GALIH,GAAYG,EAAgB,WAAW,IAAI,IAC7CA,EAAkBA,EAAgB,QAAQ,OAAQ,sBAAsB,GAItE,CAACA,EAAgB,WAAW,aAAa,EAAG,CAE9C,IAAMG,EAAQnN,EAAO,QAAQ,WAAW,MAAM,GAAG,EAAE,CAAC,EACpD,OAAOgN,EAAgB,QAAQ,OAAQ,GAAGG,IAAQ,EAGpD,OAAIH,EAAgB,MAAM,wBAAwB,EACzCA,EAAgB,QACrB,yBACAhN,EAAO,QAAQ,IAAM,GAAGA,EAAO,QAAQ,eACzC,EAIAA,EAAO,QAAQ,YACfgN,EAAgB,MAAM,gCAAgC,EAE/CA,EAAgB,QACrB,iCACAhN,EAAO,QAAQ,UACjB,EAGEA,EAAO,QAAQ,KAAOgN,EAAgB,MAAM,yBAAyB,EAChEA,EAAgB,QACrB,0BACAhN,EAAO,QAAQ,GACjB,EAIAA,EAAO,QAAQ,OACfgN,EAAgB,MAAM,2BAA2B,EAE1CA,EAAgB,QACrB,4BACAhN,EAAO,QAAQ,KACjB,EAGKgN,EAAgB,QACrB,sBACAhN,EAAO,QAAQ,UACjB,CACF,CCtGA,OAAS,wBAAAoN,OAA4B,cACrC,OAAwB,SAAAC,OAAa,gBAErC,OAAOC,OAAyB,qCAChC,UAAYC,OAAY,SAUxB,IAAMC,GAA+B,CACnC,WAAY,SACZ,4BAA6B,GAC7B,2BAA4B,GAC5B,UAAW,EACX,OAAQ,GACR,QAAS,CACP,kBACA,SACA,sBACA,yBACA,kBACA,mBACA,UACA,oBACA,gBACA,gBACA,oBACA,sBACA,eACA,eACA,mBACA,aACA,4BACA,mBACA,mBACA,uBACA,mBACA,CACE,mBACA,CACE,SAAU,SACZ,CACF,EACA,CACE,iBACA,CACE,WAAY,MACd,CACF,EACA,mBACA,gBACA,cACA,aACA,KACF,CACF,EAEaC,GAAoC,MAAO,CACtD,WAAA9C,EACA,OAAA3K,CACF,IAAM,CACJ,IAAMK,EAASsK,EAAW,YAAY,EAEtC,GAAI3K,EAAO,IACT,OAAOK,EAGT,IAAMqN,EAAa,SAAMrN,EAAQ,CAC/B,OAAQ,CACN,MAAQsN,GACCN,GAAMM,EAAMH,EAAa,CAEpC,CACF,CAAC,EAEK9D,EAAS0D,GAAqBM,EAAKrN,EAAQ,CAC/C,cAAe,GACf,KAAM,GACN,IAAK,GACL,QAAS,CAACiN,EAAmB,EAC7B,WAAY,EACd,CAAC,EAED,GAAI,CAAC5D,GAAU,CAACA,EAAO,IACrB,MAAM,IAAI,MAAM,yBAAyB,EAG3C,OAAc,SAAMA,EAAO,GAAG,EAAE,IAClC,EC7FA,OAAS,cAAAgB,OAAkB,WAE3B,IAAMkD,GAAiB,wBAEVC,GAA4B,MAAO,CAAE,WAAAlD,EAAY,OAAA3K,CAAO,IAAM,CACzE,GAAIA,EAAO,IACT,OAAO2K,EAIT,IAAMmD,EAAQnD,EAAW,oBAAoBD,GAAW,mBAAmB,EAC3E,OAAIoD,GAASF,GAAe,KAAKE,EAAM,QAAQ,CAAC,GAC9CA,EAAM,OAAO,EAGRnD,CACT,ENPA,OAAS,WAAAoD,GAAS,cAAAC,OAAmC,WOTrD,OAAS,cAAAtD,MAAkB,WAQpB,IAAMuD,GAAmC,MAAO,CACrD,WAAAtD,EACA,OAAA3K,CACF,IAAM,CACJ,GAAI,CAACA,EAAO,UAAU,OACpB,OAAO2K,EAET,IAAM5G,EAAkB,MAAMmK,EAAoClO,CAAM,EAGxE,OAAA2K,EACG,qBAAqBD,EAAW,cAAc,EAC9C,OAAQ1J,GAASA,EAAK,cAAc,EAAE,QAAQ,IAAM,KAAK,EACzD,QAASA,GAAS,CAEjB,GAAIA,EAAK,aAAa,EAAE,CAAC,GAAG,OAAO0J,EAAW,aAAa,EAAG,CAC5D,IAAMyD,EAAoBnN,EAAK,aAAa,EAAE,CAAC,EAC3CmN,GACFA,EAAkB,gBAChB,IAAIC,EACFD,EAAkB,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EAC/CnO,EAAO,SAAS,OAChB+D,CACF,IACF,EAKA/C,EAAK,aAAa,EAAE,CAAC,GAAG,OAAO0J,EAAW,uBAAuB,GACnE1J,EACG,aAAa,EAAE,CAAC,GACf,qBAAqB0J,EAAW,kBAAkB,EACnD,KAAM1J,GAASA,EAAK,QAAQ,IAAM,UAAU,GAC3C,qBAAqB0J,EAAW,kBAAkB,EACnD,QAAS1J,GAAS,CACjBA,EACG,qBAAqB0J,EAAW,kBAAkB,EAClD,QAAS1J,GAAS,CACjB,IAAMuK,EAAavK,EAAK,qBACtB0J,EAAW,aACb,EACIa,GACFA,GAAY,gBACV,IAAI6C,EACF7C,EAAW,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EACxCvL,EAAO,SAAS,OAChB+D,CACF,IACF,CAEJ,CAAC,CACL,CAAC,CAEP,CAAC,EAGH4G,EAAW,qBAAqBD,EAAW,YAAY,EAAE,QAAS1J,GAAS,CACzE,GAAIA,EAAK,QAAQ,IAAM,YAAa,CAElC,GAAIA,EAAK,eAAe,GAAG,OAAO0J,EAAW,aAAa,EAAG,CAC3D,IAAM7I,EAAQb,EAAK,eAAe,EAC9Ba,GACFA,EAAM,gBACJ,IAAIuM,EACFvM,EAAM,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EACnC7B,EAAO,SAAS,OAChB+D,CACF,IACF,EAKJ,GAAI/C,EAAK,eAAe,GAAG,OAAO0J,EAAW,aAAa,EAAG,CAE3D,IAAM2D,EAAiBrN,EACpB,eAAe,GACd,qBAAqB0J,EAAW,cAAc,EAC/C,KAAM1J,GAASA,EAAK,cAAc,EAAE,QAAQ,IAAM,IAAI,EACrDqN,GAEFA,EAAe,aAAa,EAAE,QAASrN,GAAS,EAE5CA,EAAK,OAAO0J,EAAW,qBAAqB,GAC5C1J,EAAK,OAAO0J,EAAW,gBAAgB,IAEvC1J,EACG,kBAAkB0J,EAAW,aAAa,EAC1C,QAAS1J,GAAS,CACjBA,EAAK,gBACH,IAAIoN,EACFpN,EAAK,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EAClChB,EAAO,SAAS,OAChB+D,CACF,IACF,CACF,CAAC,EAGD/C,EAAK,OAAO0J,EAAW,aAAa,GACtC1J,EAAK,gBACH,IAAIoN,EACFpN,EAAK,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EAClChB,EAAO,SAAS,OAChB+D,CACF,IACF,CAEJ,CAAC,GAMH/C,EAAK,QAAQ,IAAM,cACjBA,EAAK,eAAe,GAAG,OAAO0J,EAAW,aAAa,GACxD1J,EACG,qBAAqB0J,EAAW,kBAAkB,EAClD,QAAS1J,GAAS,CACjB,GAAIA,EAAK,eAAe,GAAG,OAAO0J,EAAW,cAAc,EAAG,CAC5D,IAAM2D,EAAiBrN,EAAK,qBAC1B0J,EAAW,cACb,EACI2D,GAEFA,EAAe,aAAa,EAAE,QAASC,GAAQ,CACzCA,EAAI,OAAO5D,EAAW,qBAAqB,GAC7C4D,EACG,kBAAkB5D,EAAW,aAAa,EAC1C,QAAS1J,GAAS,CACjBA,EAAK,gBACH,IAAIoN,EACFpN,EAAK,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EAClChB,EAAO,SAAS,OAChB+D,CACF,IACF,CACF,CAAC,EAGDuK,EAAI,OAAO5D,EAAW,aAAa,GACrC4D,EAAI,gBACF,IAAIF,EACFE,EAAI,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EACjCtO,EAAO,SAAS,OAChB+D,CACF,IACF,CAEJ,CAAC,EAIL,GAAI/C,EAAK,eAAe,GAAG,OAAO0J,EAAW,aAAa,GACpD1J,EAAK,QAAQ,IAAM,UAAW,CAChC,IAAMuK,EAAavK,EAAK,eAAe,EACnCuK,GACFA,EAAW,gBACT,IAAI6C,EACF7C,EAAW,QAAQ,GAAG,QAAQ,OAAQ,EAAE,EACxCvL,EAAO,SAAS,OAChB+D,CACF,IACF,EAIR,CAAC,CAGT,CAAC,EAEM4G,CACT,EAEO,SAASyD,EACd7N,EACAoL,EAAiB,GACjB5H,EACA,CACA,OAAIA,IAAoB,KACfxD,EACJ,MAAM,GAAG,EACT,IAAKyK,GAAc,CAClB,GAAM,CAACrC,EAAS9G,EAAO6J,CAAQ,EAAIX,GAAeC,CAAS,EAC3D,OAAIrC,EACK+C,EACH,GAAG/C,KAAWgD,IAAS9J,KAAS6J,IAChC,GAAG/C,KAAWgD,IAAS9J,IAEpB6J,EACH,GAAGC,IAAS9J,KAAS6J,IACrB,GAAGC,IAAS9J,GAEpB,CAAC,EACA,KAAK,GAAG,EAGNtB,EACJ,MAAM,GAAG,EACT,IAAKyK,GACJA,EAAU,QAAQ,GAAGW,IAAS,IAAM,EAChCX,EACA,GAAGW,KAAUX,EAAU,KAAK,GAClC,EACC,KAAK,GAAG,CACb,CP1LA,IAAMuD,GAAU,IAAIR,GAAQ,CAC1B,gBAAiB,CAAC,CACpB,CAAC,EAED,eAAeS,GAAqBC,EAAkB,CACpD,IAAMC,EAAM,MAAM/Q,GAAG,QAAQC,GAAK,KAAK4M,GAAO,EAAG,SAAS,CAAC,EAC3D,OAAO5M,GAAK,KAAK8Q,EAAKD,CAAQ,CAChC,CAEA,eAAsBE,GACpBC,EACAC,EAA8B,CAC5BjC,GACAiB,GACA3K,GACA+K,GACAlC,EACF,EACA,CACA,IAAM+C,EAAW,MAAMN,GAAqBI,EAAK,QAAQ,EACnDjE,EAAa4D,GAAQ,iBAAiBO,EAAUF,EAAK,IAAK,CAC9D,WAAYZ,GAAW,GACzB,CAAC,EAED,QAAWe,KAAeF,EACxB,MAAME,EAAY,CAAE,WAAApE,EAAY,GAAGiE,CAAK,CAAC,EAG3C,OAAIA,EAAK,aACA,MAAMnB,GAAa,CACxB,WAAA9C,EACA,GAAGiE,CACL,CAAC,EAGIjE,EAAW,QAAQ,CAC5B,CD1CA,OAAOtD,OAAa,UACpB,OAAS,WAAA0G,GAAS,cAAAC,OAAkB,WACpC,OAAS,cAAAgB,OAAkB,iBAG3B,eAAsBC,GACpBC,EACAlP,EACA5B,EAOA,CACA,GAAI,CAAC8Q,GAAO,OACV,MAAO,CACL,aAAc,CAAC,EACf,aAAc,CAAC,EACf,aAAc,CAAC,CACjB,EAEF9Q,EAAU,CACR,UAAW,GACX,MAAO,GACP,OAAQ,GACR,SAAU,GACV,GAAGA,CACL,EACA,IAAM+Q,EAAsB5Q,EAAQ,kBAAmB,CACrD,OAAQH,EAAQ,MAClB,CAAC,GAAG,MAAM,EAEJ,CAACO,EAAaiM,CAAS,EAAI,MAAM,QAAQ,IAAI,CACjDhM,EAAeoB,EAAO,cAAc,GAAG,EACvCA,EAAO,SAAS,UACZoP,GAAqBpP,EAAO,SAAS,SAAS,EAC9C,QAAQ,QAAQ,MAAS,CAC/B,CAAC,EAEGqP,EAAyB,CAAC,EAC1BC,EAAyB,CAAC,EAC1BC,EAAyB,CAAC,EAC1BnF,EAAyB,CAAC,EAC1BoF,EAAyB,KAE7B,QAAWC,KAAQP,EAAO,CACxB,GAAI,CAACO,EAAK,QACR,SAGF,IAAIlH,EAAWmH,GAAgBD,EAAMzP,EAAQ,CAC3C,SAAUrB,GAAa,SACvB,UAAWA,GAAa,UAAU,KAClC,WAAYgR,GACVT,EAAM,IAAKU,GAAMA,EAAE,IAAI,EACvBH,EAAK,IACP,CACF,CAAC,EAED,GAAI,CAAClH,EACH,SAGF,IAAMC,EAAWiC,GAASgF,EAAK,IAAI,EAC7BzI,EAAYpJ,EAAK,QAAQ2K,CAAQ,EAQvC,GANKvI,EAAO,MACVuI,EAAWA,EAAS,QAAQ,UAAYsH,GACtCA,IAAU,OAAS,OAAS,KAC9B,GAGEvH,EAAUC,CAAQ,GAAK,CAACF,GAAWE,CAAQ,EAAG,CAChD,IAAMuH,EAAqBrH,GAAoBzB,CAAS,EACpD8I,IACFvH,EAAWuH,GAIf,IAAMC,EAAe1H,GAAWE,CAAQ,EAIlCM,EAAUP,EAAUC,CAAQ,EAC9BkH,EAAK,QACL,MAAMd,GACJ,CACE,SAAUc,EAAK,KACf,IAAKA,EAAK,QACV,OAAAzP,EACA,UAAA4K,EACA,aAAc,CAAC5K,EAAO,IACtB,SAAU5B,EAAQ,QACpB,EACA,CACEwO,GACAiB,GACA3K,GACA+K,GACAlC,EACF,CACF,EAIJ,GAAIgE,GAAgB,CAACzH,EAAUC,CAAQ,EAAG,CACxC,IAAMyH,EAAsB,MAAMrS,EAAG,SAAS4K,EAAU,OAAO,EACzD,CAAC0H,EAAoBC,CAAa,EAAI,MAAM,QAAQ,IAAI,CAC5DC,GAAyBH,CAAmB,EAC5CG,GAAyBtH,CAAO,CAClC,CAAC,EACD,GAAIoH,IAAuBC,EAAe,CACxCX,EAAa,KAAK3R,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,CAAC,EACnE,UAKJ,GAAIwH,GAAgB,CAAC3R,EAAQ,WAAa,CAACkK,EAAUC,CAAQ,EAAG,CAC9D4G,EAAoB,KAAK,EACrB/Q,EAAQ,aACVA,EAAQ,YAAY,KAAK,EAE3B,GAAM,CAAE,UAAAgS,CAAU,EAAI,MAAM/I,GAAQ,CAClC,KAAM,UACN,KAAM,YACN,QAAS,YAAY5I,EAAY,KAC/B+J,CACF,iDACA,QAAS,EACX,CAAC,EAED,GAAI,CAAC4H,EAAW,CACdb,EAAa,KAAK3R,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,CAAC,EAC/DnK,EAAQ,aACVA,EAAQ,YAAY,MAAM,EAE5B,SAEF+Q,GAAqB,MAAM,EACvB/Q,EAAQ,aACVA,EAAQ,YAAY,MAAM,EAU9B,GALKiK,GAAWrB,CAAS,GACvB,MAAMrJ,EAAG,MAAMqJ,EAAW,CAAE,UAAW,EAAK,CAAC,EAI3CsB,EAAUC,CAAQ,GAAKwH,EAAc,CACvC,IAAMC,EAAsB,MAAMrS,EAAG,SAAS4K,EAAU,OAAO,EACzDgC,EAAgBd,GAAgBuG,EAAqBnH,CAAO,EAIlE,GAHAuB,EAAejB,GAAc6G,EAAqBnH,CAAO,EACzD2G,EAAU5R,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,EAEtD,CAAC6B,EAAa,OAAQ,CACxBmF,EAAa,KAAK3R,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,CAAC,EACnE,SAGF,MAAM5K,EAAG,UAAU4K,EAAUgC,EAAe,OAAO,EACnD+E,EAAa,KAAK1R,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,CAAC,EACnE,SAGF,MAAM5K,EAAG,UAAU4K,EAAUM,EAAS,OAAO,EAGxCkH,EAQHT,EAAa,KAAK1R,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,CAAC,GAPnE8G,EAAa,KAAKzR,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,CAAC,EAE/DD,EAAUC,CAAQ,IACpB6B,EAAe,OAAO,KAAKxB,GAAgBC,CAAO,CAAC,EACnD2G,EAAU5R,EAAK,SAASoC,EAAO,cAAc,IAAKuI,CAAQ,IAOhE,IAAM8H,EAAW,CAAC,GAAGhB,EAAc,GAAGC,EAAc,GAAGC,CAAY,EAC7De,EAAe,MAAMC,GAAeF,EAAUrQ,CAAM,EAkB1D,GAfAsP,EAAa,KAAK,GAAGgB,CAAY,EAGjChB,EAAeA,EAAa,OAAQG,GAAS,CAACJ,EAAa,SAASI,CAAI,CAAC,EAGrE,EADoBJ,EAAa,QAAUC,EAAa,SACpC,CAACC,EAAa,QACpCJ,GAAqB,KAAK,mBAAmB,EAI/CE,EAAe,MAAM,KAAK,IAAI,IAAIA,CAAY,CAAC,EAC/CC,EAAe,MAAM,KAAK,IAAI,IAAIA,CAAY,CAAC,EAC/CC,EAAe,MAAM,KAAK,IAAI,IAAIA,CAAY,CAAC,EAE3CF,EAAa,QAMf,GALAF,GAAqB,QACnB,WAAWE,EAAa,UACtBA,EAAa,SAAW,EAAI,OAAS,UAEzC,EACI,CAACjR,EAAQ,OACX,QAAWqR,KAAQJ,EACjB7Q,EAAO,IAAI,OAAOiR,GAAM,OAI5BN,GAAqB,KAAK,EAG5B,GAAIG,EAAa,SACf/Q,EACE,WAAW+Q,EAAa,UACtBA,EAAa,SAAW,EAAI,OAAS,WAEvC,CACE,OAAQlR,EAAQ,MAClB,CACF,GAAG,KAAK,EACJ,CAACA,EAAQ,QACX,QAAWqR,KAAQH,EACjB9Q,EAAO,IAAI,OAAOiR,GAAM,EAK9B,GAAIF,EAAa,SACfhR,EACE,WAAWgR,EAAa,UACtBD,EAAa,SAAW,EAAI,OAAS,oEAEvC,CACE,OAAQlR,EAAQ,MAClB,CACF,GAAG,KAAK,EACJ,CAACA,EAAQ,QACX,QAAWqR,KAAQF,EACjB/Q,EAAO,IAAI,OAAOiR,GAAM,EAK9B,GAAIrF,EAAa,QAAUoF,IACzBjR,EACE,oCAAoCE,EAAY,KAAK+Q,CAAO,IAC9D,GAAG,KAAK,EACJ,CAACpR,EAAQ,QACX,QAAWgG,KAAOgG,EAChB5L,EAAO,IAAI,KAAKC,EAAY,QAAQ,GAAG,KAAK2F,GAAK,EAKvD,OAAKhG,EAAQ,QACXI,EAAO,MAAM,EAGR,CACL,aAAA6Q,EACA,aAAAC,EACA,aAAAC,CACF,CACF,CAEO,SAASG,GACdD,EACAzP,EACA5B,EAKA,CACA,GAAIqR,EAAK,OAAQ,CACf,GAAIA,EAAK,OAAO,WAAW,IAAI,EAC7B,OAAO7R,EAAK,KAAKoC,EAAO,cAAc,IAAKyP,EAAK,OAAO,QAAQ,KAAM,EAAE,CAAC,EAG1E,IAAIe,EAASf,EAAK,OAElB,OAAIA,EAAK,OAAS,kBAChBe,EAASC,GAAkBD,EAAQpS,EAAQ,SAAS,EAChD,CAACoS,GACI,GAIJpS,EAAQ,SACXR,EAAK,KAAKoC,EAAO,cAAc,IAAK,MAAOwQ,EAAO,QAAQ,OAAQ,EAAE,CAAC,EACrE5S,EAAK,KAAKoC,EAAO,cAAc,IAAKwQ,EAAO,QAAQ,OAAQ,EAAE,CAAC,EAGpE,IAAMxJ,EAAY0J,GAA2BjB,EAAMzP,CAAM,EAEnD2Q,EAAeC,GAAsBnB,EAAK,KAAMzI,CAAS,EAC/D,OAAOpJ,EAAK,KAAKoJ,EAAW2J,CAAY,CAC1C,CAEA,SAASD,GACPjB,EACAzP,EACA,CACA,OAAIyP,EAAK,OAAS,cACTzP,EAAO,cAAc,GAG1ByP,EAAK,OAAS,eACTzP,EAAO,cAAc,IAG1ByP,EAAK,OAAS,kBAAoBA,EAAK,OAAS,qBAC3CzP,EAAO,cAAc,WAG1ByP,EAAK,OAAS,gBACTzP,EAAO,cAAc,MAGvBA,EAAO,cAAc,UAC9B,CAEO,SAAS2P,GAAekB,EAAiBjF,EAAwB,CAEtE,IAAMkF,EAAkBD,EAAM,IAAKE,GAAMA,EAAE,QAAQ,MAAO,EAAE,CAAC,EACvDC,EAAmBpF,EAAO,QAAQ,MAAO,EAAE,EAG3CqF,EAAYD,EAAiB,MAAM,GAAG,EAAE,MAAM,EAAG,EAAE,EAAE,KAAK,GAAG,EAGnE,GAAI,CAACC,EACH,MAAO,GAIT,IAAMC,EAAiBD,EAAU,MAAM,GAAG,EAG1C,QAAS/D,EAAIgE,EAAe,OAAQhE,EAAI,EAAGA,IAAK,CAC9C,IAAMiE,EAAWD,EAAe,MAAM,EAAGhE,CAAC,EAAE,KAAK,GAAG,EAKpD,GAHwB4D,EAAgB,KACrClT,GAASA,IAASoT,GAAoBpT,EAAK,WAAWuT,EAAW,GAAG,CACvE,EAEE,MAAO,IAAMA,EAKjB,MAAO,IAAMF,CACf,CAEO,SAASL,GACdrI,EACAvB,EACQ,CAER,IAAMoK,EAAqB7I,EAAS,QAAQ,WAAY,EAAE,EACpD8I,EAAsBrK,EAAU,QAAQ,WAAY,EAAE,EAGtDsK,EAAeF,EAAmB,MAAM,GAAG,EAC3CG,EAAiBF,EAAoB,MAAM,GAAG,EAG9CG,EAAoBD,EAAeA,EAAe,OAAS,CAAC,EAC5DE,EAAiBH,EAAa,UACjCI,GAAYA,IAAYF,CAC3B,EAEA,OAAIC,IAAmB,GAEdH,EAAaA,EAAa,OAAS,CAAC,EAItCA,EAAa,MAAMG,EAAiB,CAAC,EAAE,KAAK,GAAG,CACxD,CAEA,eAAsBtB,GAAyBtH,EAAiB,CAC9D,OAAOA,EAAQ,QAAQ,QAAS;AAAA,CAAI,EAAE,KAAK,CAC7C,CAEO,SAAS4H,GACdD,EACAmB,EACA,CACA,GAAI,CAACA,EACH,MAAO,GAGT,GAAIA,IAAc,WAChB,OAAOnB,EAGT,GAAImB,IAAc,aAAc,CAC9B,IAAIjI,EAAS8G,EAAO,QAAQ,SAAU,QAAQ,EAC9C,OAAA9G,EAASA,EAAO,QAAQ,qBAAsB,IAAI,EAE3CA,EAGT,GAAIiI,IAAc,eAAgB,CAChC,IAAIjI,EAAS8G,EAAO,QAAQ,SAAU,aAAa,EACnD,OAAA9G,EAASA,EAAO,QAAQ,qBAAsB,IAAI,EAE3CA,EAGT,GAAIiI,IAAc,UAAW,CAC3B,IAAIjI,EAAS8G,EAAO,QAAQ,SAAU,qBAAqB,EAC3D,OAAA9G,EAASA,EAAO,QAAQ,qBAAsB,IAAI,EAE3CA,EAGT,MAAO,EACT,CAEA,eAAe6G,GAAeqB,EAAqB5R,EAAgB,CACjE,IAAMuO,EAAU,IAAIR,GAAQ,CAC1B,gBAAiB,CAAC,CACpB,CAAC,EACKpP,EAAc,MAAMC,EAAeoB,EAAO,cAAc,GAAG,EAC3D6R,EAAW7C,GAAWhP,EAAO,cAAc,GAAG,EAC9CsQ,EAAe,CAAC,EAEtB,GAAI,CAAC3R,GAAekT,EAAS,aAAe,SAC1C,MAAO,CAAC,EAGV,QAAWC,KAAYF,EAAW,CAChC,IAAMhS,EAAehC,EAAK,QAAQoC,EAAO,cAAc,IAAK8R,CAAQ,EAGpE,GAAI,CAACzJ,GAAWzI,CAAY,EAC1B,SAGF,IAAMiJ,EAAU,MAAMlL,EAAG,SAASiC,EAAc,OAAO,EAEjD8O,EAAM,MAAM/Q,EAAG,QAAQC,EAAK,KAAK4M,GAAO,EAAG,SAAS,CAAC,EACrDG,EAAa4D,EAAQ,iBACzB3Q,EAAK,KAAK8Q,EAAKjE,GAAS7K,CAAY,CAAC,EACrCiJ,EACA,CACE,WAAYmF,GAAW,GACzB,CACF,EAGA,GAAI,CAAC,CAAC,OAAQ,MAAO,OAAQ,KAAK,EAAE,SAASrD,EAAW,aAAa,CAAC,EACpE,SAGF,IAAMoC,EAAqBpC,EAAW,sBAAsB,EAC5D,QAAW0B,KAAqBU,EAAoB,CAClD,IAAMC,EAAkBX,EAAkB,wBAAwB,EAGlE,GACE1N,GAAa,aACb,CAACqO,EAAgB,WAAW,GAAGrO,EAAY,cAAc,EAEzD,SAKF,IAAMoT,EAAyB,MAAMC,GACnChF,EACA6E,CACF,EAEA,GAAI,CAACE,EACH,SAKF,IAAME,EAAyBC,GAC7BH,EACAH,EACA5R,CACF,EAEA,GAAI,CAACiS,EACH,SAIF,IAAME,EAAYC,GAChBH,EACAjS,EACArB,CACF,EAEI,CAACwT,GAAaA,IAAcnF,IAIhCX,EAAkB,mBAAmB8F,CAAS,EAG9C,MAAMxU,EAAG,UAAUiC,EAAc+K,EAAW,YAAY,EAAG,OAAO,EAGlE2F,EAAa,KAAKwB,CAAQ,IAI9B,OAAOxB,CACT,CAOO,SAAS4B,GACdH,EACA7C,EACAlP,EACAqS,EAAuB,CAAC,OAAQ,MAAO,MAAO,OAAQ,MAAM,EAC5D,CACA,IAAMnT,EAAMtB,EAAK,UAAUoC,EAAO,cAAc,GAAG,EAG7CsS,EAAgBpD,EAAM,IAAKU,GAAMA,EAAE,MAAMhS,EAAK,GAAG,EAAE,KAAKA,EAAK,MAAM,GAAG,CAAC,EACvE2U,EAAU,IAAI,IAAID,CAAa,EAG/BE,EAAY5U,EAAK,QAAQmU,CAAsB,EAC/CU,EAASD,IAAc,GACvBE,EAAUD,EACZV,EAAuB,MAAM,EAAG,CAACS,EAAU,MAAM,EACjDT,EAIEY,EADa/U,EAAK,SAASsB,EAAKwT,CAAO,EAClB,MAAM9U,EAAK,GAAG,EAAE,KAAKA,EAAK,MAAM,GAAG,EAGxDgV,EAAUH,EAAS,CAACD,CAAS,EAAIH,EAGjCQ,EAAa,IAAI,IAGvB,QAAWC,KAAKF,EAAS,CACvB,IAAMG,EAAUL,EAAUI,EACpBE,EAAUpV,EAAK,MAAM,UAAUA,EAAK,SAASsB,EAAK6T,CAAO,CAAC,GAC5DR,EAAQ,IAAIS,CAAO,GAAK3K,GAAW0K,CAAO,IAC5CF,EAAW,IAAIG,CAAO,EAGxB,IAAMC,EAASrV,EAAK,KAAK8U,EAAS,QAAQI,GAAG,EACvCI,EAAStV,EAAK,MAAM,UAAUA,EAAK,SAASsB,EAAK+T,CAAM,CAAC,GAC1DV,EAAQ,IAAIW,CAAM,GAAK7K,GAAW4K,CAAM,IAC1CJ,EAAW,IAAIK,CAAM,EAKzB,IAAMpS,EAAOlD,EAAK,SAAS8U,CAAO,EAClC,QAAW9C,KAAK0C,EACVM,EAAQ,KAAME,GAAMlD,EAAE,SAAS,IAAI9O,IAAOgS,GAAG,CAAC,GAChDD,EAAW,IAAIjD,CAAC,EAKpB,OAAIiD,EAAW,OAAS,EAAU,KAGnB,MAAM,KAAKA,CAAU,EAAE,KAAK,CAACM,EAAGC,IAAM,CAEnD,IAAMC,EAAOzV,EAAK,MAAM,QAAQuV,CAAC,EAC3BG,EAAO1V,EAAK,MAAM,QAAQwV,CAAC,EAC3BG,EAAMX,EAAQ,QAAQS,CAAI,EAAIT,EAAQ,QAAQU,CAAI,EACxD,GAAIC,IAAQ,EAAG,OAAOA,EAEtB,IAAMC,EAAUb,GAAWQ,EAAE,WAAWR,CAAO,EAAI,GAAK,EAClDc,EAAUd,GAAWS,EAAE,WAAWT,CAAO,EAAI,GAAK,EACxD,OAAOa,EAAUC,CACnB,CAAC,EAGa,CAAC,CACjB,CAEO,SAASrB,GACd7J,EACAvI,EACArB,EACe,CACf,IAAM+U,EAAM9V,EAAK,UAAUA,EAAK,KAAKoC,EAAO,cAAc,IAAKuI,CAAQ,CAAC,EAIlEoL,EAAU,OAAO,QAAQ3T,EAAO,aAAa,EAChD,OACC,CAAC,CAAC,CAAEU,CAAI,IAAMA,GAAQgT,EAAI,WAAW9V,EAAK,UAAU8C,EAAO9C,EAAK,GAAG,CAAC,CACtE,EACC,KAAK,CAACuV,EAAGC,IAAMA,EAAE,CAAC,EAAE,OAASD,EAAE,CAAC,EAAE,MAAM,EAE3C,GAAIQ,EAAQ,SAAW,EACrB,OAAO,KAET,GAAM,CAACC,EAAUC,CAAO,EAAIF,EAAQ,CAAC,EAGjCG,EAAMlW,EAAK,SAASiW,EAASH,CAAG,EAEpCI,EAAMA,EAAI,MAAMlW,EAAK,GAAG,EAAE,KAAK,GAAG,EAGlC,IAAMmW,EAAMnW,EAAK,MAAM,QAAQkW,CAAG,EAE5BE,EADW,CAAC,MAAO,OAAQ,MAAO,MAAM,EACrB,SAASD,CAAG,EAAI,GAAKA,EAC1CE,EAAQH,EAAI,MAAM,EAAGA,EAAI,OAASC,EAAI,MAAM,EAG5CE,EAAM,SAAS,QAAQ,IACzBA,EAAQA,EAAM,MAAM,EAAG,EAAgB,GAKzC,IAAMC,EACJN,IAAa,MACTjV,EAAY,YACZqB,EAAO,QAAQ4T,CAAuC,EAC5D,GAAI,CAACM,EACH,OAAO,KAGT,IAAIC,EAASF,IAAU,GAAK,GAAK,IAAIA,IAIrC,OAAAE,EAASA,EAAO,QAAQ,OAAQ,EAAE,EAI3B,GAAGD,IAAYC,IAASH,GACjC,CRvoBA,OAAS,KAAAlR,OAAS,MAElB,eAAsBsR,GACpBC,EACArU,EACA5B,EAMA,CACAA,EAAU,CACR,UAAW,GACX,OAAQ,GACR,aAAc,GACd,MAAO,QACP,GAAGA,CACL,EAEA,IAAMkW,EAAkB,MAAMC,GAAmBvU,CAAM,EACvD,OACEsU,GACAA,EAAgB,IAChBA,EAAgB,GAAG,cAAc,MAAQtU,EAAO,cAAc,IAEvD,MAAMwU,GAAuBH,EAAYrU,EAAQsU,EAAiB,CACvE,GAAGlW,EACH,SACEiW,GAAY,SAAW,GAAK,CAAC,CAACA,EAAW,CAAC,EAAE,MAAM,aAAa,CACnE,CAAC,EAGI,MAAMI,GAAqBJ,EAAYrU,EAAQ5B,CAAO,CAC/D,CAEA,eAAeqW,GACbJ,EACArU,EACA5B,EAMA,CACA,IAAMsW,EAAkBnW,EAAQ,qBAAsB,CACpD,OAAQH,EAAQ,MAClB,CAAC,GAAG,MAAM,EACJuW,EAAO,MAAMC,GAAyBP,EAAYrU,CAAM,EAE9D,GAAI,CAAC2U,EACH,OAAAD,GAAiB,KAAK,EACfG,EAAY,IAAI,MAAM,2CAA2C,CAAC,EAG3E,GAAI,CACFC,GAAoBH,EAAK,OAAS,CAAC,EAAG3U,EAAO,cAAc,GAAG,CAChE,OAAS0C,EAAP,CACA,OAAAgS,GAAiB,KAAK,EACfG,EAAYnS,CAAK,CAC1B,CAEAgS,GAAiB,QAAQ,EAEzB,IAAM3Q,EAAkB,MAAMmK,EAAoClO,CAAM,EAExE,MAAM+U,GAAqBJ,EAAK,UAAU,OAAQ3U,EAAQ,CACxD,OAAQ5B,EAAQ,OAChB,gBAAA2F,CACF,CAAC,EAED,IAAMiR,EAAmB,MAAMC,GAAuBZ,EAAYrU,CAAM,EACxE,MAAM+C,GAAc4R,EAAK,QAAS3U,EAAQ,CACxC,yBAA0B5B,EAAQ,aAClC,OAAQA,EAAQ,OAChB,gBAAA2F,EACA,eAAgB4Q,EAAK,UAAU,OAC/B,iBAAAK,EACA,UAAW5W,EAAQ,MAAQA,EAAQ,QAAU,QAAU,EACzD,CAAC,EAGD,MAAM0B,GAAU6U,EAAK,IAAK3U,EAAQ,CAChC,OAAQ5B,EAAQ,MAClB,CAAC,EAED,MAAMuL,GAAcgL,EAAK,QAAS3U,EAAQ,CACxC,OAAQ5B,EAAQ,MAClB,CAAC,EAED,MAAMkJ,EAAmBqN,EAAK,aAAcA,EAAK,gBAAiB3U,EAAQ,CACxE,OAAQ5B,EAAQ,MAClB,CAAC,EACD,MAAM6Q,GAAY0F,EAAK,MAAO3U,EAAQ,CACpC,UAAW5B,EAAQ,UACnB,OAAQA,EAAQ,MAClB,CAAC,EAEGuW,EAAK,MACPnW,EAAO,KAAKmW,EAAK,IAAI,CAEzB,CAEA,eAAeH,GACbH,EACArU,EACAsU,EACAlW,EAOA,CACA,IAAMsW,EAAkBnW,EAAQ,qBAAsB,CACpD,OAAQH,EAAQ,MAClB,CAAC,GAAG,MAAM,EACN8W,EAAgB,MAAMC,GAAqBd,EAAYrU,CAAM,EAC7D0J,EAAS,MAAM0L,GAAcF,CAAa,EACxCG,EAAUvS,GAAE,MAAMwS,CAAkB,EAAE,MAAM5L,CAAM,EACxD,GAAI,CAAC2L,EACH,OAAAX,GAAiB,KAAK,EACfG,EAAY,IAAI,MAAM,2CAA2C,CAAC,EAE3EH,GAAiB,QAAQ,EAEzB,IAAMa,EAAoBC,GAAqBH,CAAO,EAChDI,EAAuBC,GAAwB,EAE/CrG,EAAyB,CAAC,EAC1BC,EAAyB,CAAC,EAC1BC,EAAyB,CAAC,EAE1BL,EAAQmG,EAAQ,QAASM,GAASA,EAAK,OAAS,CAAC,CAAC,EACxD,GAAI,CACFb,GAAoB5F,EAAOlP,EAAO,cAAc,GAAG,CACrD,OAAS0C,EAAP,CACA,OAAOmS,EAAYnS,CAAK,CAC1B,CAEA,IAAMkT,EAAcrX,EAAQ,wBAAwB,GAAG,MAAM,EAE7D,QAAWsX,KAAaR,EAAS,CAC/B,IAAMlI,EAAQsI,EAAqB,IAAII,EAAU,IAAI,EAC/CC,EAAiBP,EAAkB,IAAIM,EAAU,IAAI,EAG3D,GAAI,CAAC1I,EACH,SAKF,IAAI4I,EACFF,EAAU,OAAS,eAAiBC,GAAgB,OAAS,cACzDxB,EAAgB,GAChBtU,EAEA+D,EAAkB,MAAMmK,EAC5B6H,CACF,EAEMC,EAAgBrG,GACpB3P,EAAO,cAAc,IACrB+V,EAAa,cAAc,EAC7B,EACME,EACH,MAAMC,GAAgBF,EAAeD,EAAa,cAAc,GAAG,GACpEA,EAAa,cAAc,IAc7B,GAXIF,EAAU,UAAU,SACtB,MAAMd,GAAqBc,EAAU,UAAU,OAAQE,EAAc,CACnE,OAAQ,GACR,gBAAAhS,CACF,CAAC,EACDuL,EAAa,KACX1R,EAAK,SAASoY,EAAeD,EAAa,cAAc,cAAc,CACxE,GAIEF,EAAU,QAAS,CACrB,IAAMb,EAAmB,MAAMC,GAAuBZ,EAAYrU,CAAM,EACxE,MAAM+C,GAAc8S,EAAU,QAASE,EAAc,CACnD,OAAQ,GACR,gBAAAhS,EACA,eAAgB8R,EAAU,UAAU,OACpC,iBAAAb,CACF,CAAC,EACD1F,EAAa,KACX1R,EAAK,SAASoY,EAAeD,EAAa,cAAc,WAAW,CACrE,EAIEF,EAAU,MACZ,MAAM/V,GAAU+V,EAAU,IAAKE,EAAc,CAC3C,OAAQ,EACV,CAAC,EACDzG,EAAa,KACX1R,EAAK,SAASoY,EAAeD,EAAa,cAAc,WAAW,CACrE,GAIEF,EAAU,SACZ,MAAMlM,GAAckM,EAAU,QAASE,EAAc,CACnD,OAAQ,EACV,CAAC,EAIH,MAAMzO,EACJuO,EAAU,aACVA,EAAU,gBACVE,EACA,CACE,OAAQ,EACV,CACF,EAGA,IAAM7G,GAAQ,MAAMD,GAAY4G,EAAU,MAAOE,EAAc,CAC7D,UAAW3X,EAAQ,UACnB,OAAQ,GACR,YAAAwX,EACA,SAAUxX,EAAQ,QACpB,CAAC,EAEDiR,EAAa,KACX,GAAGH,GAAM,aAAa,IAAKO,GACzB7R,EAAK,SAASoY,EAAepY,EAAK,KAAKqY,EAAaxG,CAAI,CAAC,CAC3D,CACF,EACAH,EAAa,KACX,GAAGJ,GAAM,aAAa,IAAKO,GACzB7R,EAAK,SAASoY,EAAepY,EAAK,KAAKqY,EAAaxG,CAAI,CAAC,CAC3D,CACF,EACAF,EAAa,KACX,GAAGL,GAAM,aAAa,IAAKO,GACzB7R,EAAK,SAASoY,EAAepY,EAAK,KAAKqY,EAAaxG,CAAI,CAAC,CAC3D,CACF,EAiBF,GAdAmG,GAAa,QAAQ,EAGrBvG,EAAa,KAAK,EAClBC,EAAa,KAAK,EAClBC,EAAa,KAAK,EAGd,EADoBF,EAAa,QAAUC,EAAa,SACpC,CAACC,EAAa,QACpChR,EAAQ,oBAAqB,CAC3B,OAAQH,EAAQ,MAClB,CAAC,GAAG,KAAK,EAGPiR,EAAa,OAAQ,CACvB9Q,EACE,WAAW8Q,EAAa,UACtBA,EAAa,SAAW,EAAI,OAAS,WAEvC,CACE,OAAQjR,EAAQ,MAClB,CACF,GAAG,QAAQ,EACX,QAAWqR,KAAQJ,EACjB7Q,EAAO,IAAI,OAAOiR,GAAM,EAI5B,GAAIH,EAAa,OAAQ,CACvB/Q,EACE,WAAW+Q,EAAa,UACtBA,EAAa,SAAW,EAAI,OAAS,WAEvC,CACE,OAAQlR,EAAQ,MAClB,CACF,GAAG,KAAK,EACR,QAAWqR,KAAQH,EACjB9Q,EAAO,IAAI,OAAOiR,GAAM,EAI5B,GAAIF,EAAa,OAAQ,CACvBhR,EACE,WAAWgR,EAAa,UACtBD,EAAa,SAAW,EAAI,OAAS,0CAEvC,CACE,OAAQlR,EAAQ,MAClB,CACF,GAAG,KAAK,EACR,QAAWqR,KAAQF,EACjB/Q,EAAO,IAAI,OAAOiR,GAAM,EAG9B,CAEA,eAAewF,GACbZ,EACArU,EACA,CACA,IAAI0J,EAAS,MAAM,QAAQ,IACzB2K,EAAW,IAAKwB,GAAcM,EAAgBN,EAAW7V,EAAO,KAAK,CAAC,CACxE,EAGA,OAFgB8C,GAAE,MAAMwS,CAAkB,EAAE,MAAM5L,CAAM,EAEzC,KACZmM,GACCA,EAAU,OAAS,kBAAoBA,EAAU,OAAS,gBAC9D,CACF,CAEA,SAASf,GACP5F,EACAhQ,EACA,CACA,QAAWuQ,KAAQP,EACjB,GAAKO,GAAM,QAIP,CAACzQ,GAAayQ,EAAK,OAAQvQ,CAAG,EAChC,MAAM,IAAI,MACR,iCAAiCuQ,EAAK,oDACxC,CAGN,CiBhXA,OAAO2G,OAAQ,KACf,OAAOxY,OAAU,OAQjB,OAAS,SAAAwJ,MAAa,QACtB,OAAOzJ,OAAQ,WACf,OAAO0J,OAAa,UACpB,OAAS,KAAAvE,OAAS,MAElB,IAAMuT,GACJ,uDAEWC,GAAY,CACvB,KAAM,OACN,gBAAiB,eACnB,EAEA,eAAsBC,GACpBnY,EAIA,CACAA,EAAU,CACR,OAAQ,GACR,GAAGA,CACL,EAEA,IAAIoY,EACFpY,EAAQ,UAAYkY,GAAUlY,EAAQ,QAAkC,EACnEA,EAAQ,SACT,OACFqY,EACFD,IAAaF,GAAU,KAAO,SAAW,cACvCI,EAAc,SAEZC,EACJvY,EAAQ,YAAY,SAAW,GAC/B,CAAC,CAACA,EAAQ,WAAW,CAAC,EAAE,MAAM,aAAa,EAE7C,GAAIA,EAAQ,YAAcuY,EACxB,GAAI,CACF,GAAM,CAACjN,CAAM,EAAI,MAAM0L,GAAchX,EAAQ,UAAU,EACjD,CAAE,KAAAwY,CAAK,EAAI9T,GACd,OAAO,CACN,KAAMA,GAAE,OAAO,CACb,YAAaA,GAAE,OAAO,CACxB,CAAC,CACH,CAAC,EACA,MAAM4G,CAAM,EACfgN,EAAcE,EAAK,YAGnBJ,EAAWF,GAAU,IACvB,OAAS5T,EAAP,CACAlE,EAAO,MAAM,EACbqW,EAAYnS,CAAK,CACnB,CAGF,GAAI,CAACtE,EAAQ,MAAO,CAClB,GAAM,CAAE,KAAAyY,EAAM,KAAA/V,CAAK,EAAI,MAAMuG,GAAQ,CACnC,CACE,KAAMjJ,EAAQ,UAAYuY,EAAoB,KAAO,SACrD,KAAM,OACN,QAAS,YAAYlY,EAAY,KAC/BL,EAAQ,GACV;AAAA,0CACA,QAAS,CACP,CAAE,MAAO,UAAW,MAAO,MAAO,EAClC,CAAE,MAAO,qBAAsB,MAAO,eAAgB,CACxD,EACA,QAAS,CACX,EACA,CACE,KAAM,OACN,KAAM,OACN,QAAS,8BACT,QAASqY,EACT,OAAS5U,GAAkBA,EAAM,KAAK,EACtC,SAAWA,GACTA,EAAM,OAAS,IACX,2CACA,EACR,CACF,CAAC,EAED2U,EAAWK,GAAQL,EACnBC,EAAc3V,EAGhB,IAAMoG,EAAiB,MAAMH,GAAkB3I,EAAQ,IAAK,CAC1D,aAAc,EAChB,CAAC,EAEK0Y,EAAc,GAAG1Y,EAAQ,OAAOqY,IAGtC,GAAI,CACF,MAAM9Y,GAAG,OAAOS,EAAQ,IAAKT,GAAG,UAAU,IAAI,CAChD,MAAE,CACAa,EAAO,MAAM,EACbA,EAAO,MAAM,YAAYC,EAAY,KAAKL,EAAQ,GAAG,oBAAoB,EACzEI,EAAO,MACL,8EAA8EC,EAAY,KACxFL,EAAQ,GACV,mBACF,EACAI,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,CAChB,CAEA,OAAIb,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAKqY,EAAa,cAAc,CAAC,IACtEjY,EAAO,MAAM,EACbA,EAAO,MACL,2BAA2BC,EAAY,KAAKgY,CAAW,mBACzD,EACAjY,EAAO,MAAM,+CAA+C,EAC5DA,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAGZgY,IAAaF,GAAU,MACzB,MAAMS,GAAkBD,EAAa,CACnC,QAASJ,EACT,IAAKtY,EAAQ,IACb,eAAA8I,EACA,OAAQ,CAAC,CAAC9I,EAAQ,MACpB,CAAC,EAGCoY,IAAaF,GAAU,eAAe,GACxC,MAAMU,GAAsBF,EAAa,CACvC,eAAA5P,CACF,CAAC,EAGI,CACL,YAAA4P,EACA,YAAAL,EACA,SAAAD,CACF,CACF,CAEA,eAAeO,GACbD,EACA1Y,EAMA,CACA,IAAM6Y,EAAgB1Y,EACpB,8DACF,EAAE,MAAM,EAGF2Y,EAAO,CACX,aACA,WACA,eACA,QACA9Y,EAAQ,OAAS,YAAc,eAC/B,oBACA,SAASA,EAAQ,gBACnB,GAGEA,EAAQ,QAAQ,WAAW,IAAI,GAC/BA,EAAQ,QAAQ,WAAW,QAAQ,GACnCA,EAAQ,QAAQ,WAAW,QAAQ,IAEnC8Y,EAAK,KAAK,aAAa,EAGzB,GAAI,CACF,MAAM9P,EACJ,MACA,CAAC,mBAAmBhJ,EAAQ,UAAW0Y,EAAa,WAAY,GAAGI,CAAI,EACvE,CACE,IAAK9Y,EAAQ,GACf,CACF,CACF,MAAE,CACAI,EAAO,MAAM,EACbA,EAAO,MACL,wEACF,EACA,QAAQ,KAAK,CAAC,CAChB,CAEAyY,GAAe,QAAQ,iCAAiC,CAC1D,CAEA,eAAeD,GACbF,EACA1Y,EAGA,CACA,IAAM6Y,EAAgB1Y,EACpB,+DACF,EAAE,MAAM,EAER,GAAI,CAEF,IAAM4Y,EAAevZ,GAAK,KAAKwY,GAAG,OAAO,EAAG,mBAAmB,KAAK,IAAI,GAAG,EAC3E,MAAMzY,GAAG,UAAUwZ,CAAY,EAC/B,IAAMC,EAAW,MAAM,MAAMf,EAAqB,EAClD,GAAI,CAACe,EAAS,GACZ,MAAM,IAAI,MAAM,gCAAgCA,EAAS,YAAY,EAIvE,IAAMC,EAAUzZ,GAAK,QAAQuZ,EAAc,iBAAiB,EAC5D,MAAMxZ,GAAG,UAAU0Z,EAAS,OAAO,KAAK,MAAMD,EAAS,YAAY,CAAC,CAAC,EACrE,MAAMhQ,EAAM,MAAO,CACjB,OACAiQ,EACA,KACAF,EACA,uBACA,iCACF,CAAC,EACD,IAAMG,EAAgB1Z,GAAK,QAAQuZ,EAAc,eAAe,EAChE,MAAMxZ,GAAG,KAAK2Z,EAAeR,CAAW,EACxC,MAAMnZ,GAAG,OAAOwZ,CAAY,EAG5B,MAAM/P,EAAMhJ,EAAQ,eAAgB,CAAC,SAAS,EAAG,CAC/C,IAAK0Y,CACP,CAAC,EAGD,IAAM5X,EAAM,QAAQ,IAAI,EACxB,MAAMkI,EAAM,MAAO,CAAC,WAAW,EAAG,CAAE,IAAK0P,CAAY,CAAC,EACtD,MAAM1P,EAAM,MAAO,CAAC,MAAM,EAAG,CAAE,IAAK0P,CAAY,CAAC,EACjD,MAAM1P,EAAM,MAAO,CAAC,MAAO,IAAI,EAAG,CAAE,IAAK0P,CAAY,CAAC,EACtD,MAAM1P,EAAM,MAAO,CAAC,SAAU,KAAM,gBAAgB,EAAG,CACrD,IAAK0P,CACP,CAAC,EACD,MAAM1P,EAAM,KAAM,CAAClI,CAAG,CAAC,EAEvB+X,GAAe,QAAQ,kCAAkC,CAC3D,OAASvU,EAAP,CACAuU,GAAe,KAAK,uDAAuD,EAC3EpC,EAAYnS,CAAK,CACnB,CACF,CC9PA,OAAS,YAAY/E,OAAU,KAC/B,OAAOC,OAAU,OAQjB,OAAkC,cAAA8M,OAAkB,WAEpD,eAAsB6M,GACpB1O,EACA7I,EACA5B,EAGA,CACA,GAAI,CAACyK,EACH,OAGFzK,EAAU,CACR,OAAQ,GACR,GAAGA,CACL,EAEA,IAAMoZ,EAA2B5Z,GAAK,SACpCoC,EAAO,cAAc,IACrBA,EAAO,cAAc,cACvB,EACMlB,EAAkBP,EACtB,YAAYE,EAAY,KAAK+Y,CAAwB,IACrD,CACE,OAAQpZ,EAAQ,MAClB,CACF,EAAE,MAAM,EACFgC,EAAM,MAAMzC,GAAG,SAASqC,EAAO,cAAc,eAAgB,MAAM,EACnEK,EAAS,MAAMoX,GAAyBrX,EAAKyI,EAAS7I,CAAM,EAClE,MAAMrC,GAAG,UAAUqC,EAAO,cAAc,eAAgBK,EAAQ,MAAM,EACtEvB,GAAiB,QAAQ,CAC3B,CAEA,eAAsB2Y,GACpBlX,EACAsI,EACA7I,EACA,CACA,IAAM2K,EAAa,MAAM+M,GAAkBnX,EAAOP,CAAM,EAIlD2X,EAAehN,EAClB,qBAAqBD,GAAW,uBAAuB,EACvD,KAAM1J,GACLA,EACG,cAAc,EACd,KACE4W,GACCA,EAAS,OAAOlN,GAAW,kBAAkB,GAC7CkN,EAAS,QAAQ,IAAM,SAC3B,CACJ,EAGF,OAAKD,GAILE,GAAyBF,EAAc9O,CAAO,EAEvC8B,EAAW,YAAY,GALrBpK,CAMX,CAEA,eAAesX,GACbF,EACA9O,EACA,CACA,IAAMiP,EAAYC,GAAcJ,CAAY,EAEtCK,EAAmBL,EAAa,YAAY,SAAS,EAE3D,GAAI,CAACK,EAAkB,CACrB,IAAMC,EAAc,CAClB,KAAM,UACN,YAAa,IAAIH,IAAYjP,EAAQ,KACnC,GAAGiP,MAAcA,GACnB,IAAIA,IACN,EACA,OAAAH,EAAa,sBAAsBM,CAAW,EAEvCN,EAGT,GAAIK,EAAiB,OAAOtN,GAAW,kBAAkB,EAAG,CAC1D,IAAMwN,EAAcF,EAAiB,eAAe,EAGpD,GAAIE,GAAa,OAAOxN,GAAW,sBAAsB,EACvD,QAAWyN,KAAetP,EAAS,CACjC,IAAMuP,EAAW,GAAGN,IAAYK,IAAcL,IAI5CI,EACG,YAAY,EACZ,IAAKG,GAAYA,EAAQ,QAAQ,CAAC,EAClC,SAASD,CAAQ,GAKtBF,EAAY,WAAWE,CAAQ,EAInC,OAAOT,EAGT,OAAOA,CACT,CrBvFA,OAAS,WAAAW,OAAe,YACxB,OAAOjR,OAAa,UACpB,OAAS,KAAAvE,MAAS,MAEX,IAAMyV,GAAoBzV,EAAE,OAAO,CACxC,IAAKA,EAAE,OAAO,EACd,WAAYA,EAAE,MAAMA,EAAE,OAAO,CAAC,EAAE,SAAS,EACzC,IAAKA,EAAE,QAAQ,EACf,SAAUA,EAAE,QAAQ,EACpB,MAAOA,EAAE,QAAQ,EACjB,OAAQA,EAAE,QAAQ,EAClB,aAAcA,EAAE,QAAQ,EACxB,OAAQA,EAAE,QAAQ,EAAE,SAAS,EAC7B,aAAcA,EAAE,QAAQ,EACxB,SAAUA,EACP,OAAO,EACP,SAAS,EACT,OACE0V,GACKA,EACKlC,GAAUkC,CAA6B,EAEzC,GAET,CACE,QAAS,yDACX,CACF,EACF,UAAW1V,EACR,OAAO,EACP,SAAS,EACT,OACE0V,GACKA,EACKC,GAAY,KAAMC,GAAUA,EAAM,OAASF,CAAG,EAGhD,GAET,CACE,QAAS,mCAAmCC,GAAY,IACrDC,GAAUA,EAAM,IACnB,EAAE,KAAK,MAAM,IACf,CACF,EACF,MAAO5V,EAAE,OAAO,CAClB,CAAC,EAEY6V,GAAO,IAAIL,GAAQ,EAC7B,KAAK,MAAM,EACX,YAAY,kDAAkD,EAC9D,SAAS,kBAAmB,uCAAuC,EACnE,OACC,4BACA,4CACF,EACC,OACC,gCACA,6DACA,MACF,EACC,OAAO,YAAa,4BAA6B,EAAI,EACrD,OAAO,kBAAmB,6BAA8B,EAAK,EAC7D,OAAO,cAAe,6CAA8C,EAAK,EACzE,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,eAAgB,eAAgB,EAAK,EAC5C,OACC,YACA,qDACA,EACF,EACC,OACC,eACA,2DACF,EACC,OAAO,kBAAmB,iCAAkC,EAAI,EAChE,OAAO,qBAAsB,uCAAuC,EACpE,OAAO,MAAOjE,EAAYzF,IAAS,CAClC,GAAI,CACF,IAAMxQ,EAAUma,GAAkB,MAAM,CACtC,IAAK3a,GAAK,QAAQgR,EAAK,GAAG,EAC1B,aAAc,GACd,WAAAyF,EACA,MAAO,QACP,GAAGzF,CACL,CAAC,EAKD,GACEyF,EAAW,OAAS,IACnBuE,GAAMvE,EAAW,CAAC,CAAC,GAAKwE,GAAYxE,EAAW,CAAC,CAAC,GAClD,CACA,IAAMsB,EAAO,MAAMQ,EAAgB9B,EAAW,CAAC,EAAG,EAAE,EAIhDsB,GAAM,OAAS,mBACjBvX,EAAQ,UAAY,UACpBA,EAAQ,MAAQuX,EAAK,SAAW,SAIpC,MAAMmD,GAAQ1a,CAAO,EAErBI,EAAO,IACL,GAAGC,EAAY,QACb,UACF;AAAA,4BACF,EACAD,EAAO,MAAM,CACf,OAASkE,EAAP,CACAlE,EAAO,MAAM,EACbqW,EAAYnS,CAAK,CACnB,CACF,CAAC,EAEH,eAAsBoW,GACpB1a,EAGA,CACA,IAAIO,EACAoa,EACJ,GAAK3a,EAAQ,cAaXO,EAAc,MAAMC,EAAeR,EAAQ,GAAG,MAbpB,CAC1B,IAAM4a,EAAY,MAAM7a,GAAcC,CAAO,EAC7C,GAAI4a,EAAU,OAAcnb,CAA4B,EAAG,CACzD,GAAM,CAAE,YAAAiZ,EAAa,SAAAN,CAAS,EAAI,MAAMD,GAAcnY,CAAO,EACxD0Y,GACH,QAAQ,KAAK,CAAC,EAEhB1Y,EAAQ,IAAM0Y,EACd1Y,EAAQ,aAAe,GACvB2a,EAAqBvC,EAEvB7X,EAAcqa,EAAU,YAK1B,GAAID,IAAuB,gBACzB,OAAA3a,EAAQ,IAAMR,GAAK,QAAQQ,EAAQ,IAAK,UAAU,EAC3C,MAAM6a,EAAU7a,EAAQ,GAAG,EAGpC,IAAM8a,EAAgB,MAAMC,GAAiB/a,EAAQ,IAAKO,CAAW,EAC/DqB,EAASkZ,EACX,MAAME,GAAuBF,EAAe9a,CAAO,EACnD,MAAMib,GAAgB,MAAMJ,EAAU7a,EAAQ,GAAG,CAAC,EAEtD,GAAI,CAACA,EAAQ,IAAK,CAChB,GAAM,CAAE,QAAAkb,CAAQ,EAAI,MAAMjS,GAAQ,CAChC,KAAM,UACN,KAAM,UACN,QAAS,0BAA0B5I,EAAY,KAC7C,iBACF,cACA,QAAS,EACX,CAAC,EAEI6a,GACH,QAAQ,KAAK,CAAC,EAKlB,IAAMC,EAAmBhb,EAAQ,0BAA0B,EAAE,MAAM,EAC7DU,EAAarB,GAAK,QAAQQ,EAAQ,IAAK,iBAAiB,EAC9D,MAAMT,GAAG,UAAUsB,EAAY,KAAK,UAAUe,EAAQ,KAAM,CAAC,EAAG,MAAM,EACtEuZ,EAAiB,QAAQ,EAGzB,IAAMC,EAAa,MAAMC,GAAmBrb,EAAQ,IAAK4B,CAAM,EACzDqU,EAAa,CACjB,GAAIjW,EAAQ,QAAU,OAAS,CAAC,EAAI,CAACA,EAAQ,KAAK,EAClD,GAAIA,EAAQ,YAAc,CAAC,CAC7B,EACA,aAAMgW,GAAcC,EAAYmF,EAAY,CAE1C,UAAW,GACX,OAAQpb,EAAQ,OAChB,MAAOA,EAAQ,MACf,aACEA,EAAQ,cAAgBO,GAAa,UAAU,OAAS,UAC5D,CAAC,EAIGP,EAAQ,cAAgBA,EAAQ,QAClC,MAAMmZ,GACJ,CAAC,gCAAgC,EACjCiC,EACA,CACE,OAAQpb,EAAQ,MAClB,CACF,EAGKob,CACT,CAEA,eAAeH,GAAgBK,EAA+B,KAAM,CAClE,GAAM,CAACC,EAAQC,CAAU,EAAI,MAAM,QAAQ,IAAI,CAC7CC,GAAkB,EAClBC,GAAsB,CACxB,CAAC,EAEDtb,EAAO,KAAK,EAAE,EACd,IAAMJ,EAAU,MAAMiJ,GAAQ,CAC5B,CACE,KAAM,SACN,KAAM,aACN,QAAS,yBAAyB5I,EAAY,KAC5C,YACF,mBACA,QAASib,GAAe,KAAO,GAC/B,OAAQ,MACR,SAAU,IACZ,EACA,CACE,KAAM,SACN,KAAM,QACN,QAAS,SAASjb,EAAY,KAAK,OAAO,2BAC1C,QAASkb,EAAO,IAAKI,IAAW,CAC9B,MAAOA,EAAM,MACb,MAAOA,EAAM,IACf,EAAE,CACJ,EACA,CACE,KAAM,SACN,KAAM,oBACN,QAAS,4CAA4Ctb,EAAY,KAC/D,YACF,KACA,QAASmb,EAAW,IAAKlB,IAAW,CAClC,MAAOA,EAAM,MACb,MAAOA,EAAM,IACf,EAAE,CACJ,EACA,CACE,KAAM,OACN,KAAM,cACN,QAAS,iBAAiBja,EAAY,KAAK,YAAY,UACvD,QAASib,GAAe,SAAS,KAAOM,EAC1C,EACA,CACE,KAAM,SACN,KAAM,uBACN,QAAS,yBAAyBvb,EAAY,KAC5C,eACF,iBACA,QAASib,GAAe,SAAS,cAAgB,GACjD,OAAQ,MACR,SAAU,IACZ,EACA,CACE,KAAM,OACN,KAAM,iBACN,QAAS,0BAA0Bjb,EAAY,KAC7C,yBACF,0BACA,QAAS,EACX,EACA,CACE,KAAM,OACN,KAAM,iBACN,QAAS,iBAAiBA,EAAY,KACpC,oBACF,aACA,QAASib,GAAe,SAAS,QAAUO,EAC7C,EACA,CACE,KAAM,OACN,KAAM,aACN,QAAS,kCAAkCxb,EAAY,KACrD,YACF,KACA,QAASib,GAAe,QAAQ,YAAiBQ,EACnD,EACA,CACE,KAAM,OACN,KAAM,QACN,QAAS,kCAAkCzb,EAAY,KAAK,OAAO,KACnE,QAASib,GAAe,QAAQ,OAAYS,EAC9C,EACA,CACE,KAAM,SACN,KAAM,MACN,QAAS,iBAAiB1b,EAAY,KAAK,yBAAyB,KACpE,QAASib,GAAe,KAAO,GAC/B,OAAQ,MACR,SAAU,IACZ,CACF,CAAC,EAED,OAAOU,GAAgB,MAAM,CAC3B,QAAS,oCACT,MAAOhc,EAAQ,MACf,SAAU,CACR,OAAQA,EAAQ,eAChB,IAAKA,EAAQ,YACb,UAAWA,EAAQ,kBACnB,aAAcA,EAAQ,qBACtB,OAAQA,EAAQ,cAClB,EACA,IAAKA,EAAQ,IACb,IAAKA,EAAQ,WACb,QAAS,CACP,MAAOA,EAAQ,MACf,WAAYA,EAAQ,WAEpB,IAAKA,EAAQ,WAAW,QAAQ,gBAAiB,KAAK,EACtD,MAAOA,EAAQ,WAAW,QAAQ,gBAAiB,OAAO,CAC5D,CACF,CAAC,CACH,CAEA,eAAegb,GACbM,EACA9K,EACA,CACA,IAAImL,EAAQL,EAAc,MACtB9O,EAAYgE,EAAK,UACjByL,EAAeX,EAAc,SAAS,aAE1C,GAAI,CAAC9K,EAAK,SAAU,CAClB,GAAM,CAAC+K,EAAQC,EAAY7V,CAAe,EAAI,MAAM,QAAQ,IAAI,CAC9D8V,GAAkB,EAClBC,GAAsB,EACtB5L,EAAoCwL,CAAa,CACnD,CAAC,EAEKtb,EAAU,MAAMiJ,GAAQ,CAC5B,CACE,KAAMtD,IAAoB,KAAO,KAAO,SACxC,KAAM,QACN,QAAS,SAAStF,EAAY,KAAK,OAAO,2BAC1C,QAASkb,EAAO,IAAKI,IAAW,CAC9B,MACEA,EAAM,OAAS,WAAa,yBAA2BA,EAAM,MAC/D,MAAOA,EAAM,IACf,EAAE,EACF,QAAS,CACX,EACA,CACE,KAAMnL,EAAK,UAAY,KAAO,SAC9B,KAAM,oBACN,QAAS,4CAA4CnQ,EAAY,KAC/D,YACF,KACA,QAASmb,EAAW,IAAKlB,IAAW,CAClC,MAAOA,EAAM,MACb,MAAOA,EAAM,IACf,EAAE,CACJ,CACF,CAAC,EAEDqB,EAAQ3b,EAAQ,OAAS,WACzBwM,EAAYxM,EAAQ,mBAAqBwM,EACzCyP,EAAezL,EAAK,aAGtB,OAAOwL,GAAgB,MAAM,CAC3B,QAASV,GAAe,QACxB,MAAAK,EACA,SAAU,CACR,GAAGL,GAAe,SAClB,UAAA9O,EACA,aAAAyP,CACF,EACA,IAAKX,GAAe,IACpB,IAAKA,GAAe,IACpB,QAASA,GAAe,QACxB,YAAaA,GAAe,WAC9B,CAAC,CACH,CsB7ZA,OAAO9b,OAAU,OAMjB,OAAOD,OAAQ,WAGf,eAAsB2c,GAAalc,EAA2C,CAC5E,IAAMC,EAAkC,CAAC,EAIzC,GACE,CAACV,GAAG,WAAWS,EAAQ,GAAG,GAC1B,CAACT,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAK,cAAc,CAAC,EAExD,OAAAC,EAAcR,CAA4B,EAAI,GACvC,CACL,OAAAQ,EACA,OAAQ,IACV,EAIF,GAAI,CAACV,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAK,iBAAiB,CAAC,EAC7D,OAAAC,EAAcP,CAAc,EAAI,GACzB,CACL,OAAAO,EACA,OAAQ,IACV,EAGF,GAAI,CACF,IAAM2B,EAAS,MAAMiZ,EAAU7a,EAAQ,GAAG,EAE1C,MAAO,CACL,OAAAC,EACA,OAAQ2B,CACV,CACF,MAAE,CACAxB,EAAO,MAAM,EACbA,EAAO,MACL,cAAcC,EAAY,KACxB,iBACF,uBAAuBA,EAAY,KACjCL,EAAQ,GACV;AAAA,yDAA8DK,EAAY,KACxE,iBACF,yBAAyBA,EAAY,KAAK,MAAM,YAClD,EACAD,EAAO,MACL,iBAAiBC,EAAY,KAC3B,4CACF,IACF,EACAD,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,CAChB,CACF,CC5DA,OAAOb,OAAQ,cACf,OAAOC,OAAU,OAIjB,eAAsB2c,GAAe1E,EAAmB7V,EAAgB,CACtE,IAAMwa,EAAY5c,GAAK,KAAKoC,EAAO,cAAc,IAAK,cAAc,EAEpE,GAAI,EAAE,MAAMrC,GAAG,KAAK6c,CAAS,GAAG,OAAO,EACrC,OAGF,IAAMC,EAAe,MAAMtE,EAAgBN,EAAW7V,EAAO,KAAK,EAClE,GACE,CAACya,GAAc,MAAM,iBACrB,CAACA,GAAc,MAAM,gBAErB,OAIF,IAAM5R,EAAU,YAAY4R,GAAc,MAAM,2BAA2BA,EAAa,KAAK;AAAA;AAAA;AAAA,YAAmEA,GAAc,MAAM;AAAA,GACpL,MAAM9c,GAAG,UAAU6c,EAAW3R,EAAS,MAAM,CAC/C,CxBHA,OAAS,WAAAyP,OAAe,YACxB,OAAOjR,OAAa,UACpB,OAAS,KAAAvE,MAAS,MAElB,IAAM4X,GAAwB,CAC5B,CACE,KAAM,QACN,aAAc,SACd,QACE,sEACJ,EACA,CACE,KAAM,UACN,aAAc,SACd,QACE,wEACJ,CACF,EAEaC,GAAmB7X,EAAE,OAAO,CACvC,WAAYA,EAAE,MAAMA,EAAE,OAAO,CAAC,EAAE,SAAS,EACzC,IAAKA,EAAE,QAAQ,EACf,UAAWA,EAAE,QAAQ,EACrB,IAAKA,EAAE,OAAO,EACd,IAAKA,EAAE,QAAQ,EACf,KAAMA,EAAE,OAAO,EAAE,SAAS,EAC1B,OAAQA,EAAE,QAAQ,EAClB,OAAQA,EAAE,QAAQ,EAAE,SAAS,EAC7B,aAAcA,EAAE,QAAQ,CAC1B,CAAC,EAEY8X,GAAM,IAAItC,GAAQ,EAC5B,KAAK,KAAK,EACV,YAAY,iCAAiC,EAC7C,SAAS,kBAAmB,uCAAuC,EACnE,OAAO,YAAa,4BAA6B,EAAK,EACtD,OAAO,kBAAmB,4BAA6B,EAAK,EAC5D,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,YAAa,+BAAgC,EAAK,EACzD,OAAO,oBAAqB,mCAAmC,EAC/D,OAAO,eAAgB,eAAgB,EAAK,EAC5C,OACC,YACA,qDACA,EACF,EACC,OACC,eACA,2DACF,EACC,OAAO,kBAAmB,iCAAkC,EAAI,EAChE,OAAO,qBAAsB,uCAAuC,EACpE,OAAO,MAAOjE,EAAYzF,IAAS,CAClC,GAAI,CACF,IAAMxQ,EAAUuc,GAAiB,MAAM,CACrC,WAAAtG,EACA,IAAKzW,GAAK,QAAQgR,EAAK,GAAG,EAC1B,GAAGA,CACL,CAAC,EAEGiM,EACAJ,EAAoB,KAUxB,GAPEpG,EAAW,OAAS,IACnBuE,GAAMvE,EAAW,CAAC,CAAC,GAAKwE,GAAYxE,EAAW,CAAC,CAAC,KAElDoG,EAAe,MAAMtE,EAAgB9B,EAAW,CAAC,EAAG,EAAE,EACtDwG,EAAWJ,GAAc,MAIzB,CAACrc,EAAQ,MACRyc,IAAa,kBAAoBA,IAAa,kBAC/C,CACArc,EAAO,MAAM,EACb,GAAM,CAAE,QAAAsc,CAAQ,EAAI,MAAMzT,GAAQ,CAChC,KAAM,UACN,KAAM,UACN,QAAS5I,EAAY,KACnB,kCAAkCoc,EAAS,QACzC,YACA,EACF;AAAA,qEACF,CACF,CAAC,EACIC,IACHtc,EAAO,MAAM,EACbA,EAAO,IAAI,yBAAyB,EACpCA,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GASlB,GALKJ,EAAQ,YAAY,SACvBA,EAAQ,WAAa,MAAM2c,GAA4B3c,CAAO,IAG5C,MAAMQ,EAAeR,EAAQ,GAAG,IACnC,kBAAoB,KAAM,CACzC,IAAM4c,EAAuBN,GAAsB,OAAQ7E,GACzDzX,EAAQ,YAAY,SAASyX,EAAU,IAAI,CAC7C,EAEImF,GAAsB,SACxBxc,EAAO,MAAM,EACbwc,EAAqB,QAASnF,GAAc,CAC1CrX,EAAO,KAAKC,EAAY,KAAKoX,EAAU,OAAO,CAAC,CACjD,CAAC,EACDrX,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAIlB,GAAIyc,GAAwBR,CAAY,EAAG,CAEzC,GAAI,CAAC9c,GAAG,WAAWS,EAAQ,GAAG,EAC5B,MAAM,IAAI,MAAM,aAAaA,EAAQ,oBAAoB,EAG3D,IAAM8c,EAAgBC,GAAa,CACjC,cAAe,CACb,IAAK/c,EAAQ,GACf,CACF,CAAC,EAED,MAAMgW,GAAchW,EAAQ,WAAY8c,EAAe9c,CAAO,EAC9D,OAGF,GAAI,CAAE,OAAAC,EAAQ,OAAA2B,CAAO,EAAI,MAAMsa,GAAalc,CAAO,EAGnD,GAAIC,EAAcP,CAAc,EAAG,CACjC,GAAM,CAAE,QAAAwb,CAAQ,EAAI,MAAMjS,GAAQ,CAChC,KAAM,UACN,KAAM,UACN,QAAS,wBAAwB5I,EAAY,KAC3C,iBACF,qCACA,QAAS,EACX,CAAC,EAEI6a,IACH9a,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAGhBwB,EAAS,MAAM8Y,GAAQ,CACrB,IAAK1a,EAAQ,IACb,IAAK,GACL,MAAO,GACP,SAAU,GACV,cAAe,GACf,OAAQ,GACR,aAAc,GACd,OAAQA,EAAQ,OAChB,aAAcA,EAAQ,aACtB,MAAO,OACT,CAAC,EAGH,IAAIgd,EAAuB,GAC3B,GAAI/c,EAAcR,CAA4B,EAAG,CAC/C,GAAM,CAAE,YAAAiZ,EAAa,SAAAN,CAAS,EAAI,MAAMD,GAAc,CACpD,IAAKnY,EAAQ,IACb,MAAOA,EAAQ,UACf,OAAQA,EAAQ,OAChB,WAAYA,EAAQ,UACtB,CAAC,EACI0Y,IACHtY,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAEhBJ,EAAQ,IAAM0Y,EAEVN,IAAa,iBACfpY,EAAQ,IAAMR,GAAK,QAAQQ,EAAQ,IAAK,UAAU,EAClD4B,EAAS,MAAMiZ,EAAU7a,EAAQ,GAAG,IAEpC4B,EAAS,MAAM8Y,GAAQ,CACrB,IAAK1a,EAAQ,IACb,IAAK,GACL,MAAO,GACP,SAAU,GACV,cAAe,GACf,OAAQ,GACR,aAAc,GACd,OAAQA,EAAQ,OAChB,aAAcA,EAAQ,aACtB,MAAO,OACT,CAAC,EAEDgd,EACEhd,EAAQ,YAAY,SAAW,GAC/B,CAAC,CAACA,EAAQ,WAAW,CAAC,EAAE,MAAM,aAAa,GAIjD,GAAI,CAAC4B,EACH,MAAM,IAAI,MACR,4BAA4BvB,EAAY,KAAKL,EAAQ,GAAG,IAC1D,EAGF,MAAMgW,GAAchW,EAAQ,WAAY4B,EAAQ5B,CAAO,EAInDgd,GACF,MAAMb,GAAenc,EAAQ,WAAW,CAAC,EAAG4B,CAAM,CAEtD,OAAS0C,EAAP,CACAlE,EAAO,MAAM,EACbqW,EAAYnS,CAAK,CACnB,CACF,CAAC,EAEH,eAAeqY,GACb3c,EACA,CACA,IAAMid,EAAgB,MAAMC,GAAiB,EAC7C,GAAI,CAACD,EACH,OAAA7c,EAAO,MAAM,EACbqW,EAAY,IAAI,MAAM,iCAAiC,CAAC,EACjD,CAAC,EAGV,GAAIzW,EAAQ,IACV,OAAOid,EACJ,IAAKE,GAAUA,EAAM,IAAI,EACzB,OACE1F,GAAc,CAAC6E,GAAsB,KAAMc,GAAMA,EAAE,OAAS3F,CAAS,CACxE,EAGJ,GAAIzX,EAAQ,YAAY,OACtB,OAAOA,EAAQ,WAGjB,GAAM,CAAE,WAAAiW,CAAW,EAAI,MAAMhN,GAAQ,CACnC,KAAM,cACN,KAAM,aACN,QAAS,0CACT,KAAM,qDACN,aAAc,GACd,QAASgU,EACN,OACEE,GACCA,EAAM,OAAS,eACf,CAACb,GAAsB,KACpB7E,GAAcA,EAAU,OAAS0F,EAAM,IAC1C,CACJ,EACC,IAAKA,IAAW,CACf,MAAOA,EAAM,KACb,MAAOA,EAAM,KACb,SAAUnd,EAAQ,IAAM,GAAOA,EAAQ,YAAY,SAASmd,EAAM,IAAI,CACxE,EAAE,CACN,CAAC,EAEIlH,GAAY,SACf7V,EAAO,KAAK,kCAAkC,EAC9CA,EAAO,KAAK,EAAE,EACd,QAAQ,KAAK,CAAC,GAGhB,IAAMkL,EAAS5G,EAAE,MAAMA,EAAE,OAAO,CAAC,EAAE,UAAUuR,CAAU,EACvD,OAAK3K,EAAO,QAKLA,EAAO,MAJZlL,EAAO,MAAM,EAAE,EACfqW,EAAY,IAAI,MAAM,yCAAyC,CAAC,EACzD,CAAC,EAGZ,CyB1SA,UAAYlX,OAAQ,cACpB,UAAYC,OAAU,OCDtB,OAAOA,OAAU,OAKjB,OAAOD,OAAQ,WAGf,eAAsB8d,GACpBrd,EACA,CACA,IAAMC,EAAkC,CAAC,EAEnCqd,EAAe,CACnB,IAAKtd,EAAQ,IACb,aAAcR,GAAK,QAAQQ,EAAQ,IAAKA,EAAQ,YAAY,EAC5D,UAAWR,GAAK,QAAQQ,EAAQ,IAAKA,EAAQ,SAAS,CACxD,EAGA,OAAKT,GAAG,WAAW+d,EAAa,YAAY,IAC1Crd,EAAcH,CAA2B,EAAI,IAI/C,MAAMP,GAAG,MAAM+d,EAAa,UAAW,CAAE,UAAW,EAAK,CAAC,EAEtD,OAAO,KAAKrd,CAAM,EAAE,OAAS,IAC3BA,EAAcH,CAA2B,IAC3CM,EAAO,MAAM,EACbA,EAAO,MACL,YAAYC,EAAY,KACtBid,EAAa,YACf,mBACF,GAGFld,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAGT,CACL,OAAAH,EACA,aAAAqd,CACF,CACF,CDrCA,OAAS,WAAApD,OAAe,YACxB,OAAS,KAAAxV,OAAS,MAEX,IAAM6Y,GAAqB7Y,GAAE,OAAO,CACzC,IAAKA,GAAE,OAAO,EACd,aAAcA,GAAE,OAAO,EACvB,UAAWA,GAAE,OAAO,CACtB,CAAC,EAEY8Y,GAAQ,IAAItD,GAAQ,EAC9B,KAAK,OAAO,EACZ,YAAY,wCAAwC,EACpD,SAAS,aAAc,6BAA8B,iBAAiB,EACtE,OACC,sBACA,uCACA,YACF,EACC,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,MAAOuD,EAAkBjN,IAAS,CACxC,GAAI,CACF,IAAMxQ,EAAUud,GAAmB,MAAM,CACvC,IAAU,WAAQ/M,EAAK,GAAG,EAC1B,aAAciN,EACd,UAAWjN,EAAK,MAClB,CAAC,EAEK,CAAE,aAAA8M,CAAa,EAAI,MAAMD,GAAerd,CAAO,EAC/CyK,EAAU,MAAS,YAAS6S,EAAa,aAAc,OAAO,EAE9DhS,EAASoS,GAAe,UAAU,KAAK,MAAMjT,CAAO,CAAC,EAEtDa,EAAO,UACVlL,EAAO,MACL,kCAAkCC,EAAY,KAC5Cid,EAAa,YACf,IACF,EACA,QAAQ,KAAK,CAAC,GAGhB,IAAMK,EAAexd,EAAQ,sBAAsB,EACnD,QAAWkc,KAAgB/Q,EAAO,KAAK,MAAO,CAC5C,GAAI,CAAC+Q,EAAa,MAChB,SAGFsB,EAAa,MAAM,YAAYtB,EAAa,SAAS,EAGrDA,EAAa,QACX,kDAGF,QAAWhL,KAAQgL,EAAa,MAC9BhL,EAAK,QAAa,MAAS,YACpB,WAAQiM,EAAa,IAAKjM,EAAK,IAAI,EACxC,OACF,EAIF,IAAM/F,EAAS4L,EAAmB,UAAUmF,CAAY,EACxD,GAAI,CAAC/Q,EAAO,QAAS,CACnBlL,EAAO,MACL,mCAAmCC,EAAY,KAC7Cgc,EAAa,IACf,IACF,EACA,SAIF,MAAS,aACF,WAAQiB,EAAa,UAAW,GAAGhS,EAAO,KAAK,WAAW,EAC/D,KAAK,UAAUA,EAAO,KAAM,KAAM,CAAC,CACrC,EAGFqS,EAAa,QAAQ,oBAAoB,CAC3C,OAASrZ,EAAP,CACAlE,EAAO,MAAM,EACbqW,EAAYnS,CAAK,CACnB,CACF,CAAC,EEhGH,OAAS,cAAA2F,GAAY,YAAY1K,OAAU,KAC3C,OAAOC,OAAU,OAajB,OAAS,WAAA0a,OAAe,YACxB,OAAS,aAAA0D,OAA8B,OACvC,OAAS,KAAAlZ,OAAS,MAElB,IAAMmZ,GAAsBnZ,GAAE,OAAO,CACnC,UAAWA,GAAE,OAAO,EAAE,SAAS,EAC/B,IAAKA,GAAE,QAAQ,EACf,IAAKA,GAAE,OAAO,EACd,KAAMA,GAAE,OAAO,EAAE,SAAS,CAC5B,CAAC,EAEYoZ,GAAO,IAAI5D,GAAQ,EAC7B,KAAK,MAAM,EACX,YAAY,wCAAwC,EACpD,SAAS,cAAe,oBAAoB,EAC5C,OAAO,YAAa,4BAA6B,EAAK,EACtD,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,MAAOxX,EAAM8N,IAAS,CAC5B,GAAI,CACF,IAAMxQ,EAAU6d,GAAoB,MAAM,CACxC,UAAWnb,EACX,GAAG8N,CACL,CAAC,EAEK1P,EAAMtB,GAAK,QAAQQ,EAAQ,GAAG,EAE/BiK,GAAWnJ,CAAG,IACjBV,EAAO,MAAM,YAAYU,qCAAuC,EAChE,QAAQ,KAAK,CAAC,GAGhB,IAAMc,EAAS,MAAMiZ,EAAU/Z,CAAG,EAC7Bc,IACHxB,EAAO,KACL,wCAAwCC,EAAY,QAClD,MACF,qCACF,EACA,QAAQ,KAAK,CAAC,GAGhB,IAAM4c,EAAgB,MAAMC,GAAiB,EAO7C,GALKD,IACHxG,EAAY,IAAI,MAAM,iCAAiC,CAAC,EACxD,QAAQ,KAAK,CAAC,GAGZ,CAACzW,EAAQ,UAAW,CACtB,IAAM4I,EAAYhH,EAAO,cAAc,WAGjCmc,EAAoBd,EAAc,OAAQ1F,GAAS,CACvD,QAAWlG,KAAQkG,EAAK,OAAS,CAAC,EAAG,CACnC,IAAMpN,EAAW3K,GAAK,QACpBoJ,EACA,OAAOyI,GAAS,SAAWA,EAAOA,EAAK,IACzC,EACA,GAAIpH,GAAWE,CAAQ,EACrB,MAAO,GAIX,MAAO,EACT,CAAC,EAGK6T,EAAwB,CAAC,EAC/B,QAAWvG,KAAasG,EAAmB,CACzC,IAAME,EAAU,MAAMC,GAAczG,EAAW7V,CAAM,EACjDqc,EAAQ,QACVD,EAAsB,KAAK,CACzB,KAAMvG,EAAU,KAChB,QAAAwG,CACF,CAAC,EAIAD,EAAsB,SACzB5d,EAAO,KAAK,mBAAmB,EAC/B,QAAQ,KAAK,CAAC,GAGhBA,EAAO,KAAK,kDAAkD,EAC9D,QAAWqX,KAAauG,EAAuB,CAC7C5d,EAAO,KAAK,KAAKqX,EAAU,MAAM,EACjC,QAAW0G,KAAU1G,EAAU,QAC7BrX,EAAO,KAAK,OAAO+d,EAAO,UAAU,EAGxC/d,EAAO,MAAM,EACbA,EAAO,KACL,OAAOC,EAAY,QAAQ,kBAAkB,uBAC/C,EACA,QAAQ,KAAK,CAAC,EAIhB,IAAMoX,EAAYwF,EAAc,KAC7B1F,GAASA,EAAK,OAASvX,EAAQ,SAClC,EAEKyX,IACHrX,EAAO,MACL,iBAAiBC,EAAY,QAC3BL,EAAQ,SACV,mBACF,EACA,QAAQ,KAAK,CAAC,GAGhB,IAAMie,EAAU,MAAMC,GAAczG,EAAW7V,CAAM,EAEhDqc,EAAQ,SACX7d,EAAO,KAAK,wBAAwBJ,EAAQ,YAAY,EACxD,QAAQ,KAAK,CAAC,GAGhB,QAAWme,KAAUF,EACnB7d,EAAO,KAAK,KAAK+d,EAAO,UAAU,EAClC,MAAMC,GAAUD,EAAO,KAAK,EAC5B/d,EAAO,KAAK,EAAE,CAElB,OAASkE,EAAP,CACAmS,EAAYnS,CAAK,CACnB,CACF,CAAC,EAEH,eAAe4Z,GACbzG,EACA7V,EACA,CACA,IAAMqV,EAAU,MAAMoH,GAAUzc,EAAO,MAAO,CAAC6V,CAAS,CAAC,EACnDjL,EAAY,MAAMwE,GAAqBpP,EAAO,SAAS,SAAS,EAEtE,GAAI,CAACqV,EACH,MAAO,CAAC,EAGV,IAAMgH,EAAU,CAAC,EAEjB,QAAW1G,KAAQN,EAAS,CAC1B,IAAMrO,EAAY,MAAM0V,GAAkB1c,EAAQ2V,CAAI,EAEtD,GAAK3O,EAIL,QAAWyI,KAAQkG,EAAK,OAAS,CAAC,EAAG,CACnC,IAAMpN,EAAW3K,GAAK,QACpBoJ,EACA,OAAOyI,GAAS,SAAWA,EAAOA,EAAK,IACzC,EAEA,GAAI,CAACpH,GAAWE,CAAQ,EACtB,SAGF,IAAMoU,EAAc,MAAMhf,GAAG,SAAS4K,EAAU,MAAM,EAEtD,GAAI,OAAOkH,GAAS,UAAY,CAACA,EAAK,QACpC,SAGF,IAAMmN,EAAkB,MAAMjO,GAAU,CACtC,SAAUc,EAAK,KACf,IAAKA,EAAK,QACV,OAAAzP,EACA,UAAA4K,CACF,CAAC,EAEKiS,EAAQb,GAAUY,EAA2BD,CAAW,EAC1DE,EAAM,OAAS,GACjBR,EAAQ,KAAK,CACX,SAAA9T,EACA,MAAAsU,CACF,CAAC,GAKP,OAAOR,CACT,CAEA,eAAeG,GAAUN,EAAgB,CACvCA,EAAK,QAASY,GAAS,CACrB,GAAIA,EACF,OAAIA,EAAK,MACA,QAAQ,OAAO,MAAMre,EAAY,QAAQqe,EAAK,KAAK,CAAC,EAEzDA,EAAK,QACA,QAAQ,OAAO,MAAMre,EAAY,MAAMqe,EAAK,KAAK,CAAC,EAGpD,QAAQ,OAAO,MAAMA,EAAK,KAAK,CAE1C,CAAC,CACH,CCpNA,OAAS,WAAAxE,OAAe,YAEjB,IAAMyE,GAAO,IAAIzE,GAAQ,EAC7B,KAAK,MAAM,EACX,YAAY,oCAAoC,EAChD,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,MAAO1J,GAAS,CACtBpQ,EAAO,KAAK,gBAAgB,EAC5B,QAAQ,IAAI,MAAMI,EAAegQ,EAAK,GAAG,CAAC,EAC1CpQ,EAAO,MAAM,EACbA,EAAO,KAAK,mBAAmB,EAC/B,QAAQ,IAAI,MAAMya,EAAUrK,EAAK,GAAG,CAAC,CACvC,CAAC,ECnBH,OAAOhR,OAAU,OCAjB,OAAS,eAAAof,OAAmB,SAC5B,OAAS,YAAYrf,OAAU,KAC/B,OAAS,UAAA6M,OAAc,KACvB,OAAO5M,OAAU,OASjB,OAAOqf,OAAQ,YACf,OAAO5V,OAAa,UACpB,OAAS,WAAA0G,GAAS,cAAAC,GAAY,cAAAtD,OAAkB,WAGhD,eAAsBwS,GAAald,EAAgB,CACjD,GAAI,CAACA,EAAO,cAAc,GACxB,MAAM,IAAI,MACR,8IACF,EAGF,IAAMmd,EAASnd,EAAO,cAAc,GAC9B,CAACkP,EAAOlD,CAAa,EAAI,MAAM,QAAQ,IAAI,CAC/CiR,GAAG,uBAAwB,CACzB,IAAKE,CACP,CAAC,EACDlR,GAAiB,CACnB,CAAC,EAED,GAAI,OAAO,KAAKD,CAAa,EAAE,SAAW,EACxC,MAAM,IAAI,MAAM,mDAAmD,EAGrE,IAAMoR,EAAiB,OAAO,QAAQvR,CAAc,EAAE,IACpD,CAAC,CAAC/K,EAAMuc,CAAW,KAAO,CACxB,MAAOA,EAAY,KACnB,MAAOvc,CACT,EACF,EAEMwc,EAAiB,MAAMjW,GAAQ,CACnC,CACE,KAAM,SACN,KAAM,gBACN,QAAS,wCAAwC5I,EAAY,KAC3D,cACF,KACA,QAAS2e,CACX,EACA,CACE,KAAM,SACN,KAAM,gBACN,QAAS,wCAAwC3e,EAAY,KAC3D,YACF,KACA,QAAS2e,CACX,CACF,CAAC,EAED,GAAIE,EAAe,gBAAkBA,EAAe,cAClD,MAAM,IAAI,MACR,sFACF,EAGF,GACE,EACEA,EAAe,iBAAiBzR,GAChCyR,EAAe,iBAAiBzR,GAGlC,MAAM,IAAI,MAAM,2DAA2D,EAG7E,IAAMK,EACJL,EAAeyR,EAAe,aAA4C,EACtEnR,EACJN,EAAeyR,EAAe,aAA4C,EACtE,CAAE,QAAAxC,CAAQ,EAAI,MAAMzT,GAAQ,CAChC,KAAM,UACN,KAAM,UACN,QAAS,GACT,QAAS,mBAAmB5I,EAAY,KACtCyQ,EAAM,MACR,cAAczQ,EAAY,KACxB,KAAKb,GAAK,SAASoC,EAAO,cAAc,IAAKmd,CAAM,GACrD,UAAU1e,EAAY,KAAKyN,EAAc,IAAI,QAAQzN,EAAY,KAC/D0N,EAAc,IAChB,cACF,CAAC,EAEI2O,IACHtc,EAAO,KAAK,sBAAsB,EAClC,QAAQ,KAAK,CAAC,GAGZ2N,EAAc,SAChB,MAAM7E,EAAmB,CAAC6E,EAAc,OAAO,EAAG,CAAC,EAAGnM,EAAQ,CAC5D,OAAQ,EACV,CAAC,EAGH,IAAMud,EAAmBhf,EAAQ,oBAAoB,GAAG,MAAM,EAE9D,MAAM,QAAQ,IACZ2Q,EAAM,IAAI,MAAOO,GAAS,CACxB8N,EAAiB,KAAO,aAAa9N,OAErC,IAAMlH,EAAW3K,GAAK,KAAKuf,EAAQ1N,CAAI,EACjCkN,EAAc,MAAMhf,GAAG,SAAS4K,EAAU,OAAO,EAEjDM,EAAU,MAAM2U,GACpBb,EACAW,EAAe,cACfA,EAAe,cACftR,CACF,EAEA,MAAMrO,GAAG,UAAU4K,EAAUM,CAAO,CACtC,CAAC,CACH,EAEA0U,EAAiB,QAAQ,qBAAqB,CAChD,CAEA,eAAsBC,GACpB3U,EACAqD,EACAC,EACAsR,EACA,CACA,IAAMC,EAAsB7R,EAAeK,CAAa,GAAG,OACrDyR,EAAsB9R,EAAeM,CAAa,GAAG,OAErDuC,EAAM,MAAM/Q,GAAG,QAAQC,GAAK,KAAK4M,GAAO,EAAG,SAAS,CAAC,EACrD+D,EAAU,IAAIR,GAAQ,CAC1B,gBAAiB,CAAC,CACpB,CAAC,EAEKe,EAAWlR,GAAK,KACpB8Q,EACA,gBAAgBsO,GAAY,CAAC,EAAE,SAAS,KAAK,OAC/C,EACMrS,EAAa4D,EAAQ,iBAAiBO,EAAUjG,EAAS,CAC7D,WAAYmF,GAAW,GACzB,CAAC,EAGG5B,EAA0B,CAAC,EAC/B,QAAWC,KAAqB1B,EAAW,sBAAsB,GAAK,CAAC,EACrE,GACE0B,EAAkB,mBAAmB,GAAG,QAAQ,IAChD,IAAIqR,KAKN,SAAWpR,KAAaD,EAAkB,gBAAgB,GAAK,CAAC,EAAG,CACjE,IAAME,EAAWD,EAAU,QAAQ,EAG7BE,EAAe,OAAO,OAAOiR,CAAY,EAAE,KAC9C/Q,GAASA,EAAKR,CAAa,IAAMK,CACpC,IAAIJ,CAAa,EAEb,CAACK,GAAgBJ,EAAc,SAASI,CAAY,IAIxDJ,EAAc,KAAKI,CAAY,EAG/BF,EAAU,OAAO,EAGjB3B,EACG,qBAAqBD,GAAW,qBAAqB,EACrD,OAAQ1J,GAASA,EAAK,eAAe,GAAG,QAAQ,IAAMuL,CAAQ,EAC9D,QAASvL,GAASA,EAAK,eAAe,GAAG,gBAAgBwL,CAAY,CAAC,GAIvEH,EAAkB,gBAAgB,GAAG,SAAW,GAClDA,EAAkB,OAAO,EAI7B,OAAID,EAAc,OAAS,GACzBzB,EAAW,qBAAqB,CAC9B,gBAAiBgT,EACjB,aAAcvR,EAAc,IAAKM,IAAU,CACzC,KAAMA,CACR,EAAE,CACJ,CAAC,EAGI,MAAM/B,EAAW,QAAQ,CAClC,CCxMA,OAAS,YAAYhN,OAAU,KAC/B,OAAOC,OAAU,OAOjB,OAAOqf,OAAQ,YACf,OAAO5V,OAAa,UAEpB,SAASuW,GAAaC,EAAqB,CACzC,OAAOA,EACJ,MAAM,GAAG,EACT,IAAKf,GAASA,EAAK,OAAO,CAAC,EAAE,YAAY,EAAIA,EAAK,MAAM,CAAC,CAAC,EAC1D,KAAK,EAAE,CACZ,CAEA,SAASgB,GACPC,EACAC,EACAC,EACAC,EACA,CASA,IAAMC,EANiBJ,EACpB,QAAQ,YAAa,EAAE,EACvB,QAAQ,oBAAqB,EAAE,EAC/B,QAAQ,OAAQ,GAAG,EACnB,KAAK,EAGL,MAAM,GAAG,EACT,IAAKK,GAAeA,EAAW,KAAK,CAAC,EACrC,OAAO,OAAO,EAEjB,QAAWA,KAAcD,EAAiB,CACxC,IAAME,EAAkBD,EAAW,MAAM,kCAAkC,EACrEE,EAAaF,EAAW,MAAM,sBAAsB,EAE1D,GAAIC,EAAiB,CAEnB,IAAME,EAAaF,EAAgB,CAAC,EAC9BG,EAAcH,EAAgB,CAAC,EAEjCH,IAAgB,QAAUK,IAAe,QAAU,CAACC,EACtDP,EAAQ,KAAK,CACX,KAAM,OACN,MAAO,gBACP,OAAQ,EACV,CAAC,EAEDA,EAAQ,KAAK,CACX,KAAMM,EACN,MAAOC,EACP,OAAQ,EACV,CAAC,UAEMF,EAAY,CAErB,IAAMC,EAAaD,EAAW,CAAC,EACzBE,EAAcF,EAAW,CAAC,EAG9BJ,IAAgB,QAChBK,IAAe,QACfC,IAAgB,OAEhBP,EAAQ,KAAK,CACX,KAAM,OACN,MAAO,gBACP,OAAQD,CACV,CAAC,EAEDC,EAAQ,KAAK,CACX,KAAMM,EACN,MAAOC,EACP,OAAQR,CACV,CAAC,OAKCE,IAAgB,QAAUE,IAAe,OAC3CH,EAAQ,KAAK,CACX,KAAM,OACN,MAAO,gBACP,OAAQD,CACV,CAAC,EAEDC,EAAQ,KAAK,CACX,KAAMG,EACN,OAAQJ,CACV,CAAC,EAIT,CAEA,eAAsBS,GACpBze,EACA5B,EAA6B,CAAC,EAC9B,CACA,GAAI,CAAC4B,EAAO,cAAc,GACxB,MAAM,IAAI,MACR,8IACF,EAGF,IAAMmd,EAASnd,EAAO,cAAc,GAC9BkP,EAAQ,MAAM+N,GAAG,uBAAwB,CAC7C,IAAKE,CACP,CAAC,EAED,GAAI,CAAC/e,EAAQ,IAAK,CAChB,GAAM,CAAE,QAAA0c,CAAQ,EAAI,MAAMzT,GAAQ,CAChC,KAAM,UACN,KAAM,UACN,QAAS,GACT,QAAS,mBAAmB5I,EAAY,KACtCyQ,EAAM,MACR,cAAczQ,EAAY,KACxB,KAAKb,GAAK,SAASoC,EAAO,cAAc,IAAKmd,CAAM,GACrD,QAAQ1e,EAAY,KAAK,UAAU,cACrC,CAAC,EAEIqc,IACHtc,EAAO,KAAK,sBAAsB,EAClC,QAAQ,KAAK,CAAC,GAIlB,IAAM+e,EAAmBhf,EAAQ,sBAAsB,GAAG,MAAM,EAC1DmgB,EAAgB,IAAI,IAE1B,MAAM,QAAQ,IACZxP,EAAM,IAAI,MAAOO,GAAS,CACxB8N,EAAiB,KAAO,aAAa9N,OAErC,IAAMlH,EAAW3K,GAAK,KAAKuf,EAAQ1N,CAAI,EACjCkN,EAAc,MAAMhf,GAAG,SAAS4K,EAAU,OAAO,EAEjD,CAAE,QAAAM,EAAS,iBAAA8V,CAAiB,EAAI,MAAMC,GAAiBjC,CAAW,EAGxEgC,EAAiB,QAASE,GAAQH,EAAc,IAAIG,CAAG,CAAC,EAExD,MAAMlhB,GAAG,UAAU4K,EAAUM,CAAO,CACtC,CAAC,CACH,EAEA0U,EAAiB,QAAQ,oBAAoB,EAG7C,IAAMuB,EAAiBvgB,EAAQ,0BAA0B,GAAG,MAAM,EAElE,GAAI,CACF,IAAMwgB,EAAczb,EAAetD,EAAO,cAAc,IAAK,EAAK,EAElE,GAAI,CAAC+e,EAAa,CAChBD,EAAe,KAAK,6BAA6B,EACjDtgB,EAAO,KACL,0GACF,EACA,OAGF,IAAMwgB,EAAqB,MAAM,KAAKN,CAAa,EAG7CO,EAAkB,CAAC,eAAgB,iBAAiB,EAC1D,QAAWC,KAAWD,EACpB,GAAIF,EAAYG,CAAO,EACrB,QAAWL,KAAOG,EACZD,EAAYG,CAAO,EAAGL,CAAG,GAC3B,OAAOE,EAAYG,CAAO,EAAGL,CAAG,EAOxC,GAAIG,EAAmB,OAAS,EAAG,CAC5BD,EAAY,eACfA,EAAY,aAAe,CAAC,GAE9BA,EAAY,aAAa,UAAU,EAAI,SAEvC,IAAMI,EAAkBvhB,GAAK,KAC3BoC,EAAO,cAAc,IACrB,cACF,EACA,MAAMrC,GAAG,UACPwhB,EACA,KAAK,UAAUJ,EAAa,KAAM,CAAC,EAAI;AAAA,CACzC,EAEAD,EAAe,QAAQ,uBAAuB,EAG9C,MAAMxX,EAAmB,CAAC,UAAU,EAAG,CAAC,EAAGtH,EAAQ,CAAE,OAAQ,EAAM,CAAC,OAEpE8e,EAAe,QAAQ,oCAAoC,CAE/D,MAAE,CACAA,EAAe,KAAK,+BAA+B,EACnDtgB,EAAO,KACL,2EACF,CACF,CACF,CAEA,eAAsBogB,GACpB/V,EAC0D,CAG1D,IAAMuW,EACJ,uGAEInB,EAAqE,CAAC,EACtEoB,EAA0B,CAAC,EAC3BV,EAA6B,CAAC,EAChCW,EAAa,IACbC,EAAe,GAEf7V,EAASb,EACTgH,EAGJ,MAAQA,EAAQuP,EAAmB,KAAKvW,CAAO,KAAO,MAAM,CAC1D,GAAM,CACJ2W,EACAC,EACAC,EACA3B,EACAnY,EACAsY,EACAyB,CACF,EAAI9P,EAGJ,GAAIqO,IAAgB,SAAWA,EAAY,WAAW,QAAQ,EAC5D,SAGFmB,EAAc,KAAKG,CAAS,EAGxBH,EAAc,SAAW,IAC3BC,EAAa1Z,EACb2Z,EAAeI,IAAc,KAI/BhB,EAAiB,KAAK,mBAAmBT,GAAa,EAEtD,IAAMF,EAAa,EAAQyB,EAE3B,GAAIC,EAAgB,CAElB,IAAME,EAAgBhC,GAAaM,CAAW,EAC9CD,EAAQ,KAAK,CACX,KAAM2B,EACN,MAAOF,EACP,OAAQ1B,CACV,CAAC,OACQD,GAKTD,GAAoBC,EAAcC,EAAYC,EAASC,CAAW,EAItE,GAAID,EAAQ,SAAW,EACrB,MAAO,CACL,QAAApV,EACA,iBAAkB,CAAC,CACrB,EAKF,IAAMgX,EAAgB5B,EAAQ,OAC5B,CAACM,EAAYuB,EAAOC,IAClBD,IACAC,EAAK,UACF7S,GACCA,EAAE,OAASqR,EAAW,MACtBrR,EAAE,QAAUqR,EAAW,OACvBrR,EAAE,SAAWqR,EAAW,MAC5B,CACJ,EAYMyB,EAAgB,YATHH,EAChB,IAAKI,GAAQ,CACZ,IAAMC,EAAaD,EAAI,OAAS,QAAU,GAC1C,OAAOA,EAAI,MACP,GAAGC,IAAaD,EAAI,WAAWA,EAAI,QACnC,GAAGC,IAAaD,EAAI,MAC1B,CAAC,EACA,KAAK,IAAI,YAE2CX,YAAqBA,IAC1EC,EAAe,IAAM,KAIvB7V,EAAS2V,EAAc,OAAO,CAACc,EAAKnX,EAAM8W,IACjCK,EAAI,QAAQnX,EAAM8W,IAAU,EAAIE,EAAgB,EAAE,EACxDtW,CAAM,EAGTA,EAASA,EAAO,QAAQ,gBAAiB;AAAA;AAAA,CAAM,EAMzBmW,EAAc,KACjCI,GAAQA,EAAI,OAAS,QAAUA,EAAI,QAAU,eAChD,IAgEEvW,EA5DcA,EAAO,MAAM;AAAA,CAAI,EACA,IAAKV,GAAS,CAE3C,GAAIA,EAAK,KAAK,EAAE,WAAW,SAAS,EAClC,OAAOA,EAGT,IAAIoX,EAAkBpX,EAMtB,OAAAoX,EAAkBA,EAAgB,QAChC,iCACA,0BACF,EAEAA,EAAkBA,EAAgB,QAChC,0CACA,mDACF,EAEAA,EAAkBA,EAAgB,QAChC,mCACA,6CACF,EAEAA,EAAkBA,EAAgB,QAChC,uBACA,0BACF,EAGAA,EAAkBA,EAAgB,QAChC,YACA,CAACvQ,EAAOwQ,EAAQC,IAAW,CAEzB,IAAMC,EAAcD,EAAO,UAAU,EAAGD,CAAM,EACxCG,GAAcD,EAAY,MAAM,IAAI,GAAK,CAAC,GAAG,OAC7CE,IAAoBF,EAAY,MAAM,IAAI,GAAK,CAAC,GAAG,OAGzD,OAAIC,EAAa,IAAM,GAAKC,GAAmB,IAAM,EAC5C5Q,EAGF,sBACT,CACF,EAGAuQ,EAAkBA,EAAgB,QAChC,wBACA,oBACF,EAEOA,CACT,CAAC,EAEyB,KAAK;AAAA,CAAI,GAIrC,IAAMM,EAAyB,MAAM,KAAK,IAAI,IAAI/B,CAAgB,CAAC,EAEnE,MAAO,CACL,QAASjV,EACT,iBAAkBgX,CACpB,CACF,CC/YA,OAAO9iB,OAAU,OAOjB,OAAOD,OAAQ,WAGf,eAAsBgjB,GACpBviB,EACA,CACA,IAAMC,EAAkC,CAAC,EAIzC,GACE,CAACV,GAAG,WAAWS,EAAQ,GAAG,GAC1B,CAACT,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAK,cAAc,CAAC,EAExD,OAAAC,EAAcR,CAA4B,EAAI,GACvC,CACL,OAAAQ,EACA,OAAQ,IACV,EAIF,GAAI,CAACV,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAK,iBAAiB,CAAC,EAC7D,OAAAC,EAAcP,CAAc,EAAI,GACzB,CACL,OAAAO,EACA,OAAQ,IACV,EAGF,GAAI,CACF,IAAM2B,EAAS,MAAMiZ,EAAU7a,EAAQ,GAAG,EAE1C,MAAO,CACL,OAAAC,EACA,OAAQ2B,CACV,CACF,MAAE,CACAxB,EAAO,MAAM,EACbA,EAAO,MACL,cAAcC,EAAY,KACxB,iBACF,uBAAuBA,EAAY,KACjCL,EAAQ,GACV;AAAA,0DAA+DK,EAAY,KACzE,iBACF,yBAAyBA,EAAY,KAAK,MAAM,YAClD,EACAD,EAAO,MACL,iBAAiBC,EAAY,KAC3B,4CACF,IACF,EACAD,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,CAChB,CACF,CHxDA,OAAS,WAAA8Z,OAAe,YACxB,OAAS,KAAAxV,OAAS,MAEX,IAAM8d,GAAa,CACxB,CACE,KAAM,QACN,YAAa,yDACf,EACA,CACE,KAAM,QACN,YAAa,sBACf,CACF,EAEaC,GAAuB/d,GAAE,OAAO,CAC3C,IAAKA,GAAE,OAAO,EACd,KAAMA,GAAE,QAAQ,EAChB,IAAKA,GAAE,QAAQ,EACf,UAAWA,GACR,OAAO,EACP,OACEjB,GACCA,GAAS+e,GAAW,KAAME,GAAcA,EAAU,OAASjf,CAAK,EAClE,CACE,QACE,8FACJ,CACF,EACC,SAAS,CACd,CAAC,EAEYkf,GAAU,IAAIzI,GAAQ,EAChC,KAAK,SAAS,EACd,YAAY,kBAAkB,EAC9B,SAAS,cAAe,uBAAuB,EAC/C,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,aAAc,uBAAwB,EAAK,EAClD,OAAO,YAAa,4BAA6B,EAAK,EACtD,OAAO,MAAOwI,EAAWlS,IAAS,CACjC,GAAI,CACF,IAAMxQ,EAAUyiB,GAAqB,MAAM,CACzC,IAAKjjB,GAAK,QAAQgR,EAAK,GAAG,EAC1B,UAAAkS,EACA,KAAMlS,EAAK,KACX,IAAKA,EAAK,GACZ,CAAC,EAED,GAAIxQ,EAAQ,MAAQ,CAACA,EAAQ,UAAW,CACtCI,EAAO,KAAK,uBAAuB,EACnC,QAAWsiB,KAAaF,GACtBpiB,EAAO,KAAK,KAAKsiB,EAAU,SAASA,EAAU,aAAa,EAE7D,OAGF,GAAI,CAAC1iB,EAAQ,UACX,MAAM,IAAI,MACR,wFACF,EAGF,GAAI,CAAE,OAAAC,EAAQ,OAAA2B,CAAO,EAAI,MAAM2gB,GAAiBviB,CAAO,EAEvD,GACEC,EAAcR,CAA4B,GAC1CQ,EAAcP,CAAc,EAE5B,MAAM,IAAI,MACR,8EACF,EAGF,GAAI,CAACkC,EACH,MAAM,IAAI,MACR,kHACF,EAGE5B,EAAQ,YAAc,SACxB,MAAM8e,GAAald,CAAM,EAGvB5B,EAAQ,YAAc,SACxB,MAAMqgB,GAAaze,EAAQ,CAAE,IAAK5B,EAAQ,GAAI,CAAC,CAEnD,OAASsE,EAAP,CACAlE,EAAO,MAAM,EACbqW,EAAYnS,CAAK,CACnB,CACF,CAAC,EIpGH,UAAY/E,MAAQ,cACpB,UAAYC,OAAU,OCDtB,OAAOA,OAAU,OAMjB,OAAOD,OAAQ,WAGf,eAAsBqjB,GACpB5iB,EACA,CACA,IAAMC,EAAkC,CAAC,EAEnCqd,EAAe,CACnB,IAAKtd,EAAQ,IACb,aAAcR,GAAK,QAAQQ,EAAQ,IAAKA,EAAQ,YAAY,EAC5D,UAAWR,GAAK,QAAQQ,EAAQ,IAAKA,EAAQ,SAAS,CACxD,EAGA,GAAI,CAACT,GAAG,WAAW+d,EAAa,YAAY,EAC1C,OAAArd,EAAcH,CAA2B,EAAI,GACtC,CACL,OAAAG,EACA,aAAc,KACd,OAAQ,IACV,EAIF,GAAI,CAACV,GAAG,WAAWC,GAAK,QAAQQ,EAAQ,IAAK,iBAAiB,CAAC,EAC7D,OAAAC,EAAcP,CAAc,EAAI,GACzB,CACL,OAAAO,EACA,aAAc,KACd,OAAQ,IACV,EAIF,MAAMV,GAAG,MAAM+d,EAAa,UAAW,CAAE,UAAW,EAAK,CAAC,EAE1D,GAAI,CACF,IAAM1b,EAAS,MAAMiZ,EAAU7a,EAAQ,GAAG,EAE1C,MAAO,CACL,OAAAC,EACA,OAAQ2B,EACR,aAAA0b,CACF,CACF,MAAE,CACAld,EAAO,MAAM,EACbA,EAAO,MACL,cAAcC,EAAY,KACxB,iBACF,uBAAuBA,EAAY,KACjCL,EAAQ,GACV;AAAA,6DAAkEK,EAAY,KAC5E,iBACF,yBAAyBA,EAAY,KAAK,MAAM,YAClD,EACAD,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,CAChB,CACF,CDrDA,OAAS,WAAA8Z,OAAe,YACxB,OAAS,KAAAxV,OAAS,MAEX,IAAM6Y,GAAqB7Y,GAAE,OAAO,CACzC,IAAKA,GAAE,OAAO,EACd,aAAcA,GAAE,OAAO,EACvB,UAAWA,GAAE,OAAO,EACpB,QAASA,GAAE,QAAQ,EAAE,SAAS,EAAE,QAAQ,EAAK,CAC/C,CAAC,EAEY8Y,GAAQ,IAAItD,GAAQ,EAC9B,KAAK,gBAAgB,EACrB,YAAY,oCAAoC,EAChD,SAAS,aAAc,6BAA8B,iBAAiB,EACtE,OACC,sBACA,uCACA,YACF,EACC,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,gBAAiB,gBAAgB,EACxC,OAAO,MAAOuD,EAAkBjN,IAAS,CACxC,MAAMqS,GAAc,CAClB,IAAU,WAAQrS,EAAK,GAAG,EAC1B,aAAciN,EACd,UAAWjN,EAAK,OAChB,QAASA,EAAK,OAChB,CAAC,CACH,CAAC,EAEH,eAAeqS,GAAcrS,EAA0C,CACrE,GAAI,CACF,IAAMxQ,EAAUud,GAAmB,MAAM/M,CAAI,EAEvC,CAAC,CAAE,OAAAvQ,EAAQ,aAAAqd,EAAc,OAAA1b,CAAO,EAAGrB,CAAW,EAAI,MAAM,QAAQ,IAAI,CACxEqiB,GAAuB5iB,CAAO,EAC9BQ,EAAeR,EAAQ,GAAG,CAC5B,CAAC,GAEGC,EAAcP,CAAc,GAAK,CAACkC,GAAU,CAACrB,KAC/CH,EAAO,MACL,KAAKC,EAAY,KACf,iBACF,iDAAiDA,EAAY,KAC3D,aACF,kBACF,EACAD,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,IAGZH,EAAcH,CAA2B,GAAK,CAACwd,KACjDld,EAAO,MACL,wCAAwCC,EAAY,KAC7C,WAAQL,EAAQ,IAAKA,EAAQ,YAAY,CAChD,IACF,EACAI,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAGhB,IAAMqK,EAAU,MAAS,WAAS6S,EAAa,aAAc,OAAO,EAC9DhS,EAASoS,GAAe,UAAU,KAAK,MAAMjT,CAAO,CAAC,EAEtDa,EAAO,UACVlL,EAAO,MACL,kCAAkCC,EAAY,KAC5Cid,EAAa,YACf,IACF,EACAld,EAAO,MAAM,EACb,QAAQ,KAAK,CAAC,GAGhB,IAAMud,EAAexd,EAAQ,sBAAsB,EAG7C2iB,EAAmB,MAAM/L,GAC7BzL,EAAO,KACP1J,EACArB,CACF,EAGA,QAAW8b,KAAgByG,EAAiB,MAE1CzG,EAAa,MAAQA,EAAa,OAAO,OACvC,CAAChL,EAAMqQ,EAAOC,IACZD,IAAUC,EAAK,UAAWoB,GAAMA,EAAE,OAAS1R,EAAK,IAAI,CACxD,EAGIgL,EAAa,eACfA,EAAa,aAAeA,EAAa,aAAa,OACpD,CAACrS,EAAK0X,EAAOC,IAASD,IAAUC,EAAK,UAAWqB,GAAMA,IAAMhZ,CAAG,CACjE,GAIJ,QAAWqS,KAAgByG,EAAiB,MAAO,CACjD,GAAI,CAACzG,EAAa,MAChB,SAGFsB,EAAa,MAAM,YAAYtB,EAAa,SAAS,EAGrDA,EAAa,QACX,kDAEF,QAAWhL,KAAQgL,EAAa,MAAO,CACrC,IAAM4G,EAAe,WAAQ3F,EAAa,IAAKjM,EAAK,IAAI,EACxD,GAAI,CAEF,GAAI,EADS,MAAS,OAAK4R,CAAO,GACxB,OAAO,EACf,SAEF5R,EAAK,QAAa,MAAS,WAAS4R,EAAS,OAAO,CACtD,OAASC,EAAP,CACA,QAAQ,MAAM,wCAAyCD,EAASC,CAAG,EACnE,QACF,EAGF,IAAM5X,EAAS4L,EAAmB,UAAUmF,CAAY,EACxD,GAAI,CAAC/Q,EAAO,QAAS,CACnBlL,EAAO,MACL,mCAAmCC,EAAY,KAC7Cgc,EAAa,IACf,IACF,EACA,SAIF,MAAS,YACF,WAAQiB,EAAa,UAAW,GAAGhS,EAAO,KAAK,WAAW,EAC/D,KAAK,UAAUA,EAAO,KAAM,KAAM,CAAC,CACrC,EAWF,GAPA,MAAS,WACPgS,EAAa,aACR,WAAQA,EAAa,UAAW,eAAe,CACtD,EAEAK,EAAa,QAAQ,oBAAoB,EAErC3d,EAAQ,QAAS,CACnBG,EACE,oBAAoBE,EAAY,KAC9ByiB,EAAiB,MAAM,OAAO,SAAS,CACzC,UACF,EAAE,QAAQ,EACV,QAAWvL,KAAQuL,EAAiB,MAAO,CACzC1iB,EAAO,IAAI,OAAOmX,EAAK,SAASlX,EAAY,KAAKkX,EAAK,IAAI,IAAI,EAC9D,QAAWlG,KAAQkG,EAAK,OAAS,CAAC,EAChCnX,EAAO,IAAI,SAASiR,EAAK,MAAM,GAIvC,OAAS/M,EAAP,CACAlE,EAAO,MAAM,EACbqW,EAAYnS,CAAK,CACnB,CACF,CAGA,eAAeyS,GACb0G,EACA7b,EACArB,EACyC,CACzC,QAAWgX,KAAQkG,EAAS,MAC1B,GAAKlG,EAAK,OAAO,OAKjB,QAAWlG,KAAQkG,EAAK,MAAO,CAC7B,IAAM4L,EAAU,MAAMC,GACpB/R,EAAK,KACLzP,EACArB,CACF,EAGA4iB,EAAQ,MAAQA,EAAQ,OAAO,OAAQ3R,GAAMA,EAAE,OAASH,EAAK,IAAI,EAE7D8R,EAAQ,OACV5L,EAAK,MAAM,KAAK,GAAG4L,EAAQ,KAAK,EAG9BA,EAAQ,eACV5L,EAAK,aAAeA,EAAK,aACrBA,EAAK,aAAa,OAAO4L,EAAQ,YAAY,EAC7CA,EAAQ,cAKlB,OAAO1F,CACT,CExNA,OAAS,wBAAA4F,OAA4B,4CACrC,OAAS,WAAAnJ,OAAe,YAEjB,IAAMoJ,GAAM,IAAIpJ,GAAQ,EAC5B,KAAK,cAAc,EACnB,YAAY,+CAA+C,EAC3D,OACC,kBACA,4DACA,QAAQ,IAAI,CACd,EACC,OAAO,SAAY,CAClB,GAAI,CACF,IAAMqJ,EAAY,IAAIF,GACtB,MAAMG,GAAO,QAAQD,CAAS,CAChC,OAASjf,EAAP,CACAlE,EAAO,MAAM,EACbqW,EAAYnS,CAAK,CACnB,CACF,CAAC,ECbH,OAAS,WAAA4V,OAAe,YCTxB,IAAAuJ,GAAA,CACE,KAAQ,SACR,QAAW,SACX,YAAe,+BACf,cAAiB,CACf,OAAU,QACZ,EACA,QAAW,MACX,OAAU,CACR,KAAQ,SACR,IAAO,4BACT,EACA,WAAc,CACZ,KAAQ,MACR,IAAO,mCACP,UAAa,iBACf,EACA,MAAS,CACP,MACF,EACA,SAAY,CACV,aACA,KACA,WACA,WACA,QACF,EACA,KAAQ,SACR,QAAW,CACT,IAAK,CACH,MAAS,oBACT,QAAW,iBACb,EACA,aAAc,CACZ,MAAS,6BACT,QAAW,0BACb,EACA,QAAS,CACP,MAAS,wBACT,QAAW,qBACb,CACF,EACA,IAAO,kBACP,QAAW,CACT,IAAO,eACP,MAAS,OACT,UAAa,eACb,MAAS,mCACT,YAAa,oEACb,aAAc,oEACd,MAAS,qBACT,eAAgB,+CAChB,eAAgB,+CAChB,QAAW,oBACX,WAAY,wEACZ,WAAY,wEACZ,cAAe,6CACf,KAAQ,aACR,WAAY,iDACd,EACA,aAAgB,CACd,YAAa,UACb,cAAe,UACf,gBAAiB,UACjB,qCAAsC,UACtC,4BAA6B,UAC7B,UAAa,UACb,YAAe,SACf,UAAa,SACb,KAAQ,SACR,MAAS,SACT,YAAa,SACb,WAAY,UACZ,oBAAqB,SACrB,MAAS,SACT,IAAO,SACP,aAAc,SACd,IAAO,SACP,QAAW,UACX,QAAW,SACX,OAAU,UACV,mBAAoB,SACpB,WAAY,UACZ,iBAAkB,SAClB,IAAO,UACP,qBAAsB,SACxB,EACA,gBAAmB,CACjB,qBAAsB,UACtB,cAAe,SACf,kBAAmB,UACnB,iBAAkB,SAClB,0BAA2B,SAC3B,OAAU,SACV,KAAQ,SACR,YAAa,SACb,WAAc,QAChB,CACF,EDrFA,QAAQ,GAAG,SAAU,IAAM,QAAQ,KAAK,CAAC,CAAC,EAC1C,QAAQ,GAAG,UAAW,IAAM,QAAQ,KAAK,CAAC,CAAC,EAE3C,eAAeC,IAAO,CACpB,IAAMC,EAAU,IAAIzJ,GAAQ,EACzB,KAAK,QAAQ,EACb,YAAY,iDAAiD,EAC7D,QACCuJ,GAAY,SAAW,QACvB,gBACA,4BACF,EAEFE,EACG,WAAWpJ,EAAI,EACf,WAAWiC,EAAG,EACd,WAAWsB,EAAI,EACf,WAAW6E,EAAO,EAClB,WAAWhE,EAAI,EACf,WAAWnB,EAAK,EAGnBmG,EAAQ,WAAWnG,EAAa,EAAE,WAAW8F,EAAW,EAExDK,EAAQ,MAAM,CAChB,CAEAD,GAAK","sourcesContent":["import fs from \"fs\"\nimport path from \"path\"\nimport { runInit } from \"@/src/commands/init\"\nimport { preFlightAdd } from \"@/src/preflights/preflight-add\"\nimport { getRegistryIndex, getRegistryItem } from \"@/src/registry/api\"\nimport { registryItemTypeSchema } from \"@/src/registry/schema\"\nimport {\n  isLocalFile,\n  isUniversalRegistryItem,\n  isUrl,\n} from \"@/src/registry/utils\"\nimport { addComponents } from \"@/src/utils/add-components\"\nimport { createProject } from \"@/src/utils/create-project\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { createConfig, getConfig } from \"@/src/utils/get-config\"\nimport { getProjectInfo } from \"@/src/utils/get-project-info\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { updateAppIndex } from \"@/src/utils/update-app-index\"\nimport { Command } from \"commander\"\nimport prompts from \"prompts\"\nimport { z } from \"zod\"\n\nconst DEPRECATED_COMPONENTS = [\n  {\n    name: \"toast\",\n    deprecatedBy: \"sonner\",\n    message:\n      \"The toast component is deprecated. Use the sonner component instead.\",\n  },\n  {\n    name: \"toaster\",\n    deprecatedBy: \"sonner\",\n    message:\n      \"The toaster component is deprecated. Use the sonner component instead.\",\n  },\n]\n\nexport const addOptionsSchema = z.object({\n  components: z.array(z.string()).optional(),\n  yes: z.boolean(),\n  overwrite: z.boolean(),\n  cwd: z.string(),\n  all: z.boolean(),\n  path: z.string().optional(),\n  silent: z.boolean(),\n  srcDir: z.boolean().optional(),\n  cssVariables: z.boolean(),\n})\n\nexport const add = new Command()\n  .name(\"add\")\n  .description(\"add a component to your project\")\n  .argument(\"[components...]\", \"names, url or local path to component\")\n  .option(\"-y, --yes\", \"skip confirmation prompt.\", false)\n  .option(\"-o, --overwrite\", \"overwrite existing files.\", false)\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .option(\"-a, --all\", \"add all available components\", false)\n  .option(\"-p, --path <path>\", \"the path to add the component to.\")\n  .option(\"-s, --silent\", \"mute output.\", false)\n  .option(\n    \"--src-dir\",\n    \"use the src directory when creating a new project.\",\n    false\n  )\n  .option(\n    \"--no-src-dir\",\n    \"do not use the src directory when creating a new project.\"\n  )\n  .option(\"--css-variables\", \"use css variables for theming.\", true)\n  .option(\"--no-css-variables\", \"do not use css variables for theming.\")\n  .action(async (components, opts) => {\n    try {\n      const options = addOptionsSchema.parse({\n        components,\n        cwd: path.resolve(opts.cwd),\n        ...opts,\n      })\n\n      let itemType: z.infer<typeof registryItemTypeSchema> | undefined\n      let registryItem: any = null\n\n      if (\n        components.length > 0 &&\n        (isUrl(components[0]) || isLocalFile(components[0]))\n      ) {\n        registryItem = await getRegistryItem(components[0], \"\")\n        itemType = registryItem?.type\n      }\n\n      if (\n        !options.yes &&\n        (itemType === \"registry:style\" || itemType === \"registry:theme\")\n      ) {\n        logger.break()\n        const { confirm } = await prompts({\n          type: \"confirm\",\n          name: \"confirm\",\n          message: highlighter.warn(\n            `You are about to install a new ${itemType.replace(\n              \"registry:\",\n              \"\"\n            )}. \\nExisting CSS variables and components will be overwritten. Continue?`\n          ),\n        })\n        if (!confirm) {\n          logger.break()\n          logger.log(`Installation cancelled.`)\n          logger.break()\n          process.exit(1)\n        }\n      }\n\n      if (!options.components?.length) {\n        options.components = await promptForRegistryComponents(options)\n      }\n\n      const projectInfo = await getProjectInfo(options.cwd)\n      if (projectInfo?.tailwindVersion === \"v4\") {\n        const deprecatedComponents = DEPRECATED_COMPONENTS.filter((component) =>\n          options.components?.includes(component.name)\n        )\n\n        if (deprecatedComponents?.length) {\n          logger.break()\n          deprecatedComponents.forEach((component) => {\n            logger.warn(highlighter.warn(component.message))\n          })\n          logger.break()\n          process.exit(1)\n        }\n      }\n\n      if (isUniversalRegistryItem(registryItem)) {\n        // Universal items only cares about the cwd.\n        if (!fs.existsSync(options.cwd)) {\n          throw new Error(`Directory ${options.cwd} does not exist`)\n        }\n\n        const minimalConfig = createConfig({\n          resolvedPaths: {\n            cwd: options.cwd,\n          },\n        })\n\n        await addComponents(options.components, minimalConfig, options)\n        return\n      }\n\n      let { errors, config } = await preFlightAdd(options)\n\n      // No components.json file. Prompt the user to run init.\n      if (errors[ERRORS.MISSING_CONFIG]) {\n        const { proceed } = await prompts({\n          type: \"confirm\",\n          name: \"proceed\",\n          message: `You need to create a ${highlighter.info(\n            \"components.json\"\n          )} file to add components. Proceed?`,\n          initial: true,\n        })\n\n        if (!proceed) {\n          logger.break()\n          process.exit(1)\n        }\n\n        config = await runInit({\n          cwd: options.cwd,\n          yes: true,\n          force: true,\n          defaults: false,\n          skipPreflight: false,\n          silent: true,\n          isNewProject: false,\n          srcDir: options.srcDir,\n          cssVariables: options.cssVariables,\n          style: \"index\",\n        })\n      }\n\n      let shouldUpdateAppIndex = false\n      if (errors[ERRORS.MISSING_DIR_OR_EMPTY_PROJECT]) {\n        const { projectPath, template } = await createProject({\n          cwd: options.cwd,\n          force: options.overwrite,\n          srcDir: options.srcDir,\n          components: options.components,\n        })\n        if (!projectPath) {\n          logger.break()\n          process.exit(1)\n        }\n        options.cwd = projectPath\n\n        if (template === \"next-monorepo\") {\n          options.cwd = path.resolve(options.cwd, \"apps/web\")\n          config = await getConfig(options.cwd)\n        } else {\n          config = await runInit({\n            cwd: options.cwd,\n            yes: true,\n            force: true,\n            defaults: false,\n            skipPreflight: true,\n            silent: true,\n            isNewProject: true,\n            srcDir: options.srcDir,\n            cssVariables: options.cssVariables,\n            style: \"index\",\n          })\n\n          shouldUpdateAppIndex =\n            options.components?.length === 1 &&\n            !!options.components[0].match(/\\/chat\\/b\\//)\n        }\n      }\n\n      if (!config) {\n        throw new Error(\n          `Failed to read config at ${highlighter.info(options.cwd)}.`\n        )\n      }\n\n      await addComponents(options.components, config, options)\n\n      // If we're adding a single component and it's from the v0 registry,\n      // let's update the app/page.tsx file to import the component.\n      if (shouldUpdateAppIndex) {\n        await updateAppIndex(options.components[0], config)\n      }\n    } catch (error) {\n      logger.break()\n      handleError(error)\n    }\n  })\n\nasync function promptForRegistryComponents(\n  options: z.infer<typeof addOptionsSchema>\n) {\n  const registryIndex = await getRegistryIndex()\n  if (!registryIndex) {\n    logger.break()\n    handleError(new Error(\"Failed to fetch registry index.\"))\n    return []\n  }\n\n  if (options.all) {\n    return registryIndex\n      .map((entry) => entry.name)\n      .filter(\n        (component) => !DEPRECATED_COMPONENTS.some((c) => c.name === component)\n      )\n  }\n\n  if (options.components?.length) {\n    return options.components\n  }\n\n  const { components } = await prompts({\n    type: \"multiselect\",\n    name: \"components\",\n    message: \"Which components would you like to add?\",\n    hint: \"Space to select. A to toggle all. Enter to submit.\",\n    instructions: false,\n    choices: registryIndex\n      .filter(\n        (entry) =>\n          entry.type === \"registry:ui\" &&\n          !DEPRECATED_COMPONENTS.some(\n            (component) => component.name === entry.name\n          )\n      )\n      .map((entry) => ({\n        title: entry.name,\n        value: entry.name,\n        selected: options.all ? true : options.components?.includes(entry.name),\n      })),\n  })\n\n  if (!components?.length) {\n    logger.warn(\"No components selected. Exiting.\")\n    logger.info(\"\")\n    process.exit(1)\n  }\n\n  const result = z.array(z.string()).safeParse(components)\n  if (!result.success) {\n    logger.error(\"\")\n    handleError(new Error(\"Something went wrong. Please try again.\"))\n    return []\n  }\n  return result.data\n}\n","import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport { preFlightInit } from \"@/src/preflights/preflight-init\"\nimport {\n  BASE_COLORS,\n  getRegistryBaseColors,\n  getRegistryItem,\n  getRegistryStyles,\n} from \"@/src/registry/api\"\nimport { isLocalFile, isUrl } from \"@/src/registry/utils\"\nimport { addComponents } from \"@/src/utils/add-components\"\nimport { TEMPLATES, createProject } from \"@/src/utils/create-project\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport {\n  DEFAULT_COMPONENTS,\n  DEFAULT_TAILWIND_CONFIG,\n  DEFAULT_TAILWIND_CSS,\n  DEFAULT_UTILS,\n  getConfig,\n  rawConfigSchema,\n  resolveConfigPaths,\n  type Config,\n} from \"@/src/utils/get-config\"\nimport {\n  getProjectConfig,\n  getProjectInfo,\n  getProjectTailwindVersionFromConfig,\n} from \"@/src/utils/get-project-info\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { updateTailwindContent } from \"@/src/utils/updaters/update-tailwind-content\"\nimport { Command } from \"commander\"\nimport prompts from \"prompts\"\nimport { z } from \"zod\"\n\nexport const initOptionsSchema = z.object({\n  cwd: z.string(),\n  components: z.array(z.string()).optional(),\n  yes: z.boolean(),\n  defaults: z.boolean(),\n  force: z.boolean(),\n  silent: z.boolean(),\n  isNewProject: z.boolean(),\n  srcDir: z.boolean().optional(),\n  cssVariables: z.boolean(),\n  template: z\n    .string()\n    .optional()\n    .refine(\n      (val) => {\n        if (val) {\n          return TEMPLATES[val as keyof typeof TEMPLATES]\n        }\n        return true\n      },\n      {\n        message: \"Invalid template. Please use 'next' or 'next-monorepo'.\",\n      }\n    ),\n  baseColor: z\n    .string()\n    .optional()\n    .refine(\n      (val) => {\n        if (val) {\n          return BASE_COLORS.find((color) => color.name === val)\n        }\n\n        return true\n      },\n      {\n        message: `Invalid base color. Please use '${BASE_COLORS.map(\n          (color) => color.name\n        ).join(\"', '\")}'`,\n      }\n    ),\n  style: z.string(),\n})\n\nexport const init = new Command()\n  .name(\"init\")\n  .description(\"initialize your project and install dependencies\")\n  .argument(\"[components...]\", \"names, url or local path to component\")\n  .option(\n    \"-t, --template <template>\",\n    \"the template to use. (next, next-monorepo)\"\n  )\n  .option(\n    \"-b, --base-color <base-color>\",\n    \"the base color to use. (neutral, gray, zinc, stone, slate)\",\n    undefined\n  )\n  .option(\"-y, --yes\", \"skip confirmation prompt.\", true)\n  .option(\"-d, --defaults,\", \"use default configuration.\", false)\n  .option(\"-f, --force\", \"force overwrite of existing configuration.\", false)\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .option(\"-s, --silent\", \"mute output.\", false)\n  .option(\n    \"--src-dir\",\n    \"use the src directory when creating a new project.\",\n    false\n  )\n  .option(\n    \"--no-src-dir\",\n    \"do not use the src directory when creating a new project.\"\n  )\n  .option(\"--css-variables\", \"use css variables for theming.\", true)\n  .option(\"--no-css-variables\", \"do not use css variables for theming.\")\n  .action(async (components, opts) => {\n    try {\n      const options = initOptionsSchema.parse({\n        cwd: path.resolve(opts.cwd),\n        isNewProject: false,\n        components,\n        style: \"index\",\n        ...opts,\n      })\n\n      // We need to check if we're initializing with a new style.\n      // We fetch the payload of the first item.\n      // This is okay since the request is cached and deduped.\n      if (\n        components.length > 0 &&\n        (isUrl(components[0]) || isLocalFile(components[0]))\n      ) {\n        const item = await getRegistryItem(components[0], \"\")\n\n        // Skip base color if style.\n        // We set a default and let the style override it.\n        if (item?.type === \"registry:style\") {\n          options.baseColor = \"neutral\"\n          options.style = item.extends ?? \"index\"\n        }\n      }\n\n      await runInit(options)\n\n      logger.log(\n        `${highlighter.success(\n          \"Success!\"\n        )} Project initialization completed.\\nYou may now add components.`\n      )\n      logger.break()\n    } catch (error) {\n      logger.break()\n      handleError(error)\n    }\n  })\n\nexport async function runInit(\n  options: z.infer<typeof initOptionsSchema> & {\n    skipPreflight?: boolean\n  }\n) {\n  let projectInfo\n  let newProjectTemplate\n  if (!options.skipPreflight) {\n    const preflight = await preFlightInit(options)\n    if (preflight.errors[ERRORS.MISSING_DIR_OR_EMPTY_PROJECT]) {\n      const { projectPath, template } = await createProject(options)\n      if (!projectPath) {\n        process.exit(1)\n      }\n      options.cwd = projectPath\n      options.isNewProject = true\n      newProjectTemplate = template\n    }\n    projectInfo = preflight.projectInfo\n  } else {\n    projectInfo = await getProjectInfo(options.cwd)\n  }\n\n  if (newProjectTemplate === \"next-monorepo\") {\n    options.cwd = path.resolve(options.cwd, \"apps/web\")\n    return await getConfig(options.cwd)\n  }\n\n  const projectConfig = await getProjectConfig(options.cwd, projectInfo)\n  const config = projectConfig\n    ? await promptForMinimalConfig(projectConfig, options)\n    : await promptForConfig(await getConfig(options.cwd))\n\n  if (!options.yes) {\n    const { proceed } = await prompts({\n      type: \"confirm\",\n      name: \"proceed\",\n      message: `Write configuration to ${highlighter.info(\n        \"components.json\"\n      )}. Proceed?`,\n      initial: true,\n    })\n\n    if (!proceed) {\n      process.exit(0)\n    }\n  }\n\n  // Write components.json.\n  const componentSpinner = spinner(`Writing components.json.`).start()\n  const targetPath = path.resolve(options.cwd, \"components.json\")\n  await fs.writeFile(targetPath, JSON.stringify(config, null, 2), \"utf8\")\n  componentSpinner.succeed()\n\n  // Add components.\n  const fullConfig = await resolveConfigPaths(options.cwd, config)\n  const components = [\n    ...(options.style === \"none\" ? [] : [options.style]),\n    ...(options.components ?? []),\n  ]\n  await addComponents(components, fullConfig, {\n    // Init will always overwrite files.\n    overwrite: true,\n    silent: options.silent,\n    style: options.style,\n    isNewProject:\n      options.isNewProject || projectInfo?.framework.name === \"next-app\",\n  })\n\n  // If a new project is using src dir, let's update the tailwind content config.\n  // TODO: Handle this per framework.\n  if (options.isNewProject && options.srcDir) {\n    await updateTailwindContent(\n      [\"./src/**/*.{js,ts,jsx,tsx,mdx}\"],\n      fullConfig,\n      {\n        silent: options.silent,\n      }\n    )\n  }\n\n  return fullConfig\n}\n\nasync function promptForConfig(defaultConfig: Config | null = null) {\n  const [styles, baseColors] = await Promise.all([\n    getRegistryStyles(),\n    getRegistryBaseColors(),\n  ])\n\n  logger.info(\"\")\n  const options = await prompts([\n    {\n      type: \"toggle\",\n      name: \"typescript\",\n      message: `Would you like to use ${highlighter.info(\n        \"TypeScript\"\n      )} (recommended)?`,\n      initial: defaultConfig?.tsx ?? true,\n      active: \"yes\",\n      inactive: \"no\",\n    },\n    {\n      type: \"select\",\n      name: \"style\",\n      message: `Which ${highlighter.info(\"style\")} would you like to use?`,\n      choices: styles.map((style) => ({\n        title: style.label,\n        value: style.name,\n      })),\n    },\n    {\n      type: \"select\",\n      name: \"tailwindBaseColor\",\n      message: `Which color would you like to use as the ${highlighter.info(\n        \"base color\"\n      )}?`,\n      choices: baseColors.map((color) => ({\n        title: color.label,\n        value: color.name,\n      })),\n    },\n    {\n      type: \"text\",\n      name: \"tailwindCss\",\n      message: `Where is your ${highlighter.info(\"global CSS\")} file?`,\n      initial: defaultConfig?.tailwind.css ?? DEFAULT_TAILWIND_CSS,\n    },\n    {\n      type: \"toggle\",\n      name: \"tailwindCssVariables\",\n      message: `Would you like to use ${highlighter.info(\n        \"CSS variables\"\n      )} for theming?`,\n      initial: defaultConfig?.tailwind.cssVariables ?? true,\n      active: \"yes\",\n      inactive: \"no\",\n    },\n    {\n      type: \"text\",\n      name: \"tailwindPrefix\",\n      message: `Are you using a custom ${highlighter.info(\n        \"tailwind prefix eg. tw-\"\n      )}? (Leave blank if not)`,\n      initial: \"\",\n    },\n    {\n      type: \"text\",\n      name: \"tailwindConfig\",\n      message: `Where is your ${highlighter.info(\n        \"tailwind.config.js\"\n      )} located?`,\n      initial: defaultConfig?.tailwind.config ?? DEFAULT_TAILWIND_CONFIG,\n    },\n    {\n      type: \"text\",\n      name: \"components\",\n      message: `Configure the import alias for ${highlighter.info(\n        \"components\"\n      )}:`,\n      initial: defaultConfig?.aliases[\"components\"] ?? DEFAULT_COMPONENTS,\n    },\n    {\n      type: \"text\",\n      name: \"utils\",\n      message: `Configure the import alias for ${highlighter.info(\"utils\")}:`,\n      initial: defaultConfig?.aliases[\"utils\"] ?? DEFAULT_UTILS,\n    },\n    {\n      type: \"toggle\",\n      name: \"rsc\",\n      message: `Are you using ${highlighter.info(\"React Server Components\")}?`,\n      initial: defaultConfig?.rsc ?? true,\n      active: \"yes\",\n      inactive: \"no\",\n    },\n  ])\n\n  return rawConfigSchema.parse({\n    $schema: \"https://ui.shadcn.com/schema.json\",\n    style: options.style,\n    tailwind: {\n      config: options.tailwindConfig,\n      css: options.tailwindCss,\n      baseColor: options.tailwindBaseColor,\n      cssVariables: options.tailwindCssVariables,\n      prefix: options.tailwindPrefix,\n    },\n    rsc: options.rsc,\n    tsx: options.typescript,\n    aliases: {\n      utils: options.utils,\n      components: options.components,\n      // TODO: fix this.\n      lib: options.components.replace(/\\/components$/, \"lib\"),\n      hooks: options.components.replace(/\\/components$/, \"hooks\"),\n    },\n  })\n}\n\nasync function promptForMinimalConfig(\n  defaultConfig: Config,\n  opts: z.infer<typeof initOptionsSchema>\n) {\n  let style = defaultConfig.style\n  let baseColor = opts.baseColor\n  let cssVariables = defaultConfig.tailwind.cssVariables\n\n  if (!opts.defaults) {\n    const [styles, baseColors, tailwindVersion] = await Promise.all([\n      getRegistryStyles(),\n      getRegistryBaseColors(),\n      getProjectTailwindVersionFromConfig(defaultConfig),\n    ])\n\n    const options = await prompts([\n      {\n        type: tailwindVersion === \"v4\" ? null : \"select\",\n        name: \"style\",\n        message: `Which ${highlighter.info(\"style\")} would you like to use?`,\n        choices: styles.map((style) => ({\n          title:\n            style.name === \"new-york\" ? \"New York (Recommended)\" : style.label,\n          value: style.name,\n        })),\n        initial: 0,\n      },\n      {\n        type: opts.baseColor ? null : \"select\",\n        name: \"tailwindBaseColor\",\n        message: `Which color would you like to use as the ${highlighter.info(\n          \"base color\"\n        )}?`,\n        choices: baseColors.map((color) => ({\n          title: color.label,\n          value: color.name,\n        })),\n      },\n    ])\n\n    style = options.style ?? \"new-york\"\n    baseColor = options.tailwindBaseColor ?? baseColor\n    cssVariables = opts.cssVariables\n  }\n\n  return rawConfigSchema.parse({\n    $schema: defaultConfig?.$schema,\n    style,\n    tailwind: {\n      ...defaultConfig?.tailwind,\n      baseColor,\n      cssVariables,\n    },\n    rsc: defaultConfig?.rsc,\n    tsx: defaultConfig?.tsx,\n    aliases: defaultConfig?.aliases,\n    iconLibrary: defaultConfig?.iconLibrary,\n  })\n}\n","import path from \"path\"\nimport { initOptionsSchema } from \"@/src/commands/init\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { getProjectInfo } from \"@/src/utils/get-project-info\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport fs from \"fs-extra\"\nimport { z } from \"zod\"\n\nexport async function preFlightInit(\n  options: z.infer<typeof initOptionsSchema>\n) {\n  const errors: Record<string, boolean> = {}\n\n  // Ensure target directory exists.\n  // Check for empty project. We assume if no package.json exists, the project is empty.\n  if (\n    !fs.existsSync(options.cwd) ||\n    !fs.existsSync(path.resolve(options.cwd, \"package.json\"))\n  ) {\n    errors[ERRORS.MISSING_DIR_OR_EMPTY_PROJECT] = true\n    return {\n      errors,\n      projectInfo: null,\n    }\n  }\n\n  const projectSpinner = spinner(`Preflight checks.`, {\n    silent: options.silent,\n  }).start()\n\n  if (\n    fs.existsSync(path.resolve(options.cwd, \"components.json\")) &&\n    !options.force\n  ) {\n    projectSpinner?.fail()\n    logger.break()\n    logger.error(\n      `A ${highlighter.info(\n        \"components.json\"\n      )} file already exists at ${highlighter.info(\n        options.cwd\n      )}.\\nTo start over, remove the ${highlighter.info(\n        \"components.json\"\n      )} file and run ${highlighter.info(\"init\")} again.`\n    )\n    logger.break()\n    process.exit(1)\n  }\n\n  projectSpinner?.succeed()\n\n  const frameworkSpinner = spinner(`Verifying framework.`, {\n    silent: options.silent,\n  }).start()\n  const projectInfo = await getProjectInfo(options.cwd)\n  if (!projectInfo || projectInfo?.framework.name === \"manual\") {\n    errors[ERRORS.UNSUPPORTED_FRAMEWORK] = true\n    frameworkSpinner?.fail()\n    logger.break()\n    if (projectInfo?.framework.links.installation) {\n      logger.error(\n        `We could not detect a supported framework at ${highlighter.info(\n          options.cwd\n        )}.\\n` +\n          `Visit ${highlighter.info(\n            projectInfo?.framework.links.installation\n          )} to manually configure your project.\\nOnce configured, you can use the cli to add components.`\n      )\n    }\n    logger.break()\n    process.exit(1)\n  }\n  frameworkSpinner?.succeed(\n    `Verifying framework. Found ${highlighter.info(\n      projectInfo.framework.label\n    )}.`\n  )\n\n  let tailwindSpinnerMessage = \"Validating Tailwind CSS.\"\n\n  if (projectInfo.tailwindVersion === \"v4\") {\n    tailwindSpinnerMessage = `Validating Tailwind CSS config. Found ${highlighter.info(\n      \"v4\"\n    )}.`\n  }\n\n  const tailwindSpinner = spinner(tailwindSpinnerMessage, {\n    silent: options.silent,\n  }).start()\n  if (\n    projectInfo.tailwindVersion === \"v3\" &&\n    (!projectInfo?.tailwindConfigFile || !projectInfo?.tailwindCssFile)\n  ) {\n    errors[ERRORS.TAILWIND_NOT_CONFIGURED] = true\n    tailwindSpinner?.fail()\n  } else if (\n    projectInfo.tailwindVersion === \"v4\" &&\n    !projectInfo?.tailwindCssFile\n  ) {\n    errors[ERRORS.TAILWIND_NOT_CONFIGURED] = true\n    tailwindSpinner?.fail()\n  } else if (!projectInfo.tailwindVersion) {\n    errors[ERRORS.TAILWIND_NOT_CONFIGURED] = true\n    tailwindSpinner?.fail()\n  } else {\n    tailwindSpinner?.succeed()\n  }\n\n  const tsConfigSpinner = spinner(`Validating import alias.`, {\n    silent: options.silent,\n  }).start()\n  if (!projectInfo?.aliasPrefix) {\n    errors[ERRORS.IMPORT_ALIAS_MISSING] = true\n    tsConfigSpinner?.fail()\n  } else {\n    tsConfigSpinner?.succeed()\n  }\n\n  if (Object.keys(errors).length > 0) {\n    if (errors[ERRORS.TAILWIND_NOT_CONFIGURED]) {\n      logger.break()\n      logger.error(\n        `No Tailwind CSS configuration found at ${highlighter.info(\n          options.cwd\n        )}.`\n      )\n      logger.error(\n        `It is likely you do not have Tailwind CSS installed or have an invalid configuration.`\n      )\n      logger.error(`Install Tailwind CSS then try again.`)\n      if (projectInfo?.framework.links.tailwind) {\n        logger.error(\n          `Visit ${highlighter.info(\n            projectInfo?.framework.links.tailwind\n          )} to get started.`\n        )\n      }\n    }\n\n    if (errors[ERRORS.IMPORT_ALIAS_MISSING]) {\n      logger.break()\n      logger.error(`No import alias found in your tsconfig.json file.`)\n      if (projectInfo?.framework.links.installation) {\n        logger.error(\n          `Visit ${highlighter.info(\n            projectInfo?.framework.links.installation\n          )} to learn how to set an import alias.`\n        )\n      }\n    }\n\n    logger.break()\n    process.exit(1)\n  }\n\n  return {\n    errors,\n    projectInfo,\n  }\n}\n","export const MISSING_DIR_OR_EMPTY_PROJECT = \"1\"\nexport const EXISTING_CONFIG = \"2\"\nexport const MISSING_CONFIG = \"3\"\nexport const FAILED_CONFIG_READ = \"4\"\nexport const TAILWIND_NOT_CONFIGURED = \"5\"\nexport const IMPORT_ALIAS_MISSING = \"6\"\nexport const UNSUPPORTED_FRAMEWORK = \"7\"\nexport const COMPONENT_URL_NOT_FOUND = \"8\"\nexport const COMPONENT_URL_UNAUTHORIZED = \"9\"\nexport const COMPONENT_URL_FORBIDDEN = \"10\"\nexport const COMPONENT_URL_BAD_REQUEST = \"11\"\nexport const COMPONENT_URL_INTERNAL_SERVER_ERROR = \"12\"\nexport const BUILD_MISSING_REGISTRY_FILE = \"13\"\n","import path from \"path\"\nimport {\n  fetchRegistry,\n  getRegistryItem,\n  getRegistryParentMap,\n  getRegistryTypeAliasMap,\n  registryResolveItemsTree,\n  resolveRegistryItems,\n} from \"@/src/registry/api\"\nimport {\n  registryItemFileSchema,\n  registryItemSchema,\n} from \"@/src/registry/schema\"\nimport {\n  configSchema,\n  findCommonRoot,\n  findPackageRoot,\n  getWorkspaceConfig,\n  workspaceConfigSchema,\n  type Config,\n} from \"@/src/utils/get-config\"\nimport { getProjectTailwindVersionFromConfig } from \"@/src/utils/get-project-info\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { isSafeTarget } from \"@/src/utils/is-safe-target\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { updateCss } from \"@/src/utils/updaters/update-css\"\nimport { updateCssVars } from \"@/src/utils/updaters/update-css-vars\"\nimport { updateDependencies } from \"@/src/utils/updaters/update-dependencies\"\nimport { updateEnvVars } from \"@/src/utils/updaters/update-env-vars\"\nimport { updateFiles } from \"@/src/utils/updaters/update-files\"\nimport { updateTailwindConfig } from \"@/src/utils/updaters/update-tailwind-config\"\nimport { z } from \"zod\"\n\nexport async function addComponents(\n  components: string[],\n  config: Config,\n  options: {\n    overwrite?: boolean\n    silent?: boolean\n    isNewProject?: boolean\n    style?: string\n  }\n) {\n  options = {\n    overwrite: false,\n    silent: false,\n    isNewProject: false,\n    style: \"index\",\n    ...options,\n  }\n\n  const workspaceConfig = await getWorkspaceConfig(config)\n  if (\n    workspaceConfig &&\n    workspaceConfig.ui &&\n    workspaceConfig.ui.resolvedPaths.cwd !== config.resolvedPaths.cwd\n  ) {\n    return await addWorkspaceComponents(components, config, workspaceConfig, {\n      ...options,\n      isRemote:\n        components?.length === 1 && !!components[0].match(/\\/chat\\/b\\//),\n    })\n  }\n\n  return await addProjectComponents(components, config, options)\n}\n\nasync function addProjectComponents(\n  components: string[],\n  config: z.infer<typeof configSchema>,\n  options: {\n    overwrite?: boolean\n    silent?: boolean\n    isNewProject?: boolean\n    style?: string\n  }\n) {\n  const registrySpinner = spinner(`Checking registry.`, {\n    silent: options.silent,\n  })?.start()\n  const tree = await registryResolveItemsTree(components, config)\n\n  if (!tree) {\n    registrySpinner?.fail()\n    return handleError(new Error(\"Failed to fetch components from registry.\"))\n  }\n\n  try {\n    validateFilesTarget(tree.files ?? [], config.resolvedPaths.cwd)\n  } catch (error) {\n    registrySpinner?.fail()\n    return handleError(error)\n  }\n\n  registrySpinner?.succeed()\n\n  const tailwindVersion = await getProjectTailwindVersionFromConfig(config)\n\n  await updateTailwindConfig(tree.tailwind?.config, config, {\n    silent: options.silent,\n    tailwindVersion,\n  })\n\n  const overwriteCssVars = await shouldOverwriteCssVars(components, config)\n  await updateCssVars(tree.cssVars, config, {\n    cleanupDefaultNextStyles: options.isNewProject,\n    silent: options.silent,\n    tailwindVersion,\n    tailwindConfig: tree.tailwind?.config,\n    overwriteCssVars,\n    initIndex: options.style ? options.style === \"index\" : false,\n  })\n\n  // Add CSS updater\n  await updateCss(tree.css, config, {\n    silent: options.silent,\n  })\n\n  await updateEnvVars(tree.envVars, config, {\n    silent: options.silent,\n  })\n\n  await updateDependencies(tree.dependencies, tree.devDependencies, config, {\n    silent: options.silent,\n  })\n  await updateFiles(tree.files, config, {\n    overwrite: options.overwrite,\n    silent: options.silent,\n  })\n\n  if (tree.docs) {\n    logger.info(tree.docs)\n  }\n}\n\nasync function addWorkspaceComponents(\n  components: string[],\n  config: z.infer<typeof configSchema>,\n  workspaceConfig: z.infer<typeof workspaceConfigSchema>,\n  options: {\n    overwrite?: boolean\n    silent?: boolean\n    isNewProject?: boolean\n    isRemote?: boolean\n    style?: string\n  }\n) {\n  const registrySpinner = spinner(`Checking registry.`, {\n    silent: options.silent,\n  })?.start()\n  let registryItems = await resolveRegistryItems(components, config)\n  let result = await fetchRegistry(registryItems)\n  const payload = z.array(registryItemSchema).parse(result)\n  if (!payload) {\n    registrySpinner?.fail()\n    return handleError(new Error(\"Failed to fetch components from registry.\"))\n  }\n  registrySpinner?.succeed()\n\n  const registryParentMap = getRegistryParentMap(payload)\n  const registryTypeAliasMap = getRegistryTypeAliasMap()\n\n  const filesCreated: string[] = []\n  const filesUpdated: string[] = []\n  const filesSkipped: string[] = []\n\n  const files = payload.flatMap((item) => item.files ?? [])\n  try {\n    validateFilesTarget(files, config.resolvedPaths.cwd)\n  } catch (error) {\n    return handleError(error)\n  }\n\n  const rootSpinner = spinner(`Installing components.`)?.start()\n\n  for (const component of payload) {\n    const alias = registryTypeAliasMap.get(component.type)\n    const registryParent = registryParentMap.get(component.name)\n\n    // We don't support this type of component.\n    if (!alias) {\n      continue\n    }\n\n    // A good start is ui for now.\n    // TODO: Add support for other types.\n    let targetConfig =\n      component.type === \"registry:ui\" || registryParent?.type === \"registry:ui\"\n        ? workspaceConfig.ui\n        : config\n\n    const tailwindVersion = await getProjectTailwindVersionFromConfig(\n      targetConfig\n    )\n\n    const workspaceRoot = findCommonRoot(\n      config.resolvedPaths.cwd,\n      targetConfig.resolvedPaths.ui\n    )\n    const packageRoot =\n      (await findPackageRoot(workspaceRoot, targetConfig.resolvedPaths.cwd)) ??\n      targetConfig.resolvedPaths.cwd\n\n    // 1. Update tailwind config.\n    if (component.tailwind?.config) {\n      await updateTailwindConfig(component.tailwind?.config, targetConfig, {\n        silent: true,\n        tailwindVersion,\n      })\n      filesUpdated.push(\n        path.relative(workspaceRoot, targetConfig.resolvedPaths.tailwindConfig)\n      )\n    }\n\n    // 2. Update css vars.\n    if (component.cssVars) {\n      const overwriteCssVars = await shouldOverwriteCssVars(components, config)\n      await updateCssVars(component.cssVars, targetConfig, {\n        silent: true,\n        tailwindVersion,\n        tailwindConfig: component.tailwind?.config,\n        overwriteCssVars,\n      })\n      filesUpdated.push(\n        path.relative(workspaceRoot, targetConfig.resolvedPaths.tailwindCss)\n      )\n    }\n\n    // 3. Update CSS\n    if (component.css) {\n      await updateCss(component.css, targetConfig, {\n        silent: true,\n      })\n      filesUpdated.push(\n        path.relative(workspaceRoot, targetConfig.resolvedPaths.tailwindCss)\n      )\n    }\n\n    // 4. Update environment variables\n    if (component.envVars) {\n      await updateEnvVars(component.envVars, targetConfig, {\n        silent: true,\n      })\n    }\n\n    // 5. Update dependencies.\n    await updateDependencies(\n      component.dependencies,\n      component.devDependencies,\n      targetConfig,\n      {\n        silent: true,\n      }\n    )\n\n    // 6. Update files.\n    const files = await updateFiles(component.files, targetConfig, {\n      overwrite: options.overwrite,\n      silent: true,\n      rootSpinner,\n      isRemote: options.isRemote,\n    })\n\n    filesCreated.push(\n      ...files.filesCreated.map((file) =>\n        path.relative(workspaceRoot, path.join(packageRoot, file))\n      )\n    )\n    filesUpdated.push(\n      ...files.filesUpdated.map((file) =>\n        path.relative(workspaceRoot, path.join(packageRoot, file))\n      )\n    )\n    filesSkipped.push(\n      ...files.filesSkipped.map((file) =>\n        path.relative(workspaceRoot, path.join(packageRoot, file))\n      )\n    )\n  }\n\n  rootSpinner?.succeed()\n\n  // Sort files.\n  filesCreated.sort()\n  filesUpdated.sort()\n  filesSkipped.sort()\n\n  const hasUpdatedFiles = filesCreated.length || filesUpdated.length\n  if (!hasUpdatedFiles && !filesSkipped.length) {\n    spinner(`No files updated.`, {\n      silent: options.silent,\n    })?.info()\n  }\n\n  if (filesCreated.length) {\n    spinner(\n      `Created ${filesCreated.length} ${\n        filesCreated.length === 1 ? \"file\" : \"files\"\n      }:`,\n      {\n        silent: options.silent,\n      }\n    )?.succeed()\n    for (const file of filesCreated) {\n      logger.log(`  - ${file}`)\n    }\n  }\n\n  if (filesUpdated.length) {\n    spinner(\n      `Updated ${filesUpdated.length} ${\n        filesUpdated.length === 1 ? \"file\" : \"files\"\n      }:`,\n      {\n        silent: options.silent,\n      }\n    )?.info()\n    for (const file of filesUpdated) {\n      logger.log(`  - ${file}`)\n    }\n  }\n\n  if (filesSkipped.length) {\n    spinner(\n      `Skipped ${filesSkipped.length} ${\n        filesUpdated.length === 1 ? \"file\" : \"files\"\n      }: (use --overwrite to overwrite)`,\n      {\n        silent: options.silent,\n      }\n    )?.info()\n    for (const file of filesSkipped) {\n      logger.log(`  - ${file}`)\n    }\n  }\n}\n\nasync function shouldOverwriteCssVars(\n  components: z.infer<typeof registryItemSchema>[\"name\"][],\n  config: z.infer<typeof configSchema>\n) {\n  let result = await Promise.all(\n    components.map((component) => getRegistryItem(component, config.style))\n  )\n  const payload = z.array(registryItemSchema).parse(result)\n\n  return payload.some(\n    (component) =>\n      component.type === \"registry:theme\" || component.type === \"registry:style\"\n  )\n}\n\nfunction validateFilesTarget(\n  files: z.infer<typeof registryItemFileSchema>[],\n  cwd: string\n) {\n  for (const file of files) {\n    if (!file?.target) {\n      continue\n    }\n\n    if (!isSafeTarget(file.target, cwd)) {\n      throw new Error(\n        `We found an unsafe file path \"${file.target} in the registry item. Installation aborted.`\n      )\n    }\n  }\n}\n","import path from \"path\"\n\nexport function isSafeTarget(targetPath: string, cwd: string): boolean {\n  // Check for null bytes which can be used to bypass validations.\n  if (targetPath.includes(\"\\0\")) {\n    return false\n  }\n\n  // Decode URL-encoded sequences to catch encoded traversal attempts.\n  let decodedPath: string\n  try {\n    // Decode multiple times to catch double-encoded sequences.\n    decodedPath = targetPath\n    let prevPath = \"\"\n    while (decodedPath !== prevPath && decodedPath.includes(\"%\")) {\n      prevPath = decodedPath\n      decodedPath = decodeURIComponent(decodedPath)\n    }\n  } catch {\n    // If decoding fails, treat as unsafe.\n    return false\n  }\n\n  // Normalize both paths to handle different path separators.\n  // Convert Windows backslashes to forward slashes for consistent handling.\n  const normalizedTarget = path.normalize(decodedPath.replace(/\\\\/g, \"/\"))\n  const normalizedRoot = path.normalize(cwd)\n\n  // Check for explicit path traversal sequences in both encoded and decoded forms.\n  // Allow [...] pattern which is common in framework routing (e.g., [...slug])\n  const hasPathTraversal = (path: string) => {\n    // Remove [...] patterns before checking for ..\n    const withoutBrackets = path.replace(/\\[\\.\\.\\..*?\\]/g, \"\")\n    return withoutBrackets.includes(\"..\")\n  }\n\n  if (\n    hasPathTraversal(normalizedTarget) ||\n    hasPathTraversal(decodedPath) ||\n    hasPathTraversal(targetPath)\n  ) {\n    return false\n  }\n\n  // Check for current directory references that might be used in traversal.\n  // First, remove [...] patterns to avoid false positives\n  const cleanPath = (path: string) => path.replace(/\\[\\.\\.\\..*?\\]/g, \"\")\n  const cleanTarget = cleanPath(targetPath)\n  const cleanDecoded = cleanPath(decodedPath)\n\n  const suspiciousPatterns = [\n    /\\.\\.[\\/\\\\]/, // ../ or ..\\\n    /[\\/\\\\]\\.\\./, // /.. or \\..\n    /\\.\\./, // .. anywhere\n    /\\.\\.%/, // URL encoded traversal\n    /\\x00/, // null byte\n    /[\\x01-\\x1f]/, // control characters\n  ]\n\n  if (\n    suspiciousPatterns.some(\n      (pattern) => pattern.test(cleanTarget) || pattern.test(cleanDecoded)\n    )\n  ) {\n    return false\n  }\n\n  // Allow ~/ at the start (home directory expansion within project) but reject ~/../ patterns.\n  if (\n    (targetPath.includes(\"~\") || decodedPath.includes(\"~\")) &&\n    (targetPath.includes(\"../\") || decodedPath.includes(\"../\"))\n  ) {\n    return false\n  }\n\n  // Check for Windows drive letters (even on non-Windows systems for safety).\n  const driveLetterRegex = /^[a-zA-Z]:[\\/\\\\]/\n  if (driveLetterRegex.test(decodedPath)) {\n    // On Windows, check if it starts with the project root.\n    if (process.platform === \"win32\") {\n      return decodedPath.toLowerCase().startsWith(cwd.toLowerCase())\n    }\n    // On non-Windows systems, reject all Windows absolute paths.\n    return false\n  }\n\n  // If it's an absolute path, ensure it's within the project root.\n  if (path.isAbsolute(normalizedTarget)) {\n    return normalizedTarget.startsWith(normalizedRoot + path.sep)\n  }\n\n  // For relative paths, resolve and check if within project bounds.\n  const resolvedPath = path.resolve(normalizedRoot, normalizedTarget)\n  return (\n    resolvedPath.startsWith(normalizedRoot + path.sep) ||\n    resolvedPath === normalizedRoot\n  )\n}\n","import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport { registryItemCssSchema } from \"@/src/registry/schema\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport postcss from \"postcss\"\nimport AtRule from \"postcss/lib/at-rule\"\nimport Declaration from \"postcss/lib/declaration\"\nimport Root from \"postcss/lib/root\"\nimport Rule from \"postcss/lib/rule\"\nimport { z } from \"zod\"\n\nexport async function updateCss(\n  css: z.infer<typeof registryItemCssSchema> | undefined,\n  config: Config,\n  options: {\n    silent?: boolean\n  }\n) {\n  if (\n    !config.resolvedPaths.tailwindCss ||\n    !css ||\n    Object.keys(css).length === 0\n  ) {\n    return\n  }\n\n  options = {\n    silent: false,\n    ...options,\n  }\n\n  const cssFilepath = config.resolvedPaths.tailwindCss\n  const cssFilepathRelative = path.relative(\n    config.resolvedPaths.cwd,\n    cssFilepath\n  )\n  const cssSpinner = spinner(\n    `Updating ${highlighter.info(cssFilepathRelative)}`,\n    {\n      silent: options.silent,\n    }\n  ).start()\n\n  const raw = await fs.readFile(cssFilepath, \"utf8\")\n  let output = await transformCss(raw, css)\n  await fs.writeFile(cssFilepath, output, \"utf8\")\n  cssSpinner.succeed()\n}\n\nexport async function transformCss(\n  input: string,\n  css: z.infer<typeof registryItemCssSchema>\n) {\n  const plugins = [updateCssPlugin(css)]\n\n  const result = await postcss(plugins).process(input, {\n    from: undefined,\n  })\n\n  let output = result.css\n  output = output.replace(/\\/\\* ---break--- \\*\\//g, \"\")\n  output = output.replace(/(\\n\\s*\\n)+/g, \"\\n\\n\")\n  output = output.trimEnd()\n\n  return output\n}\n\nfunction updateCssPlugin(css: z.infer<typeof registryItemCssSchema>) {\n  return {\n    postcssPlugin: \"update-css\",\n    Once(root: Root) {\n      for (const [selector, properties] of Object.entries(css)) {\n        if (selector.startsWith(\"@\")) {\n          // Handle at-rules (@layer, @utility, etc.)\n          const atRuleMatch = selector.match(/@([a-zA-Z-]+)\\s*(.*)/)\n          if (!atRuleMatch) continue\n\n          const [, name, params] = atRuleMatch\n\n          // Special handling for plugins - place them after imports\n          if (name === \"plugin\") {\n            // Find existing plugin with same params\n            const existingPlugin = root.nodes?.find(\n              (node): node is AtRule =>\n                node.type === \"atrule\" &&\n                node.name === \"plugin\" &&\n                node.params === params\n            )\n\n            if (!existingPlugin) {\n              const pluginRule = postcss.atRule({\n                name: \"plugin\",\n                params,\n                raws: { semicolon: true, before: \"\\n\" },\n              })\n\n              // Find the last import or plugin node to insert after\n              const importNodes = root.nodes?.filter(\n                (node): node is AtRule =>\n                  node.type === \"atrule\" && node.name === \"import\"\n              )\n\n              const pluginNodes = root.nodes?.filter(\n                (node): node is AtRule =>\n                  node.type === \"atrule\" && node.name === \"plugin\"\n              )\n\n              if (pluginNodes && pluginNodes.length > 0) {\n                // Insert after the last existing plugin\n                const lastPlugin = pluginNodes[pluginNodes.length - 1]\n                root.insertAfter(lastPlugin, pluginRule)\n              } else if (importNodes && importNodes.length > 0) {\n                // Insert after the last import if no plugins exist\n                const lastImport = importNodes[importNodes.length - 1]\n                root.insertAfter(lastImport, pluginRule)\n                // Add a break comment before the first plugin to create spacing\n                root.insertBefore(\n                  pluginRule,\n                  postcss.comment({ text: \"---break---\" })\n                )\n                // Add a break comment after the plugin for spacing from other content\n                root.insertAfter(\n                  pluginRule,\n                  postcss.comment({ text: \"---break---\" })\n                )\n              } else {\n                // If no imports or plugins, insert at the beginning\n                root.prepend(pluginRule)\n                // Add a break comment before the first plugin for spacing\n                root.insertBefore(\n                  pluginRule,\n                  postcss.comment({ text: \"---break---\" })\n                )\n                // Add a break comment after the plugin for spacing from other content\n                root.insertAfter(\n                  pluginRule,\n                  postcss.comment({ text: \"---break---\" })\n                )\n              }\n            }\n          }\n          // Special handling for keyframes - place them under @theme inline\n          else if (name === \"keyframes\") {\n            let themeInline = root.nodes?.find(\n              (node): node is AtRule =>\n                node.type === \"atrule\" &&\n                node.name === \"theme\" &&\n                node.params === \"inline\"\n            ) as AtRule | undefined\n\n            if (!themeInline) {\n              themeInline = postcss.atRule({\n                name: \"theme\",\n                params: \"inline\",\n                raws: { semicolon: true, between: \" \", before: \"\\n\" },\n              })\n              root.append(themeInline)\n              root.insertBefore(\n                themeInline,\n                postcss.comment({ text: \"---break---\" })\n              )\n            }\n\n            const keyframesRule = postcss.atRule({\n              name: \"keyframes\",\n              params,\n              raws: { semicolon: true, between: \" \", before: \"\\n  \" },\n            })\n\n            themeInline.append(keyframesRule)\n\n            if (typeof properties === \"object\") {\n              for (const [step, stepProps] of Object.entries(properties)) {\n                processRule(keyframesRule, step, stepProps)\n              }\n            }\n          }\n          // Special handling for utility classes to preserve property values\n          else if (name === \"utility\") {\n            const utilityAtRule = root.nodes?.find(\n              (node): node is AtRule =>\n                node.type === \"atrule\" &&\n                node.name === name &&\n                node.params === params\n            ) as AtRule | undefined\n\n            if (!utilityAtRule) {\n              const atRule = postcss.atRule({\n                name,\n                params,\n                raws: { semicolon: true, between: \" \", before: \"\\n\" },\n              })\n\n              root.append(atRule)\n              root.insertBefore(\n                atRule,\n                postcss.comment({ text: \"---break---\" })\n              )\n\n              // Add declarations with their values preserved\n              if (typeof properties === \"object\") {\n                for (const [prop, value] of Object.entries(properties)) {\n                  if (typeof value === \"string\") {\n                    const decl = postcss.decl({\n                      prop,\n                      value: value,\n                      raws: { semicolon: true, before: \"\\n    \" },\n                    })\n                    atRule.append(decl)\n                  } else if (typeof value === \"object\") {\n                    processRule(atRule, prop, value)\n                  }\n                }\n              }\n            } else {\n              // Update existing utility class\n              if (typeof properties === \"object\") {\n                for (const [prop, value] of Object.entries(properties)) {\n                  if (typeof value === \"string\") {\n                    const existingDecl = utilityAtRule.nodes?.find(\n                      (node): node is Declaration =>\n                        node.type === \"decl\" && node.prop === prop\n                    )\n\n                    const decl = postcss.decl({\n                      prop,\n                      value: value,\n                      raws: { semicolon: true, before: \"\\n    \" },\n                    })\n\n                    existingDecl\n                      ? existingDecl.replaceWith(decl)\n                      : utilityAtRule.append(decl)\n                  } else if (typeof value === \"object\") {\n                    processRule(utilityAtRule, prop, value)\n                  }\n                }\n              }\n            }\n          } else {\n            // Handle other at-rules normally\n            processAtRule(root, name, params, properties)\n          }\n        } else {\n          // Handle regular CSS rules\n          processRule(root, selector, properties)\n        }\n      }\n    },\n  }\n}\n\nfunction processAtRule(\n  root: Root | AtRule,\n  name: string,\n  params: string,\n  properties: any\n) {\n  // Find or create the at-rule\n  let atRule = root.nodes?.find(\n    (node): node is AtRule =>\n      node.type === \"atrule\" && node.name === name && node.params === params\n  ) as AtRule | undefined\n\n  if (!atRule) {\n    atRule = postcss.atRule({\n      name,\n      params,\n      raws: { semicolon: true, between: \" \", before: \"\\n\" },\n    })\n    root.append(atRule)\n    root.insertBefore(atRule, postcss.comment({ text: \"---break---\" }))\n  }\n\n  // Process children of this at-rule\n  if (typeof properties === \"object\") {\n    for (const [childSelector, childProps] of Object.entries(properties)) {\n      if (childSelector.startsWith(\"@\")) {\n        // Nested at-rule\n        const nestedMatch = childSelector.match(/@([a-zA-Z-]+)\\s*(.*)/)\n        if (nestedMatch) {\n          const [, nestedName, nestedParams] = nestedMatch\n          processAtRule(atRule, nestedName, nestedParams, childProps)\n        }\n      } else {\n        // CSS rule within at-rule\n        processRule(atRule, childSelector, childProps)\n      }\n    }\n  } else if (typeof properties === \"string\") {\n    // Direct string content for the at-rule\n    try {\n      // Parse the CSS string with PostCSS\n      const parsed = postcss.parse(`.temp{${properties}}`)\n      const tempRule = parsed.first as Rule\n\n      if (tempRule && tempRule.nodes) {\n        // Create a rule for the at-rule if needed\n        const rule = postcss.rule({\n          selector: \"temp\",\n          raws: { semicolon: true, between: \" \", before: \"\\n  \" },\n        })\n\n        // Copy all declarations from the temp rule to our actual rule\n        tempRule.nodes.forEach((node) => {\n          if (node.type === \"decl\") {\n            const clone = node.clone()\n            clone.raws.before = \"\\n    \"\n            rule.append(clone)\n          }\n        })\n\n        // Only add the rule if it has declarations\n        if (rule.nodes?.length) {\n          atRule.append(rule)\n        }\n      }\n    } catch (error) {\n      console.error(\"Error parsing at-rule content:\", properties, error)\n      throw error\n    }\n  }\n}\n\nfunction processRule(parent: Root | AtRule, selector: string, properties: any) {\n  let rule = parent.nodes?.find(\n    (node): node is Rule => node.type === \"rule\" && node.selector === selector\n  ) as Rule | undefined\n\n  if (!rule) {\n    rule = postcss.rule({\n      selector,\n      raws: { semicolon: true, between: \" \", before: \"\\n  \" },\n    })\n    parent.append(rule)\n  }\n\n  if (typeof properties === \"object\") {\n    for (const [prop, value] of Object.entries(properties)) {\n      if (typeof value === \"string\") {\n        const decl = postcss.decl({\n          prop,\n          value: value,\n          raws: { semicolon: true, before: \"\\n    \" },\n        })\n\n        // Replace existing property or add new one\n        const existingDecl = rule.nodes?.find(\n          (node): node is Declaration =>\n            node.type === \"decl\" && node.prop === prop\n        )\n\n        existingDecl ? existingDecl.replaceWith(decl) : rule.append(decl)\n      } else if (typeof value === \"object\") {\n        // Nested selector (including & selectors)\n        const nestedSelector = prop.startsWith(\"&\")\n          ? selector.replace(/^([^:]+)/, `$1${prop.substring(1)}`)\n          : prop // Use the original selector for other nested elements\n        processRule(parent, nestedSelector, value)\n      }\n    }\n  } else if (typeof properties === \"string\") {\n    // Direct string content for the rule\n    try {\n      // Parse the CSS string with PostCSS\n      const parsed = postcss.parse(`.temp{${properties}}`)\n      const tempRule = parsed.first as Rule\n\n      if (tempRule && tempRule.nodes) {\n        // Copy all declarations from the temp rule to our actual rule\n        tempRule.nodes.forEach((node) => {\n          if (node.type === \"decl\") {\n            const clone = node.clone()\n            clone.raws.before = \"\\n    \"\n            rule?.append(clone)\n          }\n        })\n      }\n    } catch (error) {\n      console.error(\"Error parsing rule content:\", selector, properties, error)\n      throw error\n    }\n  }\n}\n","import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport {\n  registryItemCssVarsSchema,\n  registryItemTailwindSchema,\n} from \"@/src/registry/schema\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { getPackageInfo } from \"@/src/utils/get-package-info\"\nimport { TailwindVersion } from \"@/src/utils/get-project-info\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport postcss from \"postcss\"\nimport AtRule from \"postcss/lib/at-rule\"\nimport Root from \"postcss/lib/root\"\nimport Rule from \"postcss/lib/rule\"\nimport { z } from \"zod\"\n\nexport async function updateCssVars(\n  cssVars: z.infer<typeof registryItemCssVarsSchema> | undefined,\n  config: Config,\n  options: {\n    cleanupDefaultNextStyles?: boolean\n    overwriteCssVars?: boolean\n    initIndex?: boolean\n    silent?: boolean\n    tailwindVersion?: TailwindVersion\n    tailwindConfig?: z.infer<typeof registryItemTailwindSchema>[\"config\"]\n  }\n) {\n  if (!config.resolvedPaths.tailwindCss || !Object.keys(cssVars ?? {}).length) {\n    return\n  }\n\n  options = {\n    cleanupDefaultNextStyles: false,\n    silent: false,\n    tailwindVersion: \"v3\",\n    overwriteCssVars: false,\n    initIndex: true,\n    ...options,\n  }\n  const cssFilepath = config.resolvedPaths.tailwindCss\n  const cssFilepathRelative = path.relative(\n    config.resolvedPaths.cwd,\n    cssFilepath\n  )\n  const cssVarsSpinner = spinner(\n    `Updating CSS variables in ${highlighter.info(cssFilepathRelative)}`,\n    {\n      silent: options.silent,\n    }\n  ).start()\n  const raw = await fs.readFile(cssFilepath, \"utf8\")\n  let output = await transformCssVars(raw, cssVars ?? {}, config, {\n    cleanupDefaultNextStyles: options.cleanupDefaultNextStyles,\n    tailwindVersion: options.tailwindVersion,\n    tailwindConfig: options.tailwindConfig,\n    overwriteCssVars: options.overwriteCssVars,\n    initIndex: options.initIndex,\n  })\n  await fs.writeFile(cssFilepath, output, \"utf8\")\n  cssVarsSpinner.succeed()\n}\n\nexport async function transformCssVars(\n  input: string,\n  cssVars: z.infer<typeof registryItemCssVarsSchema>,\n  config: Config,\n  options: {\n    cleanupDefaultNextStyles?: boolean\n    tailwindVersion?: TailwindVersion\n    tailwindConfig?: z.infer<typeof registryItemTailwindSchema>[\"config\"]\n    overwriteCssVars?: boolean\n    initIndex?: boolean\n  } = {\n    cleanupDefaultNextStyles: false,\n    tailwindVersion: \"v3\",\n    tailwindConfig: undefined,\n    overwriteCssVars: false,\n    initIndex: true,\n  }\n) {\n  options = {\n    cleanupDefaultNextStyles: false,\n    tailwindVersion: \"v3\",\n    tailwindConfig: undefined,\n    overwriteCssVars: false,\n    initIndex: true,\n    ...options,\n  }\n\n  let plugins = [updateCssVarsPlugin(cssVars)]\n\n  if (options.cleanupDefaultNextStyles) {\n    plugins.push(cleanupDefaultNextStylesPlugin())\n  }\n\n  if (options.tailwindVersion === \"v4\") {\n    plugins = []\n\n    // Only add tw-animate-css if project does not have tailwindcss-animate\n    if (config.resolvedPaths?.cwd) {\n      const packageInfo = getPackageInfo(config.resolvedPaths.cwd)\n      if (\n        !packageInfo?.dependencies?.[\"tailwindcss-animate\"] &&\n        !packageInfo?.devDependencies?.[\"tailwindcss-animate\"] &&\n        options.initIndex\n      ) {\n        plugins.push(addCustomImport({ params: \"tw-animate-css\" }))\n      }\n    }\n\n    plugins.push(addCustomVariant({ params: \"dark (&:is(.dark *))\" }))\n\n    if (options.cleanupDefaultNextStyles) {\n      plugins.push(cleanupDefaultNextStylesPlugin())\n    }\n\n    plugins.push(\n      updateCssVarsPluginV4(cssVars, {\n        overwriteCssVars: options.overwriteCssVars,\n      })\n    )\n    plugins.push(updateThemePlugin(cssVars))\n\n    if (options.tailwindConfig) {\n      plugins.push(updateTailwindConfigPlugin(options.tailwindConfig))\n      plugins.push(updateTailwindConfigAnimationPlugin(options.tailwindConfig))\n      plugins.push(updateTailwindConfigKeyframesPlugin(options.tailwindConfig))\n    }\n  }\n\n  if (config.tailwind.cssVariables && options.initIndex) {\n    plugins.push(\n      updateBaseLayerPlugin({ tailwindVersion: options.tailwindVersion })\n    )\n  }\n\n  const result = await postcss(plugins).process(input, {\n    from: undefined,\n  })\n\n  let output = result.css\n\n  output = output.replace(/\\/\\* ---break--- \\*\\//g, \"\")\n\n  if (options.tailwindVersion === \"v4\") {\n    output = output.replace(/(\\n\\s*\\n)+/g, \"\\n\\n\")\n  }\n\n  return output\n}\n\nfunction updateBaseLayerPlugin({\n  tailwindVersion,\n}: {\n  tailwindVersion?: TailwindVersion\n}) {\n  return {\n    postcssPlugin: \"update-base-layer\",\n    Once(root: Root) {\n      const requiredRules = [\n        {\n          selector: \"*\",\n          apply:\n            tailwindVersion === \"v4\"\n              ? \"border-border outline-ring/50\"\n              : \"border-border\",\n        },\n        { selector: \"body\", apply: \"bg-background text-foreground\" },\n      ]\n\n      let baseLayer = root.nodes.find(\n        (node): node is AtRule =>\n          node.type === \"atrule\" &&\n          node.name === \"layer\" &&\n          node.params === \"base\" &&\n          requiredRules.every(({ selector, apply }) =>\n            node.nodes?.some(\n              (rule): rule is Rule =>\n                rule.type === \"rule\" &&\n                rule.selector === selector &&\n                rule.nodes.some(\n                  (applyRule): applyRule is AtRule =>\n                    applyRule.type === \"atrule\" &&\n                    applyRule.name === \"apply\" &&\n                    applyRule.params === apply\n                )\n            )\n          )\n      ) as AtRule | undefined\n\n      if (!baseLayer) {\n        baseLayer = postcss.atRule({\n          name: \"layer\",\n          params: \"base\",\n          raws: { semicolon: true, between: \" \", before: \"\\n\" },\n        })\n        root.append(baseLayer)\n        root.insertBefore(baseLayer, postcss.comment({ text: \"---break---\" }))\n      }\n\n      requiredRules.forEach(({ selector, apply }) => {\n        const existingRule = baseLayer?.nodes?.find(\n          (node): node is Rule =>\n            node.type === \"rule\" && node.selector === selector\n        )\n\n        if (!existingRule) {\n          baseLayer?.append(\n            postcss.rule({\n              selector,\n              nodes: [\n                postcss.atRule({\n                  name: \"apply\",\n                  params: apply,\n                  raws: { semicolon: true, before: \"\\n    \" },\n                }),\n              ],\n              raws: { semicolon: true, between: \" \", before: \"\\n  \" },\n            })\n          )\n        }\n      })\n    },\n  }\n}\n\nfunction updateCssVarsPlugin(\n  cssVars: z.infer<typeof registryItemCssVarsSchema>\n) {\n  return {\n    postcssPlugin: \"update-css-vars\",\n    Once(root: Root) {\n      let baseLayer = root.nodes.find(\n        (node) =>\n          node.type === \"atrule\" &&\n          node.name === \"layer\" &&\n          node.params === \"base\"\n      ) as AtRule | undefined\n\n      if (!(baseLayer instanceof AtRule)) {\n        baseLayer = postcss.atRule({\n          name: \"layer\",\n          params: \"base\",\n          nodes: [],\n          raws: {\n            semicolon: true,\n            before: \"\\n\",\n            between: \" \",\n          },\n        })\n        root.append(baseLayer)\n        root.insertBefore(baseLayer, postcss.comment({ text: \"---break---\" }))\n      }\n\n      if (baseLayer !== undefined) {\n        // Add variables for each key in cssVars\n        Object.entries(cssVars).forEach(([key, vars]) => {\n          const selector = key === \"light\" ? \":root\" : `.${key}`\n          // TODO: Fix typecheck.\n          addOrUpdateVars(baseLayer as AtRule, selector, vars)\n        })\n      }\n    },\n  }\n}\n\nfunction removeConflictVars(root: Rule | Root) {\n  const rootRule = root.nodes.find(\n    (node): node is Rule => node.type === \"rule\" && node.selector === \":root\"\n  )\n\n  if (rootRule) {\n    const propsToRemove = [\"--background\", \"--foreground\"]\n\n    rootRule.nodes\n      .filter(\n        (node): node is postcss.Declaration =>\n          node.type === \"decl\" && propsToRemove.includes(node.prop)\n      )\n      .forEach((node) => node.remove())\n\n    if (rootRule.nodes.length === 0) {\n      rootRule.remove()\n    }\n  }\n}\n\nfunction cleanupDefaultNextStylesPlugin() {\n  return {\n    postcssPlugin: \"cleanup-default-next-styles\",\n    Once(root: Root) {\n      const bodyRule = root.nodes.find(\n        (node): node is Rule => node.type === \"rule\" && node.selector === \"body\"\n      )\n      if (bodyRule) {\n        // Remove color from the body node.\n        bodyRule.nodes\n          .find(\n            (node): node is postcss.Declaration =>\n              node.type === \"decl\" &&\n              node.prop === \"color\" &&\n              [\"rgb(var(--foreground-rgb))\", \"var(--foreground)\"].includes(\n                node.value\n              )\n          )\n          ?.remove()\n\n        // Remove background: linear-gradient.\n        bodyRule.nodes\n          .find((node): node is postcss.Declaration => {\n            return (\n              node.type === \"decl\" &&\n              node.prop === \"background\" &&\n              // This is only going to run on create project, so all good.\n              (node.value.startsWith(\"linear-gradient\") ||\n                node.value === \"var(--background)\")\n            )\n          })\n          ?.remove()\n\n        // Remove font-family: Arial, Helvetica, sans-serif;\n        bodyRule.nodes\n          .find(\n            (node): node is postcss.Declaration =>\n              node.type === \"decl\" &&\n              node.prop === \"font-family\" &&\n              node.value === \"Arial, Helvetica, sans-serif\"\n          )\n          ?.remove()\n\n        // If the body rule is empty, remove it.\n        if (bodyRule.nodes.length === 0) {\n          bodyRule.remove()\n        }\n      }\n\n      removeConflictVars(root)\n\n      const darkRootRule = root.nodes.find(\n        (node): node is Rule =>\n          node.type === \"atrule\" &&\n          node.params === \"(prefers-color-scheme: dark)\"\n      )\n\n      if (darkRootRule) {\n        removeConflictVars(darkRootRule)\n        if (darkRootRule.nodes.length === 0) {\n          darkRootRule.remove()\n        }\n      }\n    },\n  }\n}\n\nfunction addOrUpdateVars(\n  baseLayer: AtRule,\n  selector: string,\n  vars: Record<string, string>\n) {\n  let ruleNode = baseLayer.nodes?.find(\n    (node): node is Rule => node.type === \"rule\" && node.selector === selector\n  )\n\n  if (!ruleNode) {\n    if (Object.keys(vars).length > 0) {\n      ruleNode = postcss.rule({\n        selector,\n        raws: { between: \" \", before: \"\\n  \" },\n      })\n      baseLayer.append(ruleNode)\n    }\n  }\n\n  Object.entries(vars).forEach(([key, value]) => {\n    const prop = `--${key.replace(/^--/, \"\")}`\n    const newDecl = postcss.decl({\n      prop,\n      value,\n      raws: { semicolon: true },\n    })\n\n    const existingDecl = ruleNode?.nodes.find(\n      (node): node is postcss.Declaration =>\n        node.type === \"decl\" && node.prop === prop\n    )\n\n    existingDecl ? existingDecl.replaceWith(newDecl) : ruleNode?.append(newDecl)\n  })\n}\n\nfunction updateCssVarsPluginV4(\n  cssVars: z.infer<typeof registryItemCssVarsSchema>,\n  options: {\n    overwriteCssVars?: boolean\n  }\n) {\n  return {\n    postcssPlugin: \"update-css-vars-v4\",\n    Once(root: Root) {\n      Object.entries(cssVars).forEach(([key, vars]) => {\n        let selector = key === \"light\" ? \":root\" : `.${key}`\n\n        if (key === \"theme\") {\n          selector = \"@theme\"\n          const themeNode = upsertThemeNode(root)\n          Object.entries(vars).forEach(([key, value]) => {\n            const prop = `--${key.replace(/^--/, \"\")}`\n            const newDecl = postcss.decl({\n              prop,\n              value,\n              raws: { semicolon: true },\n            })\n\n            const existingDecl = themeNode?.nodes?.find(\n              (node): node is postcss.Declaration =>\n                node.type === \"decl\" && node.prop === prop\n            )\n\n            // Only overwrite if overwriteCssVars is true\n            // i.e for registry:theme and registry:style\n            // We do not want new components to overwrite existing vars.\n            // Keep user defined vars.\n            if (options.overwriteCssVars) {\n              if (existingDecl) {\n                existingDecl.replaceWith(newDecl)\n              } else {\n                themeNode?.append(newDecl)\n              }\n            } else {\n              if (!existingDecl) {\n                themeNode?.append(newDecl)\n              }\n            }\n          })\n          return\n        }\n\n        let ruleNode = root.nodes?.find(\n          (node): node is Rule =>\n            node.type === \"rule\" && node.selector === selector\n        )\n\n        if (!ruleNode && Object.keys(vars).length > 0) {\n          ruleNode = postcss.rule({\n            selector,\n            nodes: [],\n            raws: { semicolon: true, between: \" \", before: \"\\n\" },\n          })\n          root.append(ruleNode)\n          root.insertBefore(ruleNode, postcss.comment({ text: \"---break---\" }))\n        }\n\n        Object.entries(vars).forEach(([key, value]) => {\n          let prop = `--${key.replace(/^--/, \"\")}`\n\n          // Special case for sidebar-background.\n          if (prop === \"--sidebar-background\") {\n            prop = \"--sidebar\"\n          }\n\n          if (isLocalHSLValue(value)) {\n            value = `hsl(${value})`\n          }\n\n          const newDecl = postcss.decl({\n            prop,\n            value,\n            raws: { semicolon: true },\n          })\n          const existingDecl = ruleNode?.nodes.find(\n            (node): node is postcss.Declaration =>\n              node.type === \"decl\" && node.prop === prop\n          )\n\n          // Only overwrite if overwriteCssVars is true\n          // i.e for registry:theme and registry:style\n          // We do not want new components to overwrite existing vars.\n          // Keep user defined vars.\n          if (options.overwriteCssVars) {\n            if (existingDecl) {\n              existingDecl.replaceWith(newDecl)\n            } else {\n              ruleNode?.append(newDecl)\n            }\n          } else {\n            if (!existingDecl) {\n              ruleNode?.append(newDecl)\n            }\n          }\n        })\n      })\n    },\n  }\n}\n\nfunction updateThemePlugin(cssVars: z.infer<typeof registryItemCssVarsSchema>) {\n  return {\n    postcssPlugin: \"update-theme\",\n    Once(root: Root) {\n      // Find unique color names from light and dark.\n      const variables = Array.from(\n        new Set(\n          Object.keys(cssVars).flatMap((key) =>\n            Object.keys(cssVars[key as keyof typeof cssVars] || {})\n          )\n        )\n      )\n\n      if (!variables.length) {\n        return\n      }\n\n      const themeNode = upsertThemeNode(root)\n\n      const themeVarNodes = themeNode.nodes?.filter(\n        (node): node is postcss.Declaration =>\n          node.type === \"decl\" && node.prop.startsWith(\"--\")\n      )\n\n      for (const variable of variables) {\n        const value = Object.values(cssVars).find((vars) => vars[variable])?.[\n          variable\n        ]\n\n        if (!value) {\n          continue\n        }\n\n        if (variable === \"radius\") {\n          const radiusVariables = {\n            sm: \"calc(var(--radius) - 4px)\",\n            md: \"calc(var(--radius) - 2px)\",\n            lg: \"var(--radius)\",\n            xl: \"calc(var(--radius) + 4px)\",\n          }\n          for (const [key, value] of Object.entries(radiusVariables)) {\n            const cssVarNode = postcss.decl({\n              prop: `--radius-${key}`,\n              value,\n              raws: { semicolon: true },\n            })\n            if (\n              themeNode?.nodes?.find(\n                (node): node is postcss.Declaration =>\n                  node.type === \"decl\" && node.prop === cssVarNode.prop\n              )\n            ) {\n              continue\n            }\n            themeNode?.append(cssVarNode)\n          }\n          continue\n        }\n\n        let prop =\n          isLocalHSLValue(value) || isColorValue(value)\n            ? `--color-${variable.replace(/^--/, \"\")}`\n            : `--${variable.replace(/^--/, \"\")}`\n        if (prop === \"--color-sidebar-background\") {\n          prop = \"--color-sidebar\"\n        }\n\n        let propValue = `var(--${variable})`\n        if (prop === \"--color-sidebar\") {\n          propValue = \"var(--sidebar)\"\n        }\n\n        const cssVarNode = postcss.decl({\n          prop,\n          value: propValue,\n          raws: { semicolon: true },\n        })\n        const existingDecl = themeNode?.nodes?.find(\n          (node): node is postcss.Declaration =>\n            node.type === \"decl\" && node.prop === cssVarNode.prop\n        )\n        if (!existingDecl) {\n          if (themeVarNodes?.length) {\n            themeNode?.insertAfter(\n              themeVarNodes[themeVarNodes.length - 1],\n              cssVarNode\n            )\n          } else {\n            themeNode?.append(cssVarNode)\n          }\n        }\n      }\n    },\n  }\n}\n\nfunction upsertThemeNode(root: Root): AtRule {\n  let themeNode = root.nodes.find(\n    (node): node is AtRule =>\n      node.type === \"atrule\" &&\n      node.name === \"theme\" &&\n      node.params === \"inline\"\n  )\n\n  if (!themeNode) {\n    themeNode = postcss.atRule({\n      name: \"theme\",\n      params: \"inline\",\n      nodes: [],\n      raws: { semicolon: true, between: \" \", before: \"\\n\" },\n    })\n    root.append(themeNode)\n    root.insertBefore(themeNode, postcss.comment({ text: \"---break---\" }))\n  }\n\n  return themeNode\n}\n\nfunction addCustomVariant({ params }: { params: string }) {\n  return {\n    postcssPlugin: \"add-custom-variant\",\n    Once(root: Root) {\n      const customVariant = root.nodes.find(\n        (node): node is AtRule =>\n          node.type === \"atrule\" && node.name === \"custom-variant\"\n      )\n\n      if (!customVariant) {\n        // Find all import nodes\n        const importNodes = root.nodes.filter(\n          (node): node is AtRule =>\n            node.type === \"atrule\" && node.name === \"import\"\n        )\n\n        const variantNode = postcss.atRule({\n          name: \"custom-variant\",\n          params,\n          raws: { semicolon: true, before: \"\\n\" },\n        })\n\n        if (importNodes.length > 0) {\n          // Insert after the last import\n          const lastImport = importNodes[importNodes.length - 1]\n          root.insertAfter(lastImport, variantNode)\n        } else {\n          // If no imports, insert after the first node\n          root.insertAfter(root.nodes[0], variantNode)\n        }\n\n        root.insertBefore(variantNode, postcss.comment({ text: \"---break---\" }))\n      }\n    },\n  }\n}\n\nfunction addCustomImport({ params }: { params: string }) {\n  return {\n    postcssPlugin: \"add-custom-import\",\n    Once(root: Root) {\n      const importNodes = root.nodes.filter(\n        (node): node is AtRule =>\n          node.type === \"atrule\" && node.name === \"import\"\n      )\n\n      // Find custom variant node (to ensure we insert before it)\n      const customVariantNode = root.nodes.find(\n        (node): node is AtRule =>\n          node.type === \"atrule\" && node.name === \"custom-variant\"\n      )\n\n      // Check if our specific import already exists\n      const hasImport = importNodes.some(\n        (node) => node.params.replace(/[\"']/g, \"\") === params\n      )\n\n      if (!hasImport) {\n        const importNode = postcss.atRule({\n          name: \"import\",\n          params: `\"${params}\"`,\n          raws: { semicolon: true, before: \"\\n\" },\n        })\n\n        if (importNodes.length > 0) {\n          // If there are existing imports, add after the last import\n          const lastImport = importNodes[importNodes.length - 1]\n          root.insertAfter(lastImport, importNode)\n        } else if (customVariantNode) {\n          // If no imports but has custom-variant, insert before it\n          root.insertBefore(customVariantNode, importNode)\n          root.insertBefore(\n            customVariantNode,\n            postcss.comment({ text: \"---break---\" })\n          )\n        } else {\n          // If no imports and no custom-variant, insert at the start\n          root.prepend(importNode)\n          root.insertAfter(importNode, postcss.comment({ text: \"---break---\" }))\n        }\n      }\n    },\n  }\n}\n\nfunction updateTailwindConfigPlugin(\n  tailwindConfig: z.infer<typeof registryItemTailwindSchema>[\"config\"]\n) {\n  return {\n    postcssPlugin: \"update-tailwind-config\",\n    Once(root: Root) {\n      if (!tailwindConfig?.plugins) {\n        return\n      }\n\n      const quoteType = getQuoteType(root)\n      const quote = quoteType === \"single\" ? \"'\" : '\"'\n\n      const pluginNodes = root.nodes.filter(\n        (node): node is AtRule =>\n          node.type === \"atrule\" && node.name === \"plugin\"\n      )\n\n      const lastPluginNode =\n        pluginNodes[pluginNodes.length - 1] || root.nodes[0]\n\n      for (const plugin of tailwindConfig.plugins) {\n        const pluginName = plugin.replace(/^require\\([\"']|[\"']\\)$/g, \"\")\n\n        // Check if the plugin is already present.\n        if (\n          pluginNodes.some((node) => {\n            return node.params.replace(/[\"']/g, \"\") === pluginName\n          })\n        ) {\n          continue\n        }\n\n        const pluginNode = postcss.atRule({\n          name: \"plugin\",\n          params: `${quote}${pluginName}${quote}`,\n          raws: { semicolon: true, before: \"\\n\" },\n        })\n        root.insertAfter(lastPluginNode, pluginNode)\n        root.insertBefore(pluginNode, postcss.comment({ text: \"---break---\" }))\n      }\n    },\n  }\n}\n\nfunction updateTailwindConfigKeyframesPlugin(\n  tailwindConfig: z.infer<typeof registryItemTailwindSchema>[\"config\"]\n) {\n  return {\n    postcssPlugin: \"update-tailwind-config-keyframes\",\n    Once(root: Root) {\n      if (!tailwindConfig?.theme?.extend?.keyframes) {\n        return\n      }\n\n      const themeNode = upsertThemeNode(root)\n      const existingKeyFrameNodes = themeNode.nodes?.filter(\n        (node): node is AtRule =>\n          node.type === \"atrule\" && node.name === \"keyframes\"\n      )\n\n      const keyframeValueSchema = z.record(\n        z.string(),\n        z.record(z.string(), z.string())\n      )\n\n      for (const [keyframeName, keyframeValue] of Object.entries(\n        tailwindConfig.theme.extend.keyframes\n      )) {\n        if (typeof keyframeName !== \"string\") {\n          continue\n        }\n\n        const parsedKeyframeValue = keyframeValueSchema.safeParse(keyframeValue)\n\n        if (!parsedKeyframeValue.success) {\n          continue\n        }\n\n        if (\n          existingKeyFrameNodes?.find(\n            (node): node is postcss.AtRule =>\n              node.type === \"atrule\" &&\n              node.name === \"keyframes\" &&\n              node.params === keyframeName\n          )\n        ) {\n          continue\n        }\n\n        const keyframeNode = postcss.atRule({\n          name: \"keyframes\",\n          params: keyframeName,\n          nodes: [],\n          raws: { semicolon: true, between: \" \", before: \"\\n  \" },\n        })\n\n        for (const [key, values] of Object.entries(parsedKeyframeValue.data)) {\n          const rule = postcss.rule({\n            selector: key,\n            nodes: Object.entries(values).map(([key, value]) =>\n              postcss.decl({\n                prop: key,\n                value,\n                raws: { semicolon: true, before: \"\\n      \", between: \": \" },\n              })\n            ),\n            raws: { semicolon: true, between: \" \", before: \"\\n    \" },\n          })\n          keyframeNode.append(rule)\n        }\n\n        themeNode.append(keyframeNode)\n        themeNode.insertBefore(\n          keyframeNode,\n          postcss.comment({ text: \"---break---\" })\n        )\n      }\n    },\n  }\n}\n\nfunction updateTailwindConfigAnimationPlugin(\n  tailwindConfig: z.infer<typeof registryItemTailwindSchema>[\"config\"]\n) {\n  return {\n    postcssPlugin: \"update-tailwind-config-animation\",\n    Once(root: Root) {\n      if (!tailwindConfig?.theme?.extend?.animation) {\n        return\n      }\n\n      const themeNode = upsertThemeNode(root)\n      const existingAnimationNodes = themeNode.nodes?.filter(\n        (node): node is postcss.Declaration =>\n          node.type === \"decl\" && node.prop.startsWith(\"--animate-\")\n      )\n\n      const parsedAnimationValue = z\n        .record(z.string(), z.string())\n        .safeParse(tailwindConfig.theme.extend.animation)\n      if (!parsedAnimationValue.success) {\n        return\n      }\n\n      for (const [key, value] of Object.entries(parsedAnimationValue.data)) {\n        const prop = `--animate-${key}`\n        if (\n          existingAnimationNodes?.find(\n            (node): node is postcss.Declaration => node.prop === prop\n          )\n        ) {\n          continue\n        }\n\n        const animationNode = postcss.decl({\n          prop,\n          value,\n          raws: { semicolon: true, between: \": \", before: \"\\n  \" },\n        })\n        themeNode.append(animationNode)\n      }\n    },\n  }\n}\n\nfunction getQuoteType(root: Root): \"single\" | \"double\" {\n  const firstNode = root.nodes[0]\n  const raw = firstNode.toString()\n\n  if (raw.includes(\"'\")) {\n    return \"single\"\n  }\n  return \"double\"\n}\n\nexport function isLocalHSLValue(value: string) {\n  if (\n    value.startsWith(\"hsl\") ||\n    value.startsWith(\"rgb\") ||\n    value.startsWith(\"#\") ||\n    value.startsWith(\"oklch\")\n  ) {\n    return false\n  }\n\n  const chunks = value.split(\" \")\n\n  return (\n    chunks.length === 3 &&\n    chunks.slice(1, 3).every((chunk) => chunk.includes(\"%\"))\n  )\n}\n\nexport function isColorValue(value: string) {\n  return (\n    value.startsWith(\"hsl\") ||\n    value.startsWith(\"rgb\") ||\n    value.startsWith(\"#\") ||\n    value.startsWith(\"oklch\")\n  )\n}\n","import { detect } from \"@antfu/ni\"\n\nexport async function getPackageManager(\n  targetDir: string,\n  { withFallback }: { withFallback?: boolean } = {\n    withFallback: false,\n  }\n): Promise<\"yarn\" | \"pnpm\" | \"bun\" | \"npm\" | \"deno\"> {\n  const packageManager = await detect({ programmatic: true, cwd: targetDir })\n\n  if (packageManager === \"yarn@berry\") return \"yarn\"\n  if (packageManager === \"pnpm@6\") return \"pnpm\"\n  if (packageManager === \"bun\") return \"bun\"\n  if (packageManager === \"deno\") return \"deno\"\n  if (!withFallback) {\n    return packageManager ?? \"npm\"\n  }\n\n  // Fallback to user agent if not detected.\n  const userAgent = process.env.npm_config_user_agent || \"\"\n\n  if (userAgent.startsWith(\"yarn\")) {\n    return \"yarn\"\n  }\n\n  if (userAgent.startsWith(\"pnpm\")) {\n    return \"pnpm\"\n  }\n\n  if (userAgent.startsWith(\"bun\")) {\n    return \"bun\"\n  }\n\n  return \"npm\"\n}\n\nexport async function getPackageRunner(cwd: string) {\n  const packageManager = await getPackageManager(cwd)\n\n  if (packageManager === \"pnpm\") return \"pnpm dlx\"\n\n  if (packageManager === \"bun\") return \"bunx\"\n\n  return \"npx\"\n}\n","import { RegistryItem } from \"@/src/registry/schema\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { getPackageInfo } from \"@/src/utils/get-package-info\"\nimport { getPackageManager } from \"@/src/utils/get-package-manager\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { execa } from \"execa\"\nimport prompts from \"prompts\"\n\nexport async function updateDependencies(\n  dependencies: RegistryItem[\"dependencies\"],\n  devDependencies: RegistryItem[\"devDependencies\"],\n  config: Config,\n  options: {\n    silent?: boolean\n  }\n) {\n  dependencies = Array.from(new Set(dependencies))\n  devDependencies = Array.from(new Set(devDependencies))\n\n  if (!dependencies?.length && !devDependencies?.length) {\n    return\n  }\n\n  options = {\n    silent: false,\n    ...options,\n  }\n\n  const dependenciesSpinner = spinner(`Installing dependencies.`, {\n    silent: options.silent,\n  })?.start()\n  const packageManager = await getUpdateDependenciesPackageManager(config)\n\n  // Offer to use --force or --legacy-peer-deps if using React 19 with npm.\n  let flag = \"\"\n  if (shouldPromptForNpmFlag(config) && packageManager === \"npm\") {\n    if (options.silent) {\n      flag = \"force\"\n    } else {\n      dependenciesSpinner.stopAndPersist()\n      logger.warn(\n        \"\\nIt looks like you are using React 19. \\nSome packages may fail to install due to peer dependency issues in npm (see https://ui.shadcn.com/react-19).\\n\"\n      )\n      const confirmation = await prompts([\n        {\n          type: \"select\",\n          name: \"flag\",\n          message: \"How would you like to proceed?\",\n          choices: [\n            { title: \"Use --force\", value: \"force\" },\n            { title: \"Use --legacy-peer-deps\", value: \"legacy-peer-deps\" },\n          ],\n        },\n      ])\n\n      if (confirmation) {\n        flag = confirmation.flag\n      }\n    }\n  }\n\n  dependenciesSpinner?.start()\n\n  await installWithPackageManager(\n    packageManager,\n    dependencies,\n    devDependencies,\n    config.resolvedPaths.cwd,\n    flag\n  )\n\n  dependenciesSpinner?.succeed()\n}\n\nfunction shouldPromptForNpmFlag(config: Config) {\n  const packageInfo = getPackageInfo(config.resolvedPaths.cwd, false)\n\n  if (!packageInfo?.dependencies?.react) {\n    return false\n  }\n\n  const hasReact19 = /^(?:\\^|~)?19(?:\\.\\d+)*(?:-.*)?$/.test(\n    packageInfo.dependencies.react\n  )\n  const hasReactDayPicker8 =\n    packageInfo.dependencies[\"react-day-picker\"]?.startsWith(\"8\")\n\n  return hasReact19 && hasReactDayPicker8\n}\n\nasync function getUpdateDependenciesPackageManager(config: Config) {\n  const expoVersion = getPackageInfo(config.resolvedPaths.cwd, false)\n    ?.dependencies?.expo\n\n  if (expoVersion) {\n    // Ensures package versions match the React Native version.\n    // https://docs.expo.dev/more/expo-cli/#install\n    return \"expo\"\n  }\n\n  return getPackageManager(config.resolvedPaths.cwd)\n}\n\nasync function installWithPackageManager(\n  packageManager: Awaited<\n    ReturnType<typeof getUpdateDependenciesPackageManager>\n  >,\n  dependencies: string[],\n  devDependencies: string[],\n  cwd: string,\n  flag?: string\n) {\n  if (packageManager === \"npm\") {\n    return installWithNpm(dependencies, devDependencies, cwd, flag)\n  }\n\n  if (packageManager === \"deno\") {\n    return installWithDeno(dependencies, devDependencies, cwd)\n  }\n\n  if (packageManager === \"expo\") {\n    return installWithExpo(dependencies, devDependencies, cwd)\n  }\n\n  if (dependencies?.length) {\n    await execa(packageManager, [\"add\", ...dependencies], {\n      cwd,\n    })\n  }\n\n  if (devDependencies?.length) {\n    await execa(packageManager, [\"add\", \"-D\", ...devDependencies], { cwd })\n  }\n}\n\nasync function installWithNpm(\n  dependencies: string[],\n  devDependencies: string[],\n  cwd: string,\n  flag?: string\n) {\n  if (dependencies.length) {\n    await execa(\n      \"npm\",\n      [\"install\", ...(flag ? [`--${flag}`] : []), ...dependencies],\n      { cwd }\n    )\n  }\n\n  if (devDependencies.length) {\n    await execa(\n      \"npm\",\n      [\"install\", ...(flag ? [`--${flag}`] : []), \"-D\", ...devDependencies],\n      { cwd }\n    )\n  }\n}\n\nasync function installWithDeno(\n  dependencies: string[],\n  devDependencies: string[],\n  cwd: string\n) {\n  if (dependencies?.length) {\n    await execa(\"deno\", [\"add\", ...dependencies.map((dep) => `npm:${dep}`)], {\n      cwd,\n    })\n  }\n\n  if (devDependencies?.length) {\n    await execa(\n      \"deno\",\n      [\"add\", \"-D\", ...devDependencies.map((dep) => `npm:${dep}`)],\n      { cwd }\n    )\n  }\n}\n\nasync function installWithExpo(\n  dependencies: string[],\n  devDependencies: string[],\n  cwd: string\n) {\n  if (dependencies.length) {\n    await execa(\"npx\", [\"expo\", \"install\", ...dependencies], { cwd })\n  }\n\n  if (devDependencies.length) {\n    await execa(\"npx\", [\"expo\", \"install\", \"-- -D\", ...devDependencies], {\n      cwd,\n    })\n  }\n}\n","import { existsSync, promises as fs } from \"fs\"\nimport path from \"path\"\nimport { registryItemEnvVarsSchema } from \"@/src/registry/schema\"\nimport {\n  findExistingEnvFile,\n  getNewEnvKeys,\n  mergeEnvContent,\n} from \"@/src/utils/env-helpers\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { z } from \"zod\"\n\nexport async function updateEnvVars(\n  envVars: z.infer<typeof registryItemEnvVarsSchema> | undefined,\n  config: Config,\n  options: {\n    silent?: boolean\n  }\n) {\n  if (!envVars || Object.keys(envVars).length === 0) {\n    return {\n      envVarsAdded: [],\n      envFileUpdated: null,\n      envFileCreated: null,\n    }\n  }\n\n  options = {\n    silent: false,\n    ...options,\n  }\n\n  const envSpinner = spinner(`Adding environment variables.`, {\n    silent: options.silent,\n  })?.start()\n\n  const projectRoot = config.resolvedPaths.cwd\n\n  // Find existing env file or use .env.local as default.\n  let envFilePath = path.join(projectRoot, \".env.local\")\n  const existingEnvFile = findExistingEnvFile(projectRoot)\n\n  if (existingEnvFile) {\n    envFilePath = existingEnvFile\n  }\n\n  const envFileExists = existsSync(envFilePath)\n  const envFileName = path.basename(envFilePath)\n\n  // Convert envVars object to env file format\n  const newEnvContent = Object.entries(envVars)\n    .map(([key, value]) => `${key}=${value}`)\n    .join(\"\\n\")\n\n  let envVarsAdded: string[] = []\n  let envFileUpdated: string | null = null\n  let envFileCreated: string | null = null\n\n  if (envFileExists) {\n    const existingContent = await fs.readFile(envFilePath, \"utf-8\")\n    const mergedContent = mergeEnvContent(existingContent, newEnvContent)\n    envVarsAdded = getNewEnvKeys(existingContent, newEnvContent)\n\n    if (envVarsAdded.length > 0) {\n      await fs.writeFile(envFilePath, mergedContent, \"utf-8\")\n      envFileUpdated = path.relative(projectRoot, envFilePath)\n\n      envSpinner?.succeed(\n        `Added the following variables to ${highlighter.info(envFileName)}:`\n      )\n\n      if (!options.silent) {\n        for (const key of envVarsAdded) {\n          logger.log(`  ${highlighter.success(\"+\")} ${key}`)\n        }\n      }\n    } else {\n      envSpinner?.stop()\n    }\n  } else {\n    // Create new env file\n    await fs.writeFile(envFilePath, newEnvContent + \"\\n\", \"utf-8\")\n    envFileCreated = path.relative(projectRoot, envFilePath)\n    envVarsAdded = Object.keys(envVars)\n\n    envSpinner?.succeed(\n      `Added the following variables to ${highlighter.info(envFileName)}:`\n    )\n\n    if (!options.silent) {\n      for (const key of envVarsAdded) {\n        logger.log(`  ${highlighter.success(\"+\")} ${key}`)\n      }\n    }\n  }\n\n  if (!options.silent && envVarsAdded.length > 0) {\n    logger.break()\n  }\n\n  return {\n    envVarsAdded,\n    envFileUpdated,\n    envFileCreated,\n  }\n}\n","import { existsSync } from \"fs\"\nimport path from \"path\"\n\nexport function isEnvFile(filePath: string) {\n  const fileName = path.basename(filePath)\n  return /^\\.env(\\.|$)/.test(fileName)\n}\n\n/**\n * Finds a file variant in the project.\n * TODO: abstract this to a more generic function.\n */\nexport function findExistingEnvFile(targetDir: string) {\n  const variants = [\n    \".env.local\",\n    \".env\",\n    \".env.development.local\",\n    \".env.development\",\n  ]\n\n  for (const variant of variants) {\n    const filePath = path.join(targetDir, variant)\n    if (existsSync(filePath)) {\n      return filePath\n    }\n  }\n\n  return null\n}\n\n/**\n * Parse .env content into key-value pairs.\n */\nexport function parseEnvContent(content: string) {\n  const lines = content.split(\"\\n\")\n  const env: Record<string, string> = {}\n\n  for (const line of lines) {\n    const trimmed = line.trim()\n\n    if (!trimmed || trimmed.startsWith(\"#\")) {\n      continue\n    }\n\n    // Find the first = and split there\n    const equalIndex = trimmed.indexOf(\"=\")\n    if (equalIndex === -1) {\n      continue\n    }\n\n    const key = trimmed.substring(0, equalIndex).trim()\n    const value = trimmed.substring(equalIndex + 1).trim()\n\n    if (key) {\n      env[key] = value.replace(/^[\"']|[\"']$/g, \"\")\n    }\n  }\n\n  return env\n}\n\n/**\n * Get the list of new keys that would be added when merging env content.\n */\nexport function getNewEnvKeys(existingContent: string, newContent: string) {\n  const existingEnv = parseEnvContent(existingContent)\n  const newEnv = parseEnvContent(newContent)\n\n  const newKeys = []\n  for (const key of Object.keys(newEnv)) {\n    if (!(key in existingEnv)) {\n      newKeys.push(key)\n    }\n  }\n\n  return newKeys\n}\n\n/**\n * Merge env content by appending ONLY new keys that don't exist in the existing content.\n * Existing keys are preserved with their original values.\n */\nexport function mergeEnvContent(existingContent: string, newContent: string) {\n  const existingEnv = parseEnvContent(existingContent)\n  const newEnv = parseEnvContent(newContent)\n\n  let result = existingContent.trimEnd()\n  if (result && !result.endsWith(\"\\n\")) {\n    result += \"\\n\"\n  }\n\n  const newKeys: string[] = []\n  for (const [key, value] of Object.entries(newEnv)) {\n    if (!(key in existingEnv)) {\n      newKeys.push(`${key}=${value}`)\n    }\n  }\n\n  if (newKeys.length > 0) {\n    if (result) {\n      result += \"\\n\"\n    }\n    result += newKeys.join(\"\\n\")\n    return result + \"\\n\"\n  }\n\n  // Ensure existing content ends with newline.\n  if (result && !result.endsWith(\"\\n\")) {\n    return result + \"\\n\"\n  }\n\n  return result\n}\n","import { existsSync, promises as fs } from \"fs\"\nimport { tmpdir } from \"os\"\nimport path, { basename } from \"path\"\nimport { getRegistryBaseColor } from \"@/src/registry/api\"\nimport { RegistryItem, registryItemFileSchema } from \"@/src/registry/schema\"\nimport {\n  findExistingEnvFile,\n  getNewEnvKeys,\n  isEnvFile,\n  mergeEnvContent,\n  parseEnvContent,\n} from \"@/src/utils/env-helpers\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { ProjectInfo, getProjectInfo } from \"@/src/utils/get-project-info\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { resolveImport } from \"@/src/utils/resolve-import\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { transform } from \"@/src/utils/transformers\"\nimport { transformCssVars } from \"@/src/utils/transformers/transform-css-vars\"\nimport { transformIcons } from \"@/src/utils/transformers/transform-icons\"\nimport { transformImport } from \"@/src/utils/transformers/transform-import\"\nimport { transformRsc } from \"@/src/utils/transformers/transform-rsc\"\nimport { transformTwPrefixes } from \"@/src/utils/transformers/transform-tw-prefix\"\nimport prompts from \"prompts\"\nimport { Project, ScriptKind } from \"ts-morph\"\nimport { loadConfig } from \"tsconfig-paths\"\nimport { z } from \"zod\"\n\nexport async function updateFiles(\n  files: RegistryItem[\"files\"],\n  config: Config,\n  options: {\n    overwrite?: boolean\n    force?: boolean\n    silent?: boolean\n    rootSpinner?: ReturnType<typeof spinner>\n    isRemote?: boolean\n  }\n) {\n  if (!files?.length) {\n    return {\n      filesCreated: [],\n      filesUpdated: [],\n      filesSkipped: [],\n    }\n  }\n  options = {\n    overwrite: false,\n    force: false,\n    silent: false,\n    isRemote: false,\n    ...options,\n  }\n  const filesCreatedSpinner = spinner(`Updating files.`, {\n    silent: options.silent,\n  })?.start()\n\n  const [projectInfo, baseColor] = await Promise.all([\n    getProjectInfo(config.resolvedPaths.cwd),\n    config.tailwind.baseColor\n      ? getRegistryBaseColor(config.tailwind.baseColor)\n      : Promise.resolve(undefined),\n  ])\n\n  let filesCreated: string[] = []\n  let filesUpdated: string[] = []\n  let filesSkipped: string[] = []\n  let envVarsAdded: string[] = []\n  let envFile: string | null = null\n\n  for (const file of files) {\n    if (!file.content) {\n      continue\n    }\n\n    let filePath = resolveFilePath(file, config, {\n      isSrcDir: projectInfo?.isSrcDir,\n      framework: projectInfo?.framework.name,\n      commonRoot: findCommonRoot(\n        files.map((f) => f.path),\n        file.path\n      ),\n    })\n\n    if (!filePath) {\n      continue\n    }\n\n    const fileName = basename(file.path)\n    const targetDir = path.dirname(filePath)\n\n    if (!config.tsx) {\n      filePath = filePath.replace(/\\.tsx?$/, (match) =>\n        match === \".tsx\" ? \".jsx\" : \".js\"\n      )\n    }\n\n    if (isEnvFile(filePath) && !existsSync(filePath)) {\n      const alternativeEnvFile = findExistingEnvFile(targetDir)\n      if (alternativeEnvFile) {\n        filePath = alternativeEnvFile\n      }\n    }\n\n    const existingFile = existsSync(filePath)\n\n    // Run our transformers.\n    // Skip transformers for .env files to preserve exact content\n    const content = isEnvFile(filePath)\n      ? file.content\n      : await transform(\n          {\n            filename: file.path,\n            raw: file.content,\n            config,\n            baseColor,\n            transformJsx: !config.tsx,\n            isRemote: options.isRemote,\n          },\n          [\n            transformImport,\n            transformRsc,\n            transformCssVars,\n            transformTwPrefixes,\n            transformIcons,\n          ]\n        )\n\n    // Skip the file if it already exists and the content is the same.\n    // Exception: Don't skip .env files as we merge content instead of replacing\n    if (existingFile && !isEnvFile(filePath)) {\n      const existingFileContent = await fs.readFile(filePath, \"utf-8\")\n      const [normalizedExisting, normalizedNew] = await Promise.all([\n        getNormalizedFileContent(existingFileContent),\n        getNormalizedFileContent(content),\n      ])\n      if (normalizedExisting === normalizedNew) {\n        filesSkipped.push(path.relative(config.resolvedPaths.cwd, filePath))\n        continue\n      }\n    }\n\n    // Skip overwrite prompt for .env files - we'll handle them specially\n    if (existingFile && !options.overwrite && !isEnvFile(filePath)) {\n      filesCreatedSpinner.stop()\n      if (options.rootSpinner) {\n        options.rootSpinner.stop()\n      }\n      const { overwrite } = await prompts({\n        type: \"confirm\",\n        name: \"overwrite\",\n        message: `The file ${highlighter.info(\n          fileName\n        )} already exists. Would you like to overwrite?`,\n        initial: false,\n      })\n\n      if (!overwrite) {\n        filesSkipped.push(path.relative(config.resolvedPaths.cwd, filePath))\n        if (options.rootSpinner) {\n          options.rootSpinner.start()\n        }\n        continue\n      }\n      filesCreatedSpinner?.start()\n      if (options.rootSpinner) {\n        options.rootSpinner.start()\n      }\n    }\n\n    // Create the target directory if it doesn't exist.\n    if (!existsSync(targetDir)) {\n      await fs.mkdir(targetDir, { recursive: true })\n    }\n\n    // Special handling for .env files - append only new keys\n    if (isEnvFile(filePath) && existingFile) {\n      const existingFileContent = await fs.readFile(filePath, \"utf-8\")\n      const mergedContent = mergeEnvContent(existingFileContent, content)\n      envVarsAdded = getNewEnvKeys(existingFileContent, content)\n      envFile = path.relative(config.resolvedPaths.cwd, filePath)\n\n      if (!envVarsAdded.length) {\n        filesSkipped.push(path.relative(config.resolvedPaths.cwd, filePath))\n        continue\n      }\n\n      await fs.writeFile(filePath, mergedContent, \"utf-8\")\n      filesUpdated.push(path.relative(config.resolvedPaths.cwd, filePath))\n      continue\n    }\n\n    await fs.writeFile(filePath, content, \"utf-8\")\n\n    // Handle file creation logging\n    if (!existingFile) {\n      filesCreated.push(path.relative(config.resolvedPaths.cwd, filePath))\n\n      if (isEnvFile(filePath)) {\n        envVarsAdded = Object.keys(parseEnvContent(content))\n        envFile = path.relative(config.resolvedPaths.cwd, filePath)\n      }\n    } else {\n      filesUpdated.push(path.relative(config.resolvedPaths.cwd, filePath))\n    }\n  }\n\n  const allFiles = [...filesCreated, ...filesUpdated, ...filesSkipped]\n  const updatedFiles = await resolveImports(allFiles, config)\n\n  // Let's update filesUpdated with the updated files.\n  filesUpdated.push(...updatedFiles)\n\n  // If a file is in filesCreated and filesUpdated, we should remove it from filesUpdated.\n  filesUpdated = filesUpdated.filter((file) => !filesCreated.includes(file))\n\n  const hasUpdatedFiles = filesCreated.length || filesUpdated.length\n  if (!hasUpdatedFiles && !filesSkipped.length) {\n    filesCreatedSpinner?.info(\"No files updated.\")\n  }\n\n  // Remove duplicates.\n  filesCreated = Array.from(new Set(filesCreated))\n  filesUpdated = Array.from(new Set(filesUpdated))\n  filesSkipped = Array.from(new Set(filesSkipped))\n\n  if (filesCreated.length) {\n    filesCreatedSpinner?.succeed(\n      `Created ${filesCreated.length} ${\n        filesCreated.length === 1 ? \"file\" : \"files\"\n      }:`\n    )\n    if (!options.silent) {\n      for (const file of filesCreated) {\n        logger.log(`  - ${file}`)\n      }\n    }\n  } else {\n    filesCreatedSpinner?.stop()\n  }\n\n  if (filesUpdated.length) {\n    spinner(\n      `Updated ${filesUpdated.length} ${\n        filesUpdated.length === 1 ? \"file\" : \"files\"\n      }:`,\n      {\n        silent: options.silent,\n      }\n    )?.info()\n    if (!options.silent) {\n      for (const file of filesUpdated) {\n        logger.log(`  - ${file}`)\n      }\n    }\n  }\n\n  if (filesSkipped.length) {\n    spinner(\n      `Skipped ${filesSkipped.length} ${\n        filesUpdated.length === 1 ? \"file\" : \"files\"\n      }: (files might be identical, use --overwrite to overwrite)`,\n      {\n        silent: options.silent,\n      }\n    )?.info()\n    if (!options.silent) {\n      for (const file of filesSkipped) {\n        logger.log(`  - ${file}`)\n      }\n    }\n  }\n\n  if (envVarsAdded.length && envFile) {\n    spinner(\n      `Added the following variables to ${highlighter.info(envFile)}:`\n    )?.info()\n    if (!options.silent) {\n      for (const key of envVarsAdded) {\n        logger.log(`  ${highlighter.success(\"+\")} ${key}`)\n      }\n    }\n  }\n\n  if (!options.silent) {\n    logger.break()\n  }\n\n  return {\n    filesCreated,\n    filesUpdated,\n    filesSkipped,\n  }\n}\n\nexport function resolveFilePath(\n  file: z.infer<typeof registryItemFileSchema>,\n  config: Config,\n  options: {\n    isSrcDir?: boolean\n    commonRoot?: string\n    framework?: ProjectInfo[\"framework\"][\"name\"]\n  }\n) {\n  if (file.target) {\n    if (file.target.startsWith(\"~/\")) {\n      return path.join(config.resolvedPaths.cwd, file.target.replace(\"~/\", \"\"))\n    }\n\n    let target = file.target\n\n    if (file.type === \"registry:page\") {\n      target = resolvePageTarget(target, options.framework)\n      if (!target) {\n        return \"\"\n      }\n    }\n\n    return options.isSrcDir\n      ? path.join(config.resolvedPaths.cwd, \"src\", target.replace(\"src/\", \"\"))\n      : path.join(config.resolvedPaths.cwd, target.replace(\"src/\", \"\"))\n  }\n\n  const targetDir = resolveFileTargetDirectory(file, config)\n\n  const relativePath = resolveNestedFilePath(file.path, targetDir)\n  return path.join(targetDir, relativePath)\n}\n\nfunction resolveFileTargetDirectory(\n  file: z.infer<typeof registryItemFileSchema>,\n  config: Config\n) {\n  if (file.type === \"registry:ui\") {\n    return config.resolvedPaths.ui\n  }\n\n  if (file.type === \"registry:lib\") {\n    return config.resolvedPaths.lib\n  }\n\n  if (file.type === \"registry:block\" || file.type === \"registry:component\") {\n    return config.resolvedPaths.components\n  }\n\n  if (file.type === \"registry:hook\") {\n    return config.resolvedPaths.hooks\n  }\n\n  return config.resolvedPaths.components\n}\n\nexport function findCommonRoot(paths: string[], needle: string): string {\n  // Remove leading slashes for consistent handling\n  const normalizedPaths = paths.map((p) => p.replace(/^\\//, \"\"))\n  const normalizedNeedle = needle.replace(/^\\//, \"\")\n\n  // Get the directory path of the needle by removing the file name\n  const needleDir = normalizedNeedle.split(\"/\").slice(0, -1).join(\"/\")\n\n  // If needle is at root level, return empty string\n  if (!needleDir) {\n    return \"\"\n  }\n\n  // Split the needle directory into segments\n  const needleSegments = needleDir.split(\"/\")\n\n  // Start from the full path and work backwards\n  for (let i = needleSegments.length; i > 0; i--) {\n    const testPath = needleSegments.slice(0, i).join(\"/\")\n    // Check if this is a common root by verifying if any other paths start with it\n    const hasRelatedPaths = normalizedPaths.some(\n      (path) => path !== normalizedNeedle && path.startsWith(testPath + \"/\")\n    )\n    if (hasRelatedPaths) {\n      return \"/\" + testPath // Add leading slash back for the result\n    }\n  }\n\n  // If no common root found with other files, return the parent directory of the needle\n  return \"/\" + needleDir // Add leading slash back for the result\n}\n\nexport function resolveNestedFilePath(\n  filePath: string,\n  targetDir: string\n): string {\n  // Normalize paths by removing leading/trailing slashes\n  const normalizedFilePath = filePath.replace(/^\\/|\\/$/g, \"\")\n  const normalizedTargetDir = targetDir.replace(/^\\/|\\/$/g, \"\")\n\n  // Split paths into segments\n  const fileSegments = normalizedFilePath.split(\"/\")\n  const targetSegments = normalizedTargetDir.split(\"/\")\n\n  // Find the last matching segment from targetDir in filePath\n  const lastTargetSegment = targetSegments[targetSegments.length - 1]\n  const commonDirIndex = fileSegments.findIndex(\n    (segment) => segment === lastTargetSegment\n  )\n\n  if (commonDirIndex === -1) {\n    // Return just the filename if no common directory is found\n    return fileSegments[fileSegments.length - 1]\n  }\n\n  // Return everything after the common directory\n  return fileSegments.slice(commonDirIndex + 1).join(\"/\")\n}\n\nexport async function getNormalizedFileContent(content: string) {\n  return content.replace(/\\r\\n/g, \"\\n\").trim()\n}\n\nexport function resolvePageTarget(\n  target: string,\n  framework?: ProjectInfo[\"framework\"][\"name\"]\n) {\n  if (!framework) {\n    return \"\"\n  }\n\n  if (framework === \"next-app\") {\n    return target\n  }\n\n  if (framework === \"next-pages\") {\n    let result = target.replace(/^app\\//, \"pages/\")\n    result = result.replace(/\\/page(\\.[jt]sx?)$/, \"$1\")\n\n    return result\n  }\n\n  if (framework === \"react-router\") {\n    let result = target.replace(/^app\\//, \"app/routes/\")\n    result = result.replace(/\\/page(\\.[jt]sx?)$/, \"$1\")\n\n    return result\n  }\n\n  if (framework === \"laravel\") {\n    let result = target.replace(/^app\\//, \"resources/js/pages/\")\n    result = result.replace(/\\/page(\\.[jt]sx?)$/, \"$1\")\n\n    return result\n  }\n\n  return \"\"\n}\n\nasync function resolveImports(filePaths: string[], config: Config) {\n  const project = new Project({\n    compilerOptions: {},\n  })\n  const projectInfo = await getProjectInfo(config.resolvedPaths.cwd)\n  const tsConfig = loadConfig(config.resolvedPaths.cwd)\n  const updatedFiles = []\n\n  if (!projectInfo || tsConfig.resultType === \"failed\") {\n    return []\n  }\n\n  for (const filepath of filePaths) {\n    const resolvedPath = path.resolve(config.resolvedPaths.cwd, filepath)\n\n    // Check if the file exists.\n    if (!existsSync(resolvedPath)) {\n      continue\n    }\n\n    const content = await fs.readFile(resolvedPath, \"utf-8\")\n\n    const dir = await fs.mkdtemp(path.join(tmpdir(), \"shadcn-\"))\n    const sourceFile = project.createSourceFile(\n      path.join(dir, basename(resolvedPath)),\n      content,\n      {\n        scriptKind: ScriptKind.TSX,\n      }\n    )\n\n    // Skip if the file extension is not one of the supported extensions.\n    if (![\".tsx\", \".ts\", \".jsx\", \".js\"].includes(sourceFile.getExtension())) {\n      continue\n    }\n\n    const importDeclarations = sourceFile.getImportDeclarations()\n    for (const importDeclaration of importDeclarations) {\n      const moduleSpecifier = importDeclaration.getModuleSpecifierValue()\n\n      // Filter out non-local imports.\n      if (\n        projectInfo?.aliasPrefix &&\n        !moduleSpecifier.startsWith(`${projectInfo.aliasPrefix}/`)\n      ) {\n        continue\n      }\n\n      // Find the probable import file path.\n      // This is where we expect to find the file on disk.\n      const probableImportFilePath = await resolveImport(\n        moduleSpecifier,\n        tsConfig\n      )\n\n      if (!probableImportFilePath) {\n        continue\n      }\n\n      // Find the actual import file path.\n      // This is the path where the file has been installed.\n      const resolvedImportFilePath = resolveModuleByProbablePath(\n        probableImportFilePath,\n        filePaths,\n        config\n      )\n\n      if (!resolvedImportFilePath) {\n        continue\n      }\n\n      // Convert the resolved import file path to an aliased import.\n      const newImport = toAliasedImport(\n        resolvedImportFilePath,\n        config,\n        projectInfo\n      )\n\n      if (!newImport || newImport === moduleSpecifier) {\n        continue\n      }\n\n      importDeclaration.setModuleSpecifier(newImport)\n\n      // Write the updated content to the file.\n      await fs.writeFile(resolvedPath, sourceFile.getFullText(), \"utf-8\")\n\n      // Track the updated file.\n      updatedFiles.push(filepath)\n    }\n  }\n\n  return updatedFiles\n}\n\n/**\n * Given an absolute \"probable\" import path (no ext),\n * plus an array of absolute file paths you already know about,\n * return 0–N matches (best match first), and also check disk for any missing ones.\n */\nexport function resolveModuleByProbablePath(\n  probableImportFilePath: string,\n  files: string[],\n  config: Config,\n  extensions: string[] = [\".tsx\", \".ts\", \".js\", \".jsx\", \".css\"]\n) {\n  const cwd = path.normalize(config.resolvedPaths.cwd)\n\n  // 1) Build a set of POSIX-normalized, project-relative files\n  const relativeFiles = files.map((f) => f.split(path.sep).join(path.posix.sep))\n  const fileSet = new Set(relativeFiles)\n\n  // 2) Strip any existing extension off the absolute base path\n  const extInPath = path.extname(probableImportFilePath)\n  const hasExt = extInPath !== \"\"\n  const absBase = hasExt\n    ? probableImportFilePath.slice(0, -extInPath.length)\n    : probableImportFilePath\n\n  // 3) Compute the project-relative \"base\" directory for strong matching\n  const relBaseRaw = path.relative(cwd, absBase)\n  const relBase = relBaseRaw.split(path.sep).join(path.posix.sep)\n\n  // 4) Decide which extensions to try\n  const tryExts = hasExt ? [extInPath] : extensions\n\n  // 5) Collect candidates\n  const candidates = new Set<string>()\n\n  // 5a) Fast‑path: [base + ext] and [base/index + ext]\n  for (const e of tryExts) {\n    const absCand = absBase + e\n    const relCand = path.posix.normalize(path.relative(cwd, absCand))\n    if (fileSet.has(relCand) || existsSync(absCand)) {\n      candidates.add(relCand)\n    }\n\n    const absIdx = path.join(absBase, `index${e}`)\n    const relIdx = path.posix.normalize(path.relative(cwd, absIdx))\n    if (fileSet.has(relIdx) || existsSync(absIdx)) {\n      candidates.add(relIdx)\n    }\n  }\n\n  // 5b) Fallback: scan known files by basename\n  const name = path.basename(absBase)\n  for (const f of relativeFiles) {\n    if (tryExts.some((e) => f.endsWith(`/${name}${e}`))) {\n      candidates.add(f)\n    }\n  }\n\n  // 6) If no matches, bail\n  if (candidates.size === 0) return null\n\n  // 7) Sort by (1) extension priority, then (2) \"strong\" base match\n  const sorted = Array.from(candidates).sort((a, b) => {\n    // a) extension order\n    const aExt = path.posix.extname(a)\n    const bExt = path.posix.extname(b)\n    const ord = tryExts.indexOf(aExt) - tryExts.indexOf(bExt)\n    if (ord !== 0) return ord\n    // b) strong match if path starts with relBase\n    const aStrong = relBase && a.startsWith(relBase) ? -1 : 1\n    const bStrong = relBase && b.startsWith(relBase) ? -1 : 1\n    return aStrong - bStrong\n  })\n\n  // 8) Return the first (best) candidate\n  return sorted[0]\n}\n\nexport function toAliasedImport(\n  filePath: string,\n  config: Config,\n  projectInfo: ProjectInfo\n): string | null {\n  const abs = path.normalize(path.join(config.resolvedPaths.cwd, filePath))\n\n  // 1️⃣ Find the longest matching alias root in resolvedPaths\n  //    e.g. key=\"ui\", root=\"/…/components/ui\" beats key=\"components\"\n  const matches = Object.entries(config.resolvedPaths)\n    .filter(\n      ([, root]) => root && abs.startsWith(path.normalize(root + path.sep))\n    )\n    .sort((a, b) => b[1].length - a[1].length)\n\n  if (matches.length === 0) {\n    return null\n  }\n  const [aliasKey, rootDir] = matches[0]\n\n  // 2️⃣ Compute the path UNDER that root\n  let rel = path.relative(rootDir, abs)\n  // force POSIX-style separators\n  rel = rel.split(path.sep).join(\"/\") // e.g. \"button/index.tsx\"\n\n  // 3️⃣ Strip code-file extensions, keep others (css, json, etc.)\n  const ext = path.posix.extname(rel)\n  const codeExts = [\".ts\", \".tsx\", \".js\", \".jsx\"]\n  const keepExt = codeExts.includes(ext) ? \"\" : ext\n  let noExt = rel.slice(0, rel.length - ext.length)\n\n  // 4️⃣ Collapse \"/index\" to its directory\n  if (noExt.endsWith(\"/index\")) {\n    noExt = noExt.slice(0, -\"/index\".length)\n  }\n\n  // 5️⃣ Build the aliased path\n  //    config.aliases[aliasKey] is e.g. \"@/components/ui\"\n  const aliasBase =\n    aliasKey === \"cwd\"\n      ? projectInfo.aliasPrefix\n      : config.aliases[aliasKey as keyof typeof config.aliases]\n  if (!aliasBase) {\n    return null\n  }\n  // if noExt is empty (i.e. file was exactly at the root), we import the root\n  let suffix = noExt === \"\" ? \"\" : `/${noExt}`\n\n  // Rremove /src from suffix.\n  // Alias will handle this.\n  suffix = suffix.replace(\"/src\", \"\")\n\n  // 6️⃣ Prepend the prefix from projectInfo (e.g. \"@\") if needed\n  //    but usually config.aliases already include it.\n  return `${aliasBase}${suffix}${keepExt}`\n}\n","import { promises as fs } from \"fs\"\nimport { tmpdir } from \"os\"\nimport path from \"path\"\nimport { registryBaseColorSchema } from \"@/src/registry/schema\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { transformCssVars } from \"@/src/utils/transformers/transform-css-vars\"\nimport { transformIcons } from \"@/src/utils/transformers/transform-icons\"\nimport { transformImport } from \"@/src/utils/transformers/transform-import\"\nimport { transformJsx } from \"@/src/utils/transformers/transform-jsx\"\nimport { transformRsc } from \"@/src/utils/transformers/transform-rsc\"\nimport { Project, ScriptKind, type SourceFile } from \"ts-morph\"\nimport { z } from \"zod\"\n\nimport { transformTwPrefixes } from \"./transform-tw-prefix\"\n\nexport type TransformOpts = {\n  filename: string\n  raw: string\n  config: Config\n  baseColor?: z.infer<typeof registryBaseColorSchema>\n  transformJsx?: boolean\n  isRemote?: boolean\n}\n\nexport type Transformer<Output = SourceFile> = (\n  opts: TransformOpts & {\n    sourceFile: SourceFile\n  }\n) => Promise<Output>\n\nconst project = new Project({\n  compilerOptions: {},\n})\n\nasync function createTempSourceFile(filename: string) {\n  const dir = await fs.mkdtemp(path.join(tmpdir(), \"shadcn-\"))\n  return path.join(dir, filename)\n}\n\nexport async function transform(\n  opts: TransformOpts,\n  transformers: Transformer[] = [\n    transformImport,\n    transformRsc,\n    transformCssVars,\n    transformTwPrefixes,\n    transformIcons,\n  ]\n) {\n  const tempFile = await createTempSourceFile(opts.filename)\n  const sourceFile = project.createSourceFile(tempFile, opts.raw, {\n    scriptKind: ScriptKind.TSX,\n  })\n\n  for (const transformer of transformers) {\n    await transformer({ sourceFile, ...opts })\n  }\n\n  if (opts.transformJsx) {\n    return await transformJsx({\n      sourceFile,\n      ...opts,\n    })\n  }\n\n  return sourceFile.getText()\n}\n","import { registryBaseColorSchema } from \"@/src/registry/schema\"\nimport { Transformer } from \"@/src/utils/transformers\"\nimport { ScriptKind, SyntaxKind } from \"ts-morph\"\nimport { z } from \"zod\"\n\nexport const transformCssVars: Transformer = async ({\n  sourceFile,\n  config,\n  baseColor,\n}) => {\n  // No transform if using css variables.\n  if (config.tailwind?.cssVariables || !baseColor?.inlineColors) {\n    return sourceFile\n  }\n\n  // Find jsx attributes with the name className.\n  // const openingElements = sourceFile.getDescendantsOfKind(SyntaxKind.JsxElement)\n  // console.log(openingElements)\n  // const jsxAttributes = sourceFile\n  //   .getDescendantsOfKind(SyntaxKind.JsxAttribute)\n  //   .filter((node) => node.getName() === \"className\")\n\n  // for (const jsxAttribute of jsxAttributes) {\n  //   const value = jsxAttribute.getInitializer()?.getText()\n  //   if (value) {\n  //     const valueWithColorMapping = applyColorMapping(\n  //       value.replace(/\"/g, \"\"),\n  //       baseColor.inlineColors\n  //     )\n  //     jsxAttribute.setInitializer(`\"${valueWithColorMapping}\"`)\n  //   }\n  // }\n  sourceFile.getDescendantsOfKind(SyntaxKind.StringLiteral).forEach((node) => {\n    const value = node.getText()\n    if (value) {\n      const valueWithColorMapping = applyColorMapping(\n        value.replace(/\"/g, \"\"),\n        baseColor.inlineColors\n      )\n      node.replaceWithText(`\"${valueWithColorMapping.trim()}\"`)\n    }\n  })\n\n  return sourceFile\n}\n\n// export default function transformer(file: FileInfo, api: API) {\n//   const j = api.jscodeshift.withParser(\"tsx\")\n\n//   // Replace bg-background with \"bg-white dark:bg-slate-950\"\n//   const $j = j(file.source)\n//   return $j\n//     .find(j.JSXAttribute, {\n//       name: {\n//         name: \"className\",\n//       },\n//     })\n//     .forEach((path) => {\n//       const { node } = path\n//       if (node?.value?.type) {\n//         if (node.value.type === \"StringLiteral\") {\n//           node.value.value = applyColorMapping(node.value.value)\n//           console.log(node.value.value)\n//         }\n\n//         if (\n//           node.value.type === \"JSXExpressionContainer\" &&\n//           node.value.expression.type === \"CallExpression\"\n//         ) {\n//           const callee = node.value.expression.callee\n//           if (callee.type === \"Identifier\" && callee.name === \"cn\") {\n//             node.value.expression.arguments.forEach((arg) => {\n//               if (arg.type === \"StringLiteral\") {\n//                 arg.value = applyColorMapping(arg.value)\n//               }\n\n//               if (\n//                 arg.type === \"LogicalExpression\" &&\n//                 arg.right.type === \"StringLiteral\"\n//               ) {\n//                 arg.right.value = applyColorMapping(arg.right.value)\n//               }\n//             })\n//           }\n//         }\n//       }\n//     })\n//     .toSource()\n// }\n\n// // export function splitClassName(input: string): (string | null)[] {\n// //   const parts = input.split(\":\")\n// //   const classNames = parts.map((part) => {\n// //     const match = part.match(/^\\[?(.+)\\]$/)\n// //     if (match) {\n// //       return match[1]\n// //     } else {\n// //       return null\n// //     }\n// //   })\n\n// //   return classNames\n// // }\n\n// Splits a className into variant-name-alpha.\n// eg. hover:bg-primary-100 -> [hover, bg-primary, 100]\nexport function splitClassName(className: string): (string | null)[] {\n  if (!className.includes(\"/\") && !className.includes(\":\")) {\n    return [null, className, null]\n  }\n\n  const parts: (string | null)[] = []\n  // First we split to find the alpha.\n  let [rest, alpha] = className.split(\"/\")\n\n  // Check if rest has a colon.\n  if (!rest.includes(\":\")) {\n    return [null, rest, alpha]\n  }\n\n  // Next we split the rest by the colon.\n  const split = rest.split(\":\")\n\n  // We take the last item from the split as the name.\n  const name = split.pop()\n\n  // We glue back the rest of the split.\n  const variant = split.join(\":\")\n\n  // Finally we push the variant, name and alpha.\n  parts.push(variant ?? null, name ?? null, alpha ?? null)\n\n  return parts\n}\n\nconst PREFIXES = [\"bg-\", \"text-\", \"border-\", \"ring-offset-\", \"ring-\"]\n\nexport function applyColorMapping(\n  input: string,\n  mapping: z.infer<typeof registryBaseColorSchema>[\"inlineColors\"]\n) {\n  // Handle border classes.\n  if (input.includes(\" border \")) {\n    input = input.replace(\" border \", \" border border-border \")\n  }\n\n  // Build color mappings.\n  const classNames = input.split(\" \")\n  const lightMode = new Set<string>()\n  const darkMode = new Set<string>()\n  for (let className of classNames) {\n    const [variant, value, modifier] = splitClassName(className)\n    const prefix = PREFIXES.find((prefix) => value?.startsWith(prefix))\n    if (!prefix) {\n      if (!lightMode.has(className)) {\n        lightMode.add(className)\n      }\n      continue\n    }\n\n    const needle = value?.replace(prefix, \"\")\n    if (needle && needle in mapping.light) {\n      lightMode.add(\n        [variant, `${prefix}${mapping.light[needle]}`]\n          .filter(Boolean)\n          .join(\":\") + (modifier ? `/${modifier}` : \"\")\n      )\n\n      darkMode.add(\n        [\"dark\", variant, `${prefix}${mapping.dark[needle]}`]\n          .filter(Boolean)\n          .join(\":\") + (modifier ? `/${modifier}` : \"\")\n      )\n      continue\n    }\n\n    if (!lightMode.has(className)) {\n      lightMode.add(className)\n    }\n  }\n\n  return [...Array.from(lightMode), ...Array.from(darkMode)].join(\" \").trim()\n}\n","export const ICON_LIBRARIES = {\n  lucide: {\n    name: \"lucide-react\",\n    package: \"lucide-react\",\n    import: \"lucide-react\",\n  },\n  radix: {\n    name: \"@radix-ui/react-icons\",\n    package: \"@radix-ui/react-icons\",\n    import: \"@radix-ui/react-icons\",\n  },\n}\n","import { getRegistryIcons } from \"@/src/registry/api\"\nimport { ICON_LIBRARIES } from \"@/src/utils/icon-libraries\"\nimport { Transformer } from \"@/src/utils/transformers\"\nimport { SourceFile, SyntaxKind } from \"ts-morph\"\n\n// Lucide is the default icon library in the registry.\nconst SOURCE_LIBRARY = \"lucide\"\n\nexport const transformIcons: Transformer = async ({ sourceFile, config }) => {\n  // No transform if we cannot read the icon library.\n  if (!config.iconLibrary || !(config.iconLibrary in ICON_LIBRARIES)) {\n    return sourceFile\n  }\n\n  const registryIcons = await getRegistryIcons()\n  const sourceLibrary = SOURCE_LIBRARY\n  const targetLibrary = config.iconLibrary\n\n  if (sourceLibrary === targetLibrary) {\n    return sourceFile\n  }\n\n  let targetedIcons: string[] = []\n  for (const importDeclaration of sourceFile.getImportDeclarations() ?? []) {\n    if (\n      importDeclaration.getModuleSpecifier()?.getText() !==\n      `\"${ICON_LIBRARIES[SOURCE_LIBRARY].import}\"`\n    ) {\n      continue\n    }\n\n    for (const specifier of importDeclaration.getNamedImports() ?? []) {\n      const iconName = specifier.getName()\n\n      const targetedIcon = registryIcons[iconName]?.[targetLibrary]\n\n      if (!targetedIcon || targetedIcons.includes(targetedIcon)) {\n        continue\n      }\n\n      targetedIcons.push(targetedIcon)\n\n      // Remove the named import.\n      specifier.remove()\n\n      // Replace with the targeted icon.\n      sourceFile\n        .getDescendantsOfKind(SyntaxKind.JsxSelfClosingElement)\n        .filter((node) => node.getTagNameNode()?.getText() === iconName)\n        .forEach((node) => node.getTagNameNode()?.replaceWithText(targetedIcon))\n    }\n\n    // If the named import is empty, remove the import declaration.\n    if (importDeclaration.getNamedImports()?.length === 0) {\n      importDeclaration.remove()\n    }\n  }\n\n  if (targetedIcons.length > 0) {\n    const iconImportDeclaration = sourceFile.addImportDeclaration({\n      moduleSpecifier:\n        ICON_LIBRARIES[targetLibrary as keyof typeof ICON_LIBRARIES]?.import,\n      namedImports: targetedIcons.map((icon) => ({\n        name: icon,\n      })),\n    })\n\n    if (!_useSemicolon(sourceFile)) {\n      iconImportDeclaration.replaceWithText(\n        iconImportDeclaration.getText().replace(\";\", \"\")\n      )\n    }\n  }\n\n  return sourceFile\n}\n\nfunction _useSemicolon(sourceFile: SourceFile) {\n  return (\n    sourceFile.getImportDeclarations()?.[0]?.getText().endsWith(\";\") ?? false\n  )\n}\n","import { Config } from \"@/src/utils/get-config\"\nimport { Transformer } from \"@/src/utils/transformers\"\n\nexport const transformImport: Transformer = async ({\n  sourceFile,\n  config,\n  isRemote,\n}) => {\n  const workspaceAlias = config.aliases?.utils?.split(\"/\")[0]?.slice(1)\n  const utilsImport = `@${workspaceAlias}/lib/utils`\n\n  const importDeclarations = sourceFile.getImportDeclarations()\n\n  if (![\".tsx\", \".ts\", \".jsx\", \".js\"].includes(sourceFile.getExtension())) {\n    return sourceFile\n  }\n\n  for (const importDeclaration of importDeclarations) {\n    const moduleSpecifier = updateImportAliases(\n      importDeclaration.getModuleSpecifierValue(),\n      config,\n      isRemote\n    )\n\n    importDeclaration.setModuleSpecifier(moduleSpecifier)\n\n    // Replace `import { cn } from \"@/lib/utils\"`\n    if (utilsImport === moduleSpecifier || moduleSpecifier === \"@/lib/utils\") {\n      const namedImports = importDeclaration.getNamedImports()\n      const cnImport = namedImports.find((i) => i.getName() === \"cn\")\n      if (cnImport) {\n        importDeclaration.setModuleSpecifier(\n          utilsImport === moduleSpecifier\n            ? moduleSpecifier.replace(utilsImport, config.aliases.utils)\n            : config.aliases.utils\n        )\n      }\n    }\n  }\n\n  return sourceFile\n}\n\nfunction updateImportAliases(\n  moduleSpecifier: string,\n  config: Config,\n  isRemote: boolean = false\n) {\n  // Not a local import.\n  if (!moduleSpecifier.startsWith(\"@/\") && !isRemote) {\n    return moduleSpecifier\n  }\n\n  // This treats the remote as coming from a faux registry.\n  if (isRemote && moduleSpecifier.startsWith(\"@/\")) {\n    moduleSpecifier = moduleSpecifier.replace(/^@\\//, `@/registry/new-york/`)\n  }\n\n  // Not a registry import.\n  if (!moduleSpecifier.startsWith(\"@/registry/\")) {\n    // We fix the alias and return.\n    const alias = config.aliases.components.split(\"/\")[0]\n    return moduleSpecifier.replace(/^@\\//, `${alias}/`)\n  }\n\n  if (moduleSpecifier.match(/^@\\/registry\\/(.+)\\/ui/)) {\n    return moduleSpecifier.replace(\n      /^@\\/registry\\/(.+)\\/ui/,\n      config.aliases.ui ?? `${config.aliases.components}/ui`\n    )\n  }\n\n  if (\n    config.aliases.components &&\n    moduleSpecifier.match(/^@\\/registry\\/(.+)\\/components/)\n  ) {\n    return moduleSpecifier.replace(\n      /^@\\/registry\\/(.+)\\/components/,\n      config.aliases.components\n    )\n  }\n\n  if (config.aliases.lib && moduleSpecifier.match(/^@\\/registry\\/(.+)\\/lib/)) {\n    return moduleSpecifier.replace(\n      /^@\\/registry\\/(.+)\\/lib/,\n      config.aliases.lib\n    )\n  }\n\n  if (\n    config.aliases.hooks &&\n    moduleSpecifier.match(/^@\\/registry\\/(.+)\\/hooks/)\n  ) {\n    return moduleSpecifier.replace(\n      /^@\\/registry\\/(.+)\\/hooks/,\n      config.aliases.hooks\n    )\n  }\n\n  return moduleSpecifier.replace(\n    /^@\\/registry\\/[^/]+/,\n    config.aliases.components\n  )\n}\n","import { type Transformer } from \"@/src/utils/transformers\"\nimport { transformFromAstSync } from \"@babel/core\"\nimport { ParserOptions, parse } from \"@babel/parser\"\n// @ts-ignore\nimport transformTypescript from \"@babel/plugin-transform-typescript\"\nimport * as recast from \"recast\"\n\n// TODO.\n// I'm using recast for the AST here.\n// Figure out if ts-morph AST is compatible with Babel.\n\n// This is a copy of the babel options from recast/parser.\n// The goal here is to tolerate as much syntax as possible.\n// We want to be able to parse any valid tsx code.\n// See https://github.com/benjamn/recast/blob/master/parsers/_babel_options.ts.\nconst PARSE_OPTIONS: ParserOptions = {\n  sourceType: \"module\",\n  allowImportExportEverywhere: true,\n  allowReturnOutsideFunction: true,\n  startLine: 1,\n  tokens: true,\n  plugins: [\n    \"asyncGenerators\",\n    \"bigInt\",\n    \"classPrivateMethods\",\n    \"classPrivateProperties\",\n    \"classProperties\",\n    \"classStaticBlock\",\n    \"decimal\",\n    \"decorators-legacy\",\n    \"doExpressions\",\n    \"dynamicImport\",\n    \"exportDefaultFrom\",\n    \"exportNamespaceFrom\",\n    \"functionBind\",\n    \"functionSent\",\n    \"importAssertions\",\n    \"importMeta\",\n    \"nullishCoalescingOperator\",\n    \"numericSeparator\",\n    \"objectRestSpread\",\n    \"optionalCatchBinding\",\n    \"optionalChaining\",\n    [\n      \"pipelineOperator\",\n      {\n        proposal: \"minimal\",\n      },\n    ],\n    [\n      \"recordAndTuple\",\n      {\n        syntaxType: \"hash\",\n      },\n    ],\n    \"throwExpressions\",\n    \"topLevelAwait\",\n    \"v8intrinsic\",\n    \"typescript\",\n    \"jsx\",\n  ],\n}\n\nexport const transformJsx: Transformer<string> = async ({\n  sourceFile,\n  config,\n}) => {\n  const output = sourceFile.getFullText()\n\n  if (config.tsx) {\n    return output\n  }\n\n  const ast = recast.parse(output, {\n    parser: {\n      parse: (code: string) => {\n        return parse(code, PARSE_OPTIONS)\n      },\n    },\n  })\n\n  const result = transformFromAstSync(ast, output, {\n    cloneInputAst: false,\n    code: false,\n    ast: true,\n    plugins: [transformTypescript],\n    configFile: false,\n  })\n\n  if (!result || !result.ast) {\n    throw new Error(\"Failed to transform JSX\")\n  }\n\n  return recast.print(result.ast).code\n}\n","import { Transformer } from \"@/src/utils/transformers\"\nimport { SyntaxKind } from \"ts-morph\"\n\nconst directiveRegex = /^[\"']use client[\"']$/g\n\nexport const transformRsc: Transformer = async ({ sourceFile, config }) => {\n  if (config.rsc) {\n    return sourceFile\n  }\n\n  // Remove \"use client\" from the top of the file.\n  const first = sourceFile.getFirstChildByKind(SyntaxKind.ExpressionStatement)\n  if (first && directiveRegex.test(first.getText())) {\n    first.remove()\n  }\n\n  return sourceFile\n}\n","import { Transformer } from \"@/src/utils/transformers\"\nimport { SyntaxKind } from \"ts-morph\"\n\nimport {\n  TailwindVersion,\n  getProjectTailwindVersionFromConfig,\n} from \"../get-project-info\"\nimport { splitClassName } from \"./transform-css-vars\"\n\nexport const transformTwPrefixes: Transformer = async ({\n  sourceFile,\n  config,\n}) => {\n  if (!config.tailwind?.prefix) {\n    return sourceFile\n  }\n  const tailwindVersion = await getProjectTailwindVersionFromConfig(config)\n\n  // Find the cva function calls.\n  sourceFile\n    .getDescendantsOfKind(SyntaxKind.CallExpression)\n    .filter((node) => node.getExpression().getText() === \"cva\")\n    .forEach((node) => {\n      // cva(base, ...)\n      if (node.getArguments()[0]?.isKind(SyntaxKind.StringLiteral)) {\n        const defaultClassNames = node.getArguments()[0]\n        if (defaultClassNames) {\n          defaultClassNames.replaceWithText(\n            `\"${applyPrefix(\n              defaultClassNames.getText()?.replace(/\"|'/g, \"\"),\n              config.tailwind.prefix,\n              tailwindVersion\n            )}\"`\n          )\n        }\n      }\n\n      // cva(..., { variants: { ... } })\n      if (node.getArguments()[1]?.isKind(SyntaxKind.ObjectLiteralExpression)) {\n        node\n          .getArguments()[1]\n          ?.getDescendantsOfKind(SyntaxKind.PropertyAssignment)\n          .find((node) => node.getName() === \"variants\")\n          ?.getDescendantsOfKind(SyntaxKind.PropertyAssignment)\n          .forEach((node) => {\n            node\n              .getDescendantsOfKind(SyntaxKind.PropertyAssignment)\n              .forEach((node) => {\n                const classNames = node.getInitializerIfKind(\n                  SyntaxKind.StringLiteral\n                )\n                if (classNames) {\n                  classNames?.replaceWithText(\n                    `\"${applyPrefix(\n                      classNames.getText()?.replace(/\"|'/g, \"\"),\n                      config.tailwind.prefix,\n                      tailwindVersion\n                    )}\"`\n                  )\n                }\n              })\n          })\n      }\n    })\n\n  // Find all jsx attributes with the name className.\n  sourceFile.getDescendantsOfKind(SyntaxKind.JsxAttribute).forEach((node) => {\n    if (node.getName() === \"className\") {\n      // className=\"...\"\n      if (node.getInitializer()?.isKind(SyntaxKind.StringLiteral)) {\n        const value = node.getInitializer()\n        if (value) {\n          value.replaceWithText(\n            `\"${applyPrefix(\n              value.getText()?.replace(/\"|'/g, \"\"),\n              config.tailwind.prefix,\n              tailwindVersion\n            )}\"`\n          )\n        }\n      }\n\n      // className={...}\n      if (node.getInitializer()?.isKind(SyntaxKind.JsxExpression)) {\n        // Check if it's a call to cn().\n        const callExpression = node\n          .getInitializer()\n          ?.getDescendantsOfKind(SyntaxKind.CallExpression)\n          .find((node) => node.getExpression().getText() === \"cn\")\n        if (callExpression) {\n          // Loop through the arguments.\n          callExpression.getArguments().forEach((node) => {\n            if (\n              node.isKind(SyntaxKind.ConditionalExpression) ||\n              node.isKind(SyntaxKind.BinaryExpression)\n            ) {\n              node\n                .getChildrenOfKind(SyntaxKind.StringLiteral)\n                .forEach((node) => {\n                  node.replaceWithText(\n                    `\"${applyPrefix(\n                      node.getText()?.replace(/\"|'/g, \"\"),\n                      config.tailwind.prefix,\n                      tailwindVersion\n                    )}\"`\n                  )\n                })\n            }\n\n            if (node.isKind(SyntaxKind.StringLiteral)) {\n              node.replaceWithText(\n                `\"${applyPrefix(\n                  node.getText()?.replace(/\"|'/g, \"\"),\n                  config.tailwind.prefix,\n                  tailwindVersion\n                )}\"`\n              )\n            }\n          })\n        }\n      }\n    }\n\n    // classNames={...}\n    if (node.getName() === \"classNames\") {\n      if (node.getInitializer()?.isKind(SyntaxKind.JsxExpression)) {\n        node\n          .getDescendantsOfKind(SyntaxKind.PropertyAssignment)\n          .forEach((node) => {\n            if (node.getInitializer()?.isKind(SyntaxKind.CallExpression)) {\n              const callExpression = node.getInitializerIfKind(\n                SyntaxKind.CallExpression\n              )\n              if (callExpression) {\n                // Loop through the arguments.\n                callExpression.getArguments().forEach((arg) => {\n                  if (arg.isKind(SyntaxKind.ConditionalExpression)) {\n                    arg\n                      .getChildrenOfKind(SyntaxKind.StringLiteral)\n                      .forEach((node) => {\n                        node.replaceWithText(\n                          `\"${applyPrefix(\n                            node.getText()?.replace(/\"|'/g, \"\"),\n                            config.tailwind.prefix,\n                            tailwindVersion\n                          )}\"`\n                        )\n                      })\n                  }\n\n                  if (arg.isKind(SyntaxKind.StringLiteral)) {\n                    arg.replaceWithText(\n                      `\"${applyPrefix(\n                        arg.getText()?.replace(/\"|'/g, \"\"),\n                        config.tailwind.prefix,\n                        tailwindVersion\n                      )}\"`\n                    )\n                  }\n                })\n              }\n            }\n\n            if (node.getInitializer()?.isKind(SyntaxKind.StringLiteral)) {\n              if (node.getName() !== \"variant\") {\n                const classNames = node.getInitializer()\n                if (classNames) {\n                  classNames.replaceWithText(\n                    `\"${applyPrefix(\n                      classNames.getText()?.replace(/\"|'/g, \"\"),\n                      config.tailwind.prefix,\n                      tailwindVersion\n                    )}\"`\n                  )\n                }\n              }\n            }\n          })\n      }\n    }\n  })\n\n  return sourceFile\n}\n\nexport function applyPrefix(\n  input: string,\n  prefix: string = \"\",\n  tailwindVersion: TailwindVersion\n) {\n  if (tailwindVersion === \"v3\") {\n    return input\n      .split(\" \")\n      .map((className) => {\n        const [variant, value, modifier] = splitClassName(className)\n        if (variant) {\n          return modifier\n            ? `${variant}:${prefix}${value}/${modifier}`\n            : `${variant}:${prefix}${value}`\n        } else {\n          return modifier\n            ? `${prefix}${value}/${modifier}`\n            : `${prefix}${value}`\n        }\n      })\n      .join(\" \")\n  }\n\n  return input\n    .split(\" \")\n    .map((className) =>\n      className.indexOf(`${prefix}:`) === 0\n        ? className\n        : `${prefix}:${className.trim()}`\n    )\n    .join(\" \")\n}\n\nexport function applyPrefixesCss(\n  css: string,\n  prefix: string,\n  tailwindVersion: TailwindVersion\n) {\n  const lines = css.split(\"\\n\")\n  for (let line of lines) {\n    if (line.includes(\"@apply\")) {\n      const originalTWCls = line.replace(\"@apply\", \"\").trim()\n      const prefixedTwCls = applyPrefix(originalTWCls, prefix, tailwindVersion)\n      css = css.replace(originalTWCls, prefixedTwCls)\n    }\n  }\n  return css\n}\n","import os from \"os\"\nimport path from \"path\"\nimport { initOptionsSchema } from \"@/src/commands/init\"\nimport { fetchRegistry } from \"@/src/registry/api\"\nimport { getPackageManager } from \"@/src/utils/get-package-manager\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { execa } from \"execa\"\nimport fs from \"fs-extra\"\nimport prompts from \"prompts\"\nimport { z } from \"zod\"\n\nconst MONOREPO_TEMPLATE_URL =\n  \"https://codeload.github.com/shadcn-ui/ui/tar.gz/main\"\n\nexport const TEMPLATES = {\n  next: \"next\",\n  \"next-monorepo\": \"next-monorepo\",\n} as const\n\nexport async function createProject(\n  options: Pick<\n    z.infer<typeof initOptionsSchema>,\n    \"cwd\" | \"force\" | \"srcDir\" | \"components\" | \"template\"\n  >\n) {\n  options = {\n    srcDir: false,\n    ...options,\n  }\n\n  let template: keyof typeof TEMPLATES =\n    options.template && TEMPLATES[options.template as keyof typeof TEMPLATES]\n      ? (options.template as keyof typeof TEMPLATES)\n      : \"next\"\n  let projectName: string =\n    template === TEMPLATES.next ? \"my-app\" : \"my-monorepo\"\n  let nextVersion = \"latest\"\n\n  const isRemoteComponent =\n    options.components?.length === 1 &&\n    !!options.components[0].match(/\\/chat\\/b\\//)\n\n  if (options.components && isRemoteComponent) {\n    try {\n      const [result] = await fetchRegistry(options.components)\n      const { meta } = z\n        .object({\n          meta: z.object({\n            nextVersion: z.string(),\n          }),\n        })\n        .parse(result)\n      nextVersion = meta.nextVersion\n\n      // Force template to next for remote components.\n      template = TEMPLATES.next\n    } catch (error) {\n      logger.break()\n      handleError(error)\n    }\n  }\n\n  if (!options.force) {\n    const { type, name } = await prompts([\n      {\n        type: options.template || isRemoteComponent ? null : \"select\",\n        name: \"type\",\n        message: `The path ${highlighter.info(\n          options.cwd\n        )} does not contain a package.json file.\\n  Would you like to start a new project?`,\n        choices: [\n          { title: \"Next.js\", value: \"next\" },\n          { title: \"Next.js (Monorepo)\", value: \"next-monorepo\" },\n        ],\n        initial: 0,\n      },\n      {\n        type: \"text\",\n        name: \"name\",\n        message: \"What is your project named?\",\n        initial: projectName,\n        format: (value: string) => value.trim(),\n        validate: (value: string) =>\n          value.length > 128\n            ? `Name should be less than 128 characters.`\n            : true,\n      },\n    ])\n\n    template = type ?? template\n    projectName = name\n  }\n\n  const packageManager = await getPackageManager(options.cwd, {\n    withFallback: true,\n  })\n\n  const projectPath = `${options.cwd}/${projectName}`\n\n  // Check if path is writable.\n  try {\n    await fs.access(options.cwd, fs.constants.W_OK)\n  } catch (error) {\n    logger.break()\n    logger.error(`The path ${highlighter.info(options.cwd)} is not writable.`)\n    logger.error(\n      `It is likely you do not have write permissions for this folder or the path ${highlighter.info(\n        options.cwd\n      )} does not exist.`\n    )\n    logger.break()\n    process.exit(1)\n  }\n\n  if (fs.existsSync(path.resolve(options.cwd, projectName, \"package.json\"))) {\n    logger.break()\n    logger.error(\n      `A project with the name ${highlighter.info(projectName)} already exists.`\n    )\n    logger.error(`Please choose a different name and try again.`)\n    logger.break()\n    process.exit(1)\n  }\n\n  if (template === TEMPLATES.next) {\n    await createNextProject(projectPath, {\n      version: nextVersion,\n      cwd: options.cwd,\n      packageManager,\n      srcDir: !!options.srcDir,\n    })\n  }\n\n  if (template === TEMPLATES[\"next-monorepo\"]) {\n    await createMonorepoProject(projectPath, {\n      packageManager,\n    })\n  }\n\n  return {\n    projectPath,\n    projectName,\n    template,\n  }\n}\n\nasync function createNextProject(\n  projectPath: string,\n  options: {\n    version: string\n    cwd: string\n    packageManager: string\n    srcDir: boolean\n  }\n) {\n  const createSpinner = spinner(\n    `Creating a new Next.js project. This may take a few minutes.`\n  ).start()\n\n  // Note: pnpm fails here. Fallback to npx with --use-PACKAGE-MANAGER.\n  const args = [\n    \"--tailwind\",\n    \"--eslint\",\n    \"--typescript\",\n    \"--app\",\n    options.srcDir ? \"--src-dir\" : \"--no-src-dir\",\n    \"--no-import-alias\",\n    `--use-${options.packageManager}`,\n  ]\n\n  if (\n    options.version.startsWith(\"15\") ||\n    options.version.startsWith(\"latest\") ||\n    options.version.startsWith(\"canary\")\n  ) {\n    args.push(\"--turbopack\")\n  }\n\n  try {\n    await execa(\n      \"npx\",\n      [`create-next-app@${options.version}`, projectPath, \"--silent\", ...args],\n      {\n        cwd: options.cwd,\n      }\n    )\n  } catch (error) {\n    logger.break()\n    logger.error(\n      `Something went wrong creating a new Next.js project. Please try again.`\n    )\n    process.exit(1)\n  }\n\n  createSpinner?.succeed(\"Creating a new Next.js project.\")\n}\n\nasync function createMonorepoProject(\n  projectPath: string,\n  options: {\n    packageManager: string\n  }\n) {\n  const createSpinner = spinner(\n    `Creating a new Next.js monorepo. This may take a few minutes.`\n  ).start()\n\n  try {\n    // Get the template.\n    const templatePath = path.join(os.tmpdir(), `shadcn-template-${Date.now()}`)\n    await fs.ensureDir(templatePath)\n    const response = await fetch(MONOREPO_TEMPLATE_URL)\n    if (!response.ok) {\n      throw new Error(`Failed to download template: ${response.statusText}`)\n    }\n\n    // Write the tar file\n    const tarPath = path.resolve(templatePath, \"template.tar.gz\")\n    await fs.writeFile(tarPath, Buffer.from(await response.arrayBuffer()))\n    await execa(\"tar\", [\n      \"-xzf\",\n      tarPath,\n      \"-C\",\n      templatePath,\n      \"--strip-components=2\",\n      \"ui-main/templates/monorepo-next\",\n    ])\n    const extractedPath = path.resolve(templatePath, \"monorepo-next\")\n    await fs.move(extractedPath, projectPath)\n    await fs.remove(templatePath)\n\n    // Run install.\n    await execa(options.packageManager, [\"install\"], {\n      cwd: projectPath,\n    })\n\n    // Try git init.\n    const cwd = process.cwd()\n    await execa(\"git\", [\"--version\"], { cwd: projectPath })\n    await execa(\"git\", [\"init\"], { cwd: projectPath })\n    await execa(\"git\", [\"add\", \"-A\"], { cwd: projectPath })\n    await execa(\"git\", [\"commit\", \"-m\", \"Initial commit\"], {\n      cwd: projectPath,\n    })\n    await execa(\"cd\", [cwd])\n\n    createSpinner?.succeed(\"Creating a new Next.js monorepo.\")\n  } catch (error) {\n    createSpinner?.fail(\"Something went wrong creating a new Next.js monorepo.\")\n    handleError(error)\n  }\n}\n","import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport {\n  _createSourceFile,\n  _getQuoteChar,\n} from \"@/src/utils/updaters/update-tailwind-config\"\nimport { ObjectLiteralExpression, SyntaxKind } from \"ts-morph\"\n\nexport async function updateTailwindContent(\n  content: string[],\n  config: Config,\n  options: {\n    silent?: boolean\n  }\n) {\n  if (!content) {\n    return\n  }\n\n  options = {\n    silent: false,\n    ...options,\n  }\n\n  const tailwindFileRelativePath = path.relative(\n    config.resolvedPaths.cwd,\n    config.resolvedPaths.tailwindConfig\n  )\n  const tailwindSpinner = spinner(\n    `Updating ${highlighter.info(tailwindFileRelativePath)}`,\n    {\n      silent: options.silent,\n    }\n  ).start()\n  const raw = await fs.readFile(config.resolvedPaths.tailwindConfig, \"utf8\")\n  const output = await transformTailwindContent(raw, content, config)\n  await fs.writeFile(config.resolvedPaths.tailwindConfig, output, \"utf8\")\n  tailwindSpinner?.succeed()\n}\n\nexport async function transformTailwindContent(\n  input: string,\n  content: string[],\n  config: Config\n) {\n  const sourceFile = await _createSourceFile(input, config)\n  // Find the object with content property.\n  // This is faster than traversing the default export.\n  // TODO: maybe we do need to traverse the default export?\n  const configObject = sourceFile\n    .getDescendantsOfKind(SyntaxKind.ObjectLiteralExpression)\n    .find((node) =>\n      node\n        .getProperties()\n        .some(\n          (property) =>\n            property.isKind(SyntaxKind.PropertyAssignment) &&\n            property.getName() === \"content\"\n        )\n    )\n\n  // We couldn't find the config object, so we return the input as is.\n  if (!configObject) {\n    return input\n  }\n\n  addTailwindConfigContent(configObject, content)\n\n  return sourceFile.getFullText()\n}\n\nasync function addTailwindConfigContent(\n  configObject: ObjectLiteralExpression,\n  content: string[]\n) {\n  const quoteChar = _getQuoteChar(configObject)\n\n  const existingProperty = configObject.getProperty(\"content\")\n\n  if (!existingProperty) {\n    const newProperty = {\n      name: \"content\",\n      initializer: `[${quoteChar}${content.join(\n        `${quoteChar}, ${quoteChar}`\n      )}${quoteChar}]`,\n    }\n    configObject.addPropertyAssignment(newProperty)\n\n    return configObject\n  }\n\n  if (existingProperty.isKind(SyntaxKind.PropertyAssignment)) {\n    const initializer = existingProperty.getInitializer()\n\n    // If property is an array, append.\n    if (initializer?.isKind(SyntaxKind.ArrayLiteralExpression)) {\n      for (const contentItem of content) {\n        const newValue = `${quoteChar}${contentItem}${quoteChar}`\n\n        // Check if the array already contains the value.\n        if (\n          initializer\n            .getElements()\n            .map((element) => element.getText())\n            .includes(newValue)\n        ) {\n          continue\n        }\n\n        initializer.addElement(newValue)\n      }\n    }\n\n    return configObject\n  }\n\n  return configObject\n}\n","import path from \"path\"\nimport { addOptionsSchema } from \"@/src/commands/add\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { getConfig } from \"@/src/utils/get-config\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport fs from \"fs-extra\"\nimport { z } from \"zod\"\n\nexport async function preFlightAdd(options: z.infer<typeof addOptionsSchema>) {\n  const errors: Record<string, boolean> = {}\n\n  // Ensure target directory exists.\n  // Check for empty project. We assume if no package.json exists, the project is empty.\n  if (\n    !fs.existsSync(options.cwd) ||\n    !fs.existsSync(path.resolve(options.cwd, \"package.json\"))\n  ) {\n    errors[ERRORS.MISSING_DIR_OR_EMPTY_PROJECT] = true\n    return {\n      errors,\n      config: null,\n    }\n  }\n\n  // Check for existing components.json file.\n  if (!fs.existsSync(path.resolve(options.cwd, \"components.json\"))) {\n    errors[ERRORS.MISSING_CONFIG] = true\n    return {\n      errors,\n      config: null,\n    }\n  }\n\n  try {\n    const config = await getConfig(options.cwd)\n\n    return {\n      errors,\n      config: config!,\n    }\n  } catch (error) {\n    logger.break()\n    logger.error(\n      `An invalid ${highlighter.info(\n        \"components.json\"\n      )} file was found at ${highlighter.info(\n        options.cwd\n      )}.\\nBefore you can add components, you must create a valid ${highlighter.info(\n        \"components.json\"\n      )} file by running the ${highlighter.info(\"init\")} command.`\n    )\n    logger.error(\n      `Learn more at ${highlighter.info(\n        \"https://ui.shadcn.com/docs/components-json\"\n      )}.`\n    )\n    logger.break()\n    process.exit(1)\n  }\n}\n","import fs from \"fs/promises\"\nimport path from \"path\"\nimport { getRegistryItem } from \"@/src/registry/api\"\nimport { Config } from \"@/src/utils/get-config\"\n\nexport async function updateAppIndex(component: string, config: Config) {\n  const indexPath = path.join(config.resolvedPaths.cwd, \"app/page.tsx\")\n\n  if (!(await fs.stat(indexPath)).isFile()) {\n    return\n  }\n\n  const registryItem = await getRegistryItem(component, config.style)\n  if (\n    !registryItem?.meta?.importSpecifier ||\n    !registryItem?.meta?.moduleSpecifier\n  ) {\n    return\n  }\n\n  // Overwrite the index file with the new import.\n  const content = `import { ${registryItem?.meta?.importSpecifier} } from \"${registryItem.meta.moduleSpecifier}\"\\n\\nexport default function Page() {\\n  return <${registryItem?.meta?.importSpecifier} />\\n}`\n  await fs.writeFile(indexPath, content, \"utf8\")\n}\n","import * as fs from \"fs/promises\"\nimport * as path from \"path\"\nimport { preFlightBuild } from \"@/src/preflights/preflight-build\"\nimport { registryItemSchema, registrySchema } from \"@/src/registry\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { Command } from \"commander\"\nimport { z } from \"zod\"\n\nexport const buildOptionsSchema = z.object({\n  cwd: z.string(),\n  registryFile: z.string(),\n  outputDir: z.string(),\n})\n\nexport const build = new Command()\n  .name(\"build\")\n  .description(\"build components for a shadcn registry\")\n  .argument(\"[registry]\", \"path to registry.json file\", \"./registry.json\")\n  .option(\n    \"-o, --output <path>\",\n    \"destination directory for json files\",\n    \"./public/r\"\n  )\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .action(async (registry: string, opts) => {\n    try {\n      const options = buildOptionsSchema.parse({\n        cwd: path.resolve(opts.cwd),\n        registryFile: registry,\n        outputDir: opts.output,\n      })\n\n      const { resolvePaths } = await preFlightBuild(options)\n      const content = await fs.readFile(resolvePaths.registryFile, \"utf-8\")\n\n      const result = registrySchema.safeParse(JSON.parse(content))\n\n      if (!result.success) {\n        logger.error(\n          `Invalid registry file found at ${highlighter.info(\n            resolvePaths.registryFile\n          )}.`\n        )\n        process.exit(1)\n      }\n\n      const buildSpinner = spinner(\"Building registry...\")\n      for (const registryItem of result.data.items) {\n        if (!registryItem.files) {\n          continue\n        }\n\n        buildSpinner.start(`Building ${registryItem.name}...`)\n\n        // Add the schema to the registry item.\n        registryItem[\"$schema\"] =\n          \"https://ui.shadcn.com/schema/registry-item.json\"\n\n        // Loop through each file in the files array.\n        for (const file of registryItem.files) {\n          file[\"content\"] = await fs.readFile(\n            path.resolve(resolvePaths.cwd, file.path),\n            \"utf-8\"\n          )\n        }\n\n        // Validate the registry item.\n        const result = registryItemSchema.safeParse(registryItem)\n        if (!result.success) {\n          logger.error(\n            `Invalid registry item found for ${highlighter.info(\n              registryItem.name\n            )}.`\n          )\n          continue\n        }\n\n        // Write the registry item to the output directory.\n        await fs.writeFile(\n          path.resolve(resolvePaths.outputDir, `${result.data.name}.json`),\n          JSON.stringify(result.data, null, 2)\n        )\n      }\n\n      buildSpinner.succeed(\"Building registry.\")\n    } catch (error) {\n      logger.break()\n      handleError(error)\n    }\n  })\n","import path from \"path\"\nimport { buildOptionsSchema } from \"@/src/commands/build\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport fs from \"fs-extra\"\nimport { z } from \"zod\"\n\nexport async function preFlightBuild(\n  options: z.infer<typeof buildOptionsSchema>\n) {\n  const errors: Record<string, boolean> = {}\n\n  const resolvePaths = {\n    cwd: options.cwd,\n    registryFile: path.resolve(options.cwd, options.registryFile),\n    outputDir: path.resolve(options.cwd, options.outputDir),\n  }\n\n  // Ensure registry file exists.\n  if (!fs.existsSync(resolvePaths.registryFile)) {\n    errors[ERRORS.BUILD_MISSING_REGISTRY_FILE] = true\n  }\n\n  // Create output directory if it doesn't exist.\n  await fs.mkdir(resolvePaths.outputDir, { recursive: true })\n\n  if (Object.keys(errors).length > 0) {\n    if (errors[ERRORS.BUILD_MISSING_REGISTRY_FILE]) {\n      logger.break()\n      logger.error(\n        `The path ${highlighter.info(\n          resolvePaths.registryFile\n        )} does not exist.`\n      )\n    }\n\n    logger.break()\n    process.exit(1)\n  }\n\n  return {\n    errors,\n    resolvePaths,\n  }\n}\n","import { existsSync, promises as fs } from \"fs\"\nimport path from \"path\"\nimport {\n  fetchTree,\n  getItemTargetPath,\n  getRegistryBaseColor,\n  getRegistryIndex,\n} from \"@/src/registry/api\"\nimport { registryIndexSchema } from \"@/src/registry/schema\"\nimport { Config, getConfig } from \"@/src/utils/get-config\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { transform } from \"@/src/utils/transformers\"\nimport { Command } from \"commander\"\nimport { diffLines, type Change } from \"diff\"\nimport { z } from \"zod\"\n\nconst updateOptionsSchema = z.object({\n  component: z.string().optional(),\n  yes: z.boolean(),\n  cwd: z.string(),\n  path: z.string().optional(),\n})\n\nexport const diff = new Command()\n  .name(\"diff\")\n  .description(\"check for updates against the registry\")\n  .argument(\"[component]\", \"the component name\")\n  .option(\"-y, --yes\", \"skip confirmation prompt.\", false)\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .action(async (name, opts) => {\n    try {\n      const options = updateOptionsSchema.parse({\n        component: name,\n        ...opts,\n      })\n\n      const cwd = path.resolve(options.cwd)\n\n      if (!existsSync(cwd)) {\n        logger.error(`The path ${cwd} does not exist. Please try again.`)\n        process.exit(1)\n      }\n\n      const config = await getConfig(cwd)\n      if (!config) {\n        logger.warn(\n          `Configuration is missing. Please run ${highlighter.success(\n            `init`\n          )} to create a components.json file.`\n        )\n        process.exit(1)\n      }\n\n      const registryIndex = await getRegistryIndex()\n\n      if (!registryIndex) {\n        handleError(new Error(\"Failed to fetch registry index.\"))\n        process.exit(1)\n      }\n\n      if (!options.component) {\n        const targetDir = config.resolvedPaths.components\n\n        // Find all components that exist in the project.\n        const projectComponents = registryIndex.filter((item) => {\n          for (const file of item.files ?? []) {\n            const filePath = path.resolve(\n              targetDir,\n              typeof file === \"string\" ? file : file.path\n            )\n            if (existsSync(filePath)) {\n              return true\n            }\n          }\n\n          return false\n        })\n\n        // Check for updates.\n        const componentsWithUpdates = []\n        for (const component of projectComponents) {\n          const changes = await diffComponent(component, config)\n          if (changes.length) {\n            componentsWithUpdates.push({\n              name: component.name,\n              changes,\n            })\n          }\n        }\n\n        if (!componentsWithUpdates.length) {\n          logger.info(\"No updates found.\")\n          process.exit(0)\n        }\n\n        logger.info(\"The following components have updates available:\")\n        for (const component of componentsWithUpdates) {\n          logger.info(`- ${component.name}`)\n          for (const change of component.changes) {\n            logger.info(`  - ${change.filePath}`)\n          }\n        }\n        logger.break()\n        logger.info(\n          `Run ${highlighter.success(`diff <component>`)} to see the changes.`\n        )\n        process.exit(0)\n      }\n\n      // Show diff for a single component.\n      const component = registryIndex.find(\n        (item) => item.name === options.component\n      )\n\n      if (!component) {\n        logger.error(\n          `The component ${highlighter.success(\n            options.component\n          )} does not exist.`\n        )\n        process.exit(1)\n      }\n\n      const changes = await diffComponent(component, config)\n\n      if (!changes.length) {\n        logger.info(`No updates found for ${options.component}.`)\n        process.exit(0)\n      }\n\n      for (const change of changes) {\n        logger.info(`- ${change.filePath}`)\n        await printDiff(change.patch)\n        logger.info(\"\")\n      }\n    } catch (error) {\n      handleError(error)\n    }\n  })\n\nasync function diffComponent(\n  component: z.infer<typeof registryIndexSchema>[number],\n  config: Config\n) {\n  const payload = await fetchTree(config.style, [component])\n  const baseColor = await getRegistryBaseColor(config.tailwind.baseColor)\n\n  if (!payload) {\n    return []\n  }\n\n  const changes = []\n\n  for (const item of payload) {\n    const targetDir = await getItemTargetPath(config, item)\n\n    if (!targetDir) {\n      continue\n    }\n\n    for (const file of item.files ?? []) {\n      const filePath = path.resolve(\n        targetDir,\n        typeof file === \"string\" ? file : file.path\n      )\n\n      if (!existsSync(filePath)) {\n        continue\n      }\n\n      const fileContent = await fs.readFile(filePath, \"utf8\")\n\n      if (typeof file === \"string\" || !file.content) {\n        continue\n      }\n\n      const registryContent = await transform({\n        filename: file.path,\n        raw: file.content,\n        config,\n        baseColor,\n      })\n\n      const patch = diffLines(registryContent as string, fileContent)\n      if (patch.length > 1) {\n        changes.push({\n          filePath,\n          patch,\n        })\n      }\n    }\n  }\n\n  return changes\n}\n\nasync function printDiff(diff: Change[]) {\n  diff.forEach((part) => {\n    if (part) {\n      if (part.added) {\n        return process.stdout.write(highlighter.success(part.value))\n      }\n      if (part.removed) {\n        return process.stdout.write(highlighter.error(part.value))\n      }\n\n      return process.stdout.write(part.value)\n    }\n  })\n}\n","import { getConfig } from \"@/src/utils/get-config\"\nimport { getProjectInfo } from \"@/src/utils/get-project-info\"\nimport { logger } from \"@/src/utils/logger\"\nimport { Command } from \"commander\"\n\nexport const info = new Command()\n  .name(\"info\")\n  .description(\"get information about your project\")\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .action(async (opts) => {\n    logger.info(\"> project info\")\n    console.log(await getProjectInfo(opts.cwd))\n    logger.break()\n    logger.info(\"> components.json\")\n    console.log(await getConfig(opts.cwd))\n  })\n","import path from \"path\"\nimport { migrateIcons } from \"@/src/migrations/migrate-icons\"\nimport { migrateRadix } from \"@/src/migrations/migrate-radix\"\nimport { preFlightMigrate } from \"@/src/preflights/preflight-migrate\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { logger } from \"@/src/utils/logger\"\nimport { Command } from \"commander\"\nimport { z } from \"zod\"\n\nexport const migrations = [\n  {\n    name: \"icons\",\n    description: \"migrate your ui components to a different icon library.\",\n  },\n  {\n    name: \"radix\",\n    description: \"migrate to radix-ui.\",\n  },\n] as const\n\nexport const migrateOptionsSchema = z.object({\n  cwd: z.string(),\n  list: z.boolean(),\n  yes: z.boolean(),\n  migration: z\n    .string()\n    .refine(\n      (value) =>\n        value && migrations.some((migration) => migration.name === value),\n      {\n        message:\n          \"You must specify a valid migration. Run `shadcn migrate --list` to see available migrations.\",\n      }\n    )\n    .optional(),\n})\n\nexport const migrate = new Command()\n  .name(\"migrate\")\n  .description(\"run a migration.\")\n  .argument(\"[migration]\", \"the migration to run.\")\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .option(\"-l, --list\", \"list all migrations.\", false)\n  .option(\"-y, --yes\", \"skip confirmation prompt.\", false)\n  .action(async (migration, opts) => {\n    try {\n      const options = migrateOptionsSchema.parse({\n        cwd: path.resolve(opts.cwd),\n        migration,\n        list: opts.list,\n        yes: opts.yes,\n      })\n\n      if (options.list || !options.migration) {\n        logger.info(\"Available migrations:\")\n        for (const migration of migrations) {\n          logger.info(`- ${migration.name}: ${migration.description}`)\n        }\n        return\n      }\n\n      if (!options.migration) {\n        throw new Error(\n          \"You must specify a migration. Run `shadcn migrate --list` to see available migrations.\"\n        )\n      }\n\n      let { errors, config } = await preFlightMigrate(options)\n\n      if (\n        errors[ERRORS.MISSING_DIR_OR_EMPTY_PROJECT] ||\n        errors[ERRORS.MISSING_CONFIG]\n      ) {\n        throw new Error(\n          \"No `components.json` file found. Ensure you are at the root of your project.\"\n        )\n      }\n\n      if (!config) {\n        throw new Error(\n          \"Something went wrong reading your `components.json` file. Please ensure you have a valid `components.json` file.\"\n        )\n      }\n\n      if (options.migration === \"icons\") {\n        await migrateIcons(config)\n      }\n\n      if (options.migration === \"radix\") {\n        await migrateRadix(config, { yes: options.yes })\n      }\n    } catch (error) {\n      logger.break()\n      handleError(error)\n    }\n  })\n","import { randomBytes } from \"crypto\"\nimport { promises as fs } from \"fs\"\nimport { tmpdir } from \"os\"\nimport path from \"path\"\nimport { getRegistryIcons } from \"@/src/registry/api\"\nimport { iconsSchema } from \"@/src/registry/schema\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { ICON_LIBRARIES } from \"@/src/utils/icon-libraries\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { updateDependencies } from \"@/src/utils/updaters/update-dependencies\"\nimport fg from \"fast-glob\"\nimport prompts from \"prompts\"\nimport { Project, ScriptKind, SyntaxKind } from \"ts-morph\"\nimport { z } from \"zod\"\n\nexport async function migrateIcons(config: Config) {\n  if (!config.resolvedPaths.ui) {\n    throw new Error(\n      \"We could not find a valid `ui` path in your `components.json` file. Please ensure you have a valid `ui` path in your `components.json` file.\"\n    )\n  }\n\n  const uiPath = config.resolvedPaths.ui\n  const [files, registryIcons] = await Promise.all([\n    fg(\"**/*.{js,ts,jsx,tsx}\", {\n      cwd: uiPath,\n    }),\n    getRegistryIcons(),\n  ])\n\n  if (Object.keys(registryIcons).length === 0) {\n    throw new Error(\"Something went wrong fetching the registry icons.\")\n  }\n\n  const libraryChoices = Object.entries(ICON_LIBRARIES).map(\n    ([name, iconLibrary]) => ({\n      title: iconLibrary.name,\n      value: name,\n    })\n  )\n\n  const migrateOptions = await prompts([\n    {\n      type: \"select\",\n      name: \"sourceLibrary\",\n      message: `Which icon library would you like to ${highlighter.info(\n        \"migrate from\"\n      )}?`,\n      choices: libraryChoices,\n    },\n    {\n      type: \"select\",\n      name: \"targetLibrary\",\n      message: `Which icon library would you like to ${highlighter.info(\n        \"migrate to\"\n      )}?`,\n      choices: libraryChoices,\n    },\n  ])\n\n  if (migrateOptions.sourceLibrary === migrateOptions.targetLibrary) {\n    throw new Error(\n      \"You cannot migrate to the same icon library. Please choose a different icon library.\"\n    )\n  }\n\n  if (\n    !(\n      migrateOptions.sourceLibrary in ICON_LIBRARIES &&\n      migrateOptions.targetLibrary in ICON_LIBRARIES\n    )\n  ) {\n    throw new Error(\"Invalid icon library. Please choose a valid icon library.\")\n  }\n\n  const sourceLibrary =\n    ICON_LIBRARIES[migrateOptions.sourceLibrary as keyof typeof ICON_LIBRARIES]\n  const targetLibrary =\n    ICON_LIBRARIES[migrateOptions.targetLibrary as keyof typeof ICON_LIBRARIES]\n  const { confirm } = await prompts({\n    type: \"confirm\",\n    name: \"confirm\",\n    initial: true,\n    message: `We will migrate ${highlighter.info(\n      files.length\n    )} files in ${highlighter.info(\n      `./${path.relative(config.resolvedPaths.cwd, uiPath)}`\n    )} from ${highlighter.info(sourceLibrary.name)} to ${highlighter.info(\n      targetLibrary.name\n    )}. Continue?`,\n  })\n\n  if (!confirm) {\n    logger.info(\"Migration cancelled.\")\n    process.exit(0)\n  }\n\n  if (targetLibrary.package) {\n    await updateDependencies([targetLibrary.package], [], config, {\n      silent: false,\n    })\n  }\n\n  const migrationSpinner = spinner(`Migrating icons...`)?.start()\n\n  await Promise.all(\n    files.map(async (file) => {\n      migrationSpinner.text = `Migrating ${file}...`\n\n      const filePath = path.join(uiPath, file)\n      const fileContent = await fs.readFile(filePath, \"utf-8\")\n\n      const content = await migrateIconsFile(\n        fileContent,\n        migrateOptions.sourceLibrary,\n        migrateOptions.targetLibrary,\n        registryIcons\n      )\n\n      await fs.writeFile(filePath, content)\n    })\n  )\n\n  migrationSpinner.succeed(\"Migration complete.\")\n}\n\nexport async function migrateIconsFile(\n  content: string,\n  sourceLibrary: keyof typeof ICON_LIBRARIES,\n  targetLibrary: keyof typeof ICON_LIBRARIES,\n  iconsMapping: z.infer<typeof iconsSchema>\n) {\n  const sourceLibraryImport = ICON_LIBRARIES[sourceLibrary]?.import\n  const targetLibraryImport = ICON_LIBRARIES[targetLibrary]?.import\n\n  const dir = await fs.mkdtemp(path.join(tmpdir(), \"shadcn-\"))\n  const project = new Project({\n    compilerOptions: {},\n  })\n\n  const tempFile = path.join(\n    dir,\n    `shadcn-icons-${randomBytes(4).toString(\"hex\")}.tsx`\n  )\n  const sourceFile = project.createSourceFile(tempFile, content, {\n    scriptKind: ScriptKind.TSX,\n  })\n\n  // Find all sourceLibrary imports.\n  let targetedIcons: string[] = []\n  for (const importDeclaration of sourceFile.getImportDeclarations() ?? []) {\n    if (\n      importDeclaration.getModuleSpecifier()?.getText() !==\n      `\"${sourceLibraryImport}\"`\n    ) {\n      continue\n    }\n\n    for (const specifier of importDeclaration.getNamedImports() ?? []) {\n      const iconName = specifier.getName()\n\n      // TODO: this is O(n^2) but okay for now.\n      const targetedIcon = Object.values(iconsMapping).find(\n        (icon) => icon[sourceLibrary] === iconName\n      )?.[targetLibrary]\n\n      if (!targetedIcon || targetedIcons.includes(targetedIcon)) {\n        continue\n      }\n\n      targetedIcons.push(targetedIcon)\n\n      // Remove the named import.\n      specifier.remove()\n\n      // Replace with the targeted icon.\n      sourceFile\n        .getDescendantsOfKind(SyntaxKind.JsxSelfClosingElement)\n        .filter((node) => node.getTagNameNode()?.getText() === iconName)\n        .forEach((node) => node.getTagNameNode()?.replaceWithText(targetedIcon))\n    }\n\n    // If the named import is empty, remove the import declaration.\n    if (importDeclaration.getNamedImports()?.length === 0) {\n      importDeclaration.remove()\n    }\n  }\n\n  if (targetedIcons.length > 0) {\n    sourceFile.addImportDeclaration({\n      moduleSpecifier: targetLibraryImport,\n      namedImports: targetedIcons.map((icon) => ({\n        name: icon,\n      })),\n    })\n  }\n\n  return await sourceFile.getText()\n}\n","import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport { Config } from \"@/src/utils/get-config\"\nimport { getPackageInfo } from \"@/src/utils/get-package-info\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { updateDependencies } from \"@/src/utils/updaters/update-dependencies\"\nimport fg from \"fast-glob\"\nimport prompts from \"prompts\"\n\nfunction toPascalCase(str: string): string {\n  return str\n    .split(\"-\")\n    .map((part) => part.charAt(0).toUpperCase() + part.slice(1))\n    .join(\"\")\n}\n\nfunction processNamedImports(\n  namedImports: string,\n  isTypeOnly: boolean,\n  imports: Array<{ name: string; alias?: string; isType?: boolean }>,\n  packageName: string\n) {\n  // Clean up multi-line imports.\n  // Remove comments and whitespace.\n  const cleanedImports = namedImports\n    .replace(/\\/\\/.*$/gm, \"\")\n    .replace(/\\/\\*[\\s\\S]*?\\*\\//g, \"\")\n    .replace(/\\s+/g, \" \")\n    .trim()\n\n  const namedImportList = cleanedImports\n    .split(\",\")\n    .map((importItem) => importItem.trim())\n    .filter(Boolean)\n\n  for (const importItem of namedImportList) {\n    const inlineTypeMatch = importItem.match(/^type\\s+(\\w+)(?:\\s+as\\s+(\\w+))?$/)\n    const aliasMatch = importItem.match(/^(\\w+)\\s+as\\s+(\\w+)$/)\n\n    if (inlineTypeMatch) {\n      // Inline type: \"type DialogProps\" or \"type DialogProps as Props\"\n      const importName = inlineTypeMatch[1]\n      const importAlias = inlineTypeMatch[2]\n\n      if (packageName === \"slot\" && importName === \"Slot\" && !importAlias) {\n        imports.push({\n          name: \"Slot\",\n          alias: \"SlotPrimitive\",\n          isType: true,\n        })\n      } else {\n        imports.push({\n          name: importName,\n          alias: importAlias,\n          isType: true,\n        })\n      }\n    } else if (aliasMatch) {\n      // Regular import with alias: \"Root as DialogRoot\"\n      const importName = aliasMatch[1]\n      const importAlias = aliasMatch[2]\n\n      if (\n        packageName === \"slot\" &&\n        importName === \"Slot\" &&\n        importAlias === \"Slot\"\n      ) {\n        imports.push({\n          name: \"Slot\",\n          alias: \"SlotPrimitive\",\n          isType: isTypeOnly,\n        })\n      } else {\n        imports.push({\n          name: importName,\n          alias: importAlias,\n          isType: isTypeOnly,\n        })\n      }\n    } else {\n      // Simple import: \"Root\"\n      // Special handling for Slot: always alias it as SlotPrimitive\n      if (packageName === \"slot\" && importItem === \"Slot\") {\n        imports.push({\n          name: \"Slot\",\n          alias: \"SlotPrimitive\",\n          isType: isTypeOnly,\n        })\n      } else {\n        imports.push({\n          name: importItem,\n          isType: isTypeOnly,\n        })\n      }\n    }\n  }\n}\n\nexport async function migrateRadix(\n  config: Config,\n  options: { yes?: boolean } = {}\n) {\n  if (!config.resolvedPaths.ui) {\n    throw new Error(\n      \"We could not find a valid `ui` path in your `components.json` file. Please ensure you have a valid `ui` path in your `components.json` file.\"\n    )\n  }\n\n  const uiPath = config.resolvedPaths.ui\n  const files = await fg(\"**/*.{js,ts,jsx,tsx}\", {\n    cwd: uiPath,\n  })\n\n  if (!options.yes) {\n    const { confirm } = await prompts({\n      type: \"confirm\",\n      name: \"confirm\",\n      initial: true,\n      message: `We will migrate ${highlighter.info(\n        files.length\n      )} files in ${highlighter.info(\n        `./${path.relative(config.resolvedPaths.cwd, uiPath)}`\n      )} to ${highlighter.info(\"radix-ui\")}. Continue?`,\n    })\n\n    if (!confirm) {\n      logger.info(\"Migration cancelled.\")\n      process.exit(0)\n    }\n  }\n\n  const migrationSpinner = spinner(`Migrating imports...`)?.start()\n  const foundPackages = new Set<string>()\n\n  await Promise.all(\n    files.map(async (file) => {\n      migrationSpinner.text = `Migrating ${file}...`\n\n      const filePath = path.join(uiPath, file)\n      const fileContent = await fs.readFile(filePath, \"utf-8\")\n\n      const { content, replacedPackages } = await migrateRadixFile(fileContent)\n\n      // Track which packages we found\n      replacedPackages.forEach((pkg) => foundPackages.add(pkg))\n\n      await fs.writeFile(filePath, content)\n    })\n  )\n\n  migrationSpinner.succeed(\"Migrating imports.\")\n\n  // Update package.json dependencies\n  const packageSpinner = spinner(`Updating package.json...`)?.start()\n\n  try {\n    const packageJson = getPackageInfo(config.resolvedPaths.cwd, false)\n\n    if (!packageJson) {\n      packageSpinner.fail(\"Could not read package.json\")\n      logger.warn(\n        \"Could not update package.json. You may need to manually replace @radix-ui/react-* packages with radix-ui\"\n      )\n      return\n    }\n\n    const foundPackagesArray = Array.from(foundPackages)\n\n    // Remove packages from both dependencies and devDependencies if found in source files\n    const dependencyTypes = [\"dependencies\", \"devDependencies\"] as const\n    for (const depType of dependencyTypes) {\n      if (packageJson[depType]) {\n        for (const pkg of foundPackagesArray) {\n          if (packageJson[depType]![pkg]) {\n            delete packageJson[depType]![pkg]\n          }\n        }\n      }\n    }\n\n    // Add radix-ui if we found any Radix packages.\n    if (foundPackagesArray.length > 0) {\n      if (!packageJson.dependencies) {\n        packageJson.dependencies = {}\n      }\n      packageJson.dependencies[\"radix-ui\"] = \"latest\"\n\n      const packageJsonPath = path.join(\n        config.resolvedPaths.cwd,\n        \"package.json\"\n      )\n      await fs.writeFile(\n        packageJsonPath,\n        JSON.stringify(packageJson, null, 2) + \"\\n\"\n      )\n\n      packageSpinner.succeed(`Updated package.json.`)\n\n      // Install radix-ui dependency.\n      await updateDependencies([\"radix-ui\"], [], config, { silent: false })\n    } else {\n      packageSpinner.succeed(\"No packages found in source files.\")\n    }\n  } catch (error) {\n    packageSpinner.fail(\"Failed to update package.json\")\n    logger.warn(\n      \"You may need to manually replace @radix-ui/react-* packages with radix-ui\"\n    )\n  }\n}\n\nexport async function migrateRadixFile(\n  content: string\n): Promise<{ content: string; replacedPackages: string[] }> {\n  // Enhanced regex to handle type-only imports, but exclude react-icons\n  // Also capture optional semicolon at the end\n  const radixImportPattern =\n    /import\\s+(?:(type)\\s+)?(?:\\*\\s+as\\s+(\\w+)|{([^}]+)})\\s+from\\s+([\"'])@radix-ui\\/react-([^\"']+)\\4(;?)/g\n\n  const imports: Array<{ name: string; alias?: string; isType?: boolean }> = []\n  const linesToRemove: string[] = []\n  const replacedPackages: string[] = []\n  let quoteStyle = '\"' // Default to double quotes\n  let hasSemicolon = false // Track if any import had a semicolon\n\n  let result = content\n  let match\n\n  // Find all Radix imports\n  while ((match = radixImportPattern.exec(content)) !== null) {\n    const [\n      fullMatch,\n      typeKeyword,\n      namespaceAlias,\n      namedImports,\n      quote,\n      packageName,\n      semicolon,\n    ] = match\n\n    // Skip react-icons package and any sub-paths (like react-icons/dist/types)\n    if (packageName === \"icons\" || packageName.startsWith(\"icons/\")) {\n      continue\n    }\n\n    linesToRemove.push(fullMatch)\n\n    // Use the quote style and semicolon style from the first import\n    if (linesToRemove.length === 1) {\n      quoteStyle = quote\n      hasSemicolon = semicolon === \";\"\n    }\n\n    // Track which package we're replacing\n    replacedPackages.push(`@radix-ui/react-${packageName}`)\n\n    const isTypeOnly = Boolean(typeKeyword)\n\n    if (namespaceAlias) {\n      // Handle namespace imports: import * as DialogPrimitive from \"@radix-ui/react-dialog\"\n      const componentName = toPascalCase(packageName)\n      imports.push({\n        name: componentName,\n        alias: namespaceAlias,\n        isType: isTypeOnly,\n      })\n    } else if (namedImports) {\n      // Handle named imports: import { Root, Trigger } from \"@radix-ui/react-dialog\"\n      // or import type { DialogProps } from \"@radix-ui/react-dialog\"\n      // or import { type DialogProps, Root } from \"@radix-ui/react-dialog\"\n\n      processNamedImports(namedImports, isTypeOnly, imports, packageName)\n    }\n  }\n\n  if (imports.length === 0) {\n    return {\n      content,\n      replacedPackages: [],\n    }\n  }\n\n  // Remove duplicates.\n  // Considering name, alias, and type status.\n  const uniqueImports = imports.filter(\n    (importName, index, self) =>\n      index ===\n      self.findIndex(\n        (i) =>\n          i.name === importName.name &&\n          i.alias === importName.alias &&\n          i.isType === importName.isType\n      )\n  )\n\n  // Create the unified import with preserved quote style and type annotations\n  const importList = uniqueImports\n    .map((imp) => {\n      const typePrefix = imp.isType ? \"type \" : \"\"\n      return imp.alias\n        ? `${typePrefix}${imp.name} as ${imp.alias}`\n        : `${typePrefix}${imp.name}`\n    })\n    .join(\", \")\n\n  const unifiedImport = `import { ${importList} } from ${quoteStyle}radix-ui${quoteStyle}${\n    hasSemicolon ? \";\" : \"\"\n  }`\n\n  // Replace first import with unified import, remove the rest\n  result = linesToRemove.reduce((acc, line, index) => {\n    return acc.replace(line, index === 0 ? unifiedImport : \"\")\n  }, result)\n\n  // Clean up extra blank lines\n  result = result.replace(/\\n\\s*\\n\\s*\\n/g, \"\\n\\n\")\n\n  // Handle special case for Slot usage transformation\n  // Now that we import { Slot as SlotPrimitive }, we need to:\n  // 1. Transform: const Comp = asChild ? Slot : [ANYTHING] -> const Comp = asChild ? SlotPrimitive.Slot : [ANYTHING]\n  // 2. Transform: React.ComponentProps<typeof Slot> -> React.ComponentProps<typeof SlotPrimitive.Slot>\n  const hasSlotImport = uniqueImports.some(\n    (imp) => imp.name === \"Slot\" && imp.alias === \"SlotPrimitive\"\n  )\n\n  if (hasSlotImport) {\n    // Find all lines that are NOT import lines to avoid transforming the import statement itself\n    const lines = result.split(\"\\n\")\n    const transformedLines = lines.map((line) => {\n      // Skip import lines\n      if (line.trim().startsWith(\"import \")) {\n        return line\n      }\n\n      let transformedLine = line\n\n      // Handle all Slot references in one comprehensive pass\n      // Use placeholders to avoid double replacements\n\n      // First, mark specific patterns with placeholders\n      transformedLine = transformedLine.replace(\n        /\\b(asChild\\s*\\?\\s*)Slot(\\s*:)/g,\n        \"$1__SLOT_PLACEHOLDER__$2\"\n      )\n\n      transformedLine = transformedLine.replace(\n        /\\bReact\\.ComponentProps<typeof\\s+Slot>/g,\n        \"React.ComponentProps<typeof __SLOT_PLACEHOLDER__>\"\n      )\n\n      transformedLine = transformedLine.replace(\n        /\\bComponentProps<typeof\\s+Slot>/g,\n        \"ComponentProps<typeof __SLOT_PLACEHOLDER__>\"\n      )\n\n      transformedLine = transformedLine.replace(\n        /(<\\/?)Slot(\\s*\\/?>)/g,\n        \"$1__SLOT_PLACEHOLDER__$2\"\n      )\n\n      // Handle any other standalone Slot usage\n      transformedLine = transformedLine.replace(\n        /\\bSlot\\b/g,\n        (match, offset, string) => {\n          // Don't transform if it's inside quotes\n          const beforeMatch = string.substring(0, offset)\n          const openQuotes = (beforeMatch.match(/\"/g) || []).length\n          const openSingleQuotes = (beforeMatch.match(/'/g) || []).length\n\n          // If we're inside quotes, don't transform\n          if (openQuotes % 2 !== 0 || openSingleQuotes % 2 !== 0) {\n            return match\n          }\n\n          return \"__SLOT_PLACEHOLDER__\"\n        }\n      )\n\n      // Finally, replace all placeholders with SlotPrimitive.Slot\n      transformedLine = transformedLine.replace(\n        /__SLOT_PLACEHOLDER__/g,\n        \"SlotPrimitive.Slot\"\n      )\n\n      return transformedLine\n    })\n\n    result = transformedLines.join(\"\\n\")\n  }\n\n  // Remove duplicate packages\n  const uniqueReplacedPackages = Array.from(new Set(replacedPackages))\n\n  return {\n    content: result,\n    replacedPackages: uniqueReplacedPackages,\n  }\n}\n","import path from \"path\"\nimport { addOptionsSchema } from \"@/src/commands/add\"\nimport { migrateOptionsSchema } from \"@/src/commands/migrate\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { getConfig } from \"@/src/utils/get-config\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport fs from \"fs-extra\"\nimport { z } from \"zod\"\n\nexport async function preFlightMigrate(\n  options: z.infer<typeof migrateOptionsSchema>\n) {\n  const errors: Record<string, boolean> = {}\n\n  // Ensure target directory exists.\n  // Check for empty project. We assume if no package.json exists, the project is empty.\n  if (\n    !fs.existsSync(options.cwd) ||\n    !fs.existsSync(path.resolve(options.cwd, \"package.json\"))\n  ) {\n    errors[ERRORS.MISSING_DIR_OR_EMPTY_PROJECT] = true\n    return {\n      errors,\n      config: null,\n    }\n  }\n\n  // Check for existing components.json file.\n  if (!fs.existsSync(path.resolve(options.cwd, \"components.json\"))) {\n    errors[ERRORS.MISSING_CONFIG] = true\n    return {\n      errors,\n      config: null,\n    }\n  }\n\n  try {\n    const config = await getConfig(options.cwd)\n\n    return {\n      errors,\n      config: config!,\n    }\n  } catch (error) {\n    logger.break()\n    logger.error(\n      `An invalid ${highlighter.info(\n        \"components.json\"\n      )} file was found at ${highlighter.info(\n        options.cwd\n      )}.\\nBefore you can run a migration, you must create a valid ${highlighter.info(\n        \"components.json\"\n      )} file by running the ${highlighter.info(\"init\")} command.`\n    )\n    logger.error(\n      `Learn more at ${highlighter.info(\n        \"https://ui.shadcn.com/docs/components-json\"\n      )}.`\n    )\n    logger.break()\n    process.exit(1)\n  }\n}\n","import * as fs from \"fs/promises\"\nimport * as path from \"path\"\nimport { preFlightRegistryBuild } from \"@/src/preflights/preflight-registry\"\nimport { registryItemSchema, registrySchema } from \"@/src/registry\"\nimport { recursivelyResolveFileImports } from \"@/src/registry/utils\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { configSchema } from \"@/src/utils/get-config\"\nimport { ProjectInfo, getProjectInfo } from \"@/src/utils/get-project-info\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport { spinner } from \"@/src/utils/spinner\"\nimport { Command } from \"commander\"\nimport { z } from \"zod\"\n\nexport const buildOptionsSchema = z.object({\n  cwd: z.string(),\n  registryFile: z.string(),\n  outputDir: z.string(),\n  verbose: z.boolean().optional().default(false),\n})\n\nexport const build = new Command()\n  .name(\"registry:build\")\n  .description(\"builds the registry [EXPERIMENTAL]\")\n  .argument(\"[registry]\", \"path to registry.json file\", \"./registry.json\")\n  .option(\n    \"-o, --output <path>\",\n    \"destination directory for json files\",\n    \"./public/r\"\n  )\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .option(\"-v, --verbose\", \"verbose output\")\n  .action(async (registry: string, opts) => {\n    await buildRegistry({\n      cwd: path.resolve(opts.cwd),\n      registryFile: registry,\n      outputDir: opts.output,\n      verbose: opts.verbose,\n    })\n  })\n\nasync function buildRegistry(opts: z.infer<typeof buildOptionsSchema>) {\n  try {\n    const options = buildOptionsSchema.parse(opts)\n\n    const [{ errors, resolvePaths, config }, projectInfo] = await Promise.all([\n      preFlightRegistryBuild(options),\n      getProjectInfo(options.cwd),\n    ])\n\n    if (errors[ERRORS.MISSING_CONFIG] || !config || !projectInfo) {\n      logger.error(\n        `A ${highlighter.info(\n          \"components.json\"\n        )} file is required to build the registry. Run ${highlighter.info(\n          \"shadcn init\"\n        )} to create one.`\n      )\n      logger.break()\n      process.exit(1)\n    }\n\n    if (errors[ERRORS.BUILD_MISSING_REGISTRY_FILE] || !resolvePaths) {\n      logger.error(\n        `We could not find a registry file at ${highlighter.info(\n          path.resolve(options.cwd, options.registryFile)\n        )}.`\n      )\n      logger.break()\n      process.exit(1)\n    }\n\n    const content = await fs.readFile(resolvePaths.registryFile, \"utf-8\")\n    const result = registrySchema.safeParse(JSON.parse(content))\n\n    if (!result.success) {\n      logger.error(\n        `Invalid registry file found at ${highlighter.info(\n          resolvePaths.registryFile\n        )}.`\n      )\n      logger.break()\n      process.exit(1)\n    }\n\n    const buildSpinner = spinner(\"Building registry...\")\n\n    // Recursively resolve the registry items.\n    const resolvedRegistry = await resolveRegistryItems(\n      result.data,\n      config,\n      projectInfo\n    )\n\n    // Loop through the registry items and remove duplicates files i.e same path.\n    for (const registryItem of resolvedRegistry.items) {\n      // Deduplicate files\n      registryItem.files = registryItem.files?.filter(\n        (file, index, self) =>\n          index === self.findIndex((t) => t.path === file.path)\n      )\n\n      // Deduplicate dependencies\n      if (registryItem.dependencies) {\n        registryItem.dependencies = registryItem.dependencies.filter(\n          (dep, index, self) => index === self.findIndex((d) => d === dep)\n        )\n      }\n    }\n\n    for (const registryItem of resolvedRegistry.items) {\n      if (!registryItem.files) {\n        continue\n      }\n\n      buildSpinner.start(`Building ${registryItem.name}...`)\n\n      // Add the schema to the registry item.\n      registryItem[\"$schema\"] =\n        \"https://ui.shadcn.com/schema/registry-item.json\"\n\n      for (const file of registryItem.files) {\n        const absPath = path.resolve(resolvePaths.cwd, file.path)\n        try {\n          const stat = await fs.stat(absPath)\n          if (!stat.isFile()) {\n            continue\n          }\n          file[\"content\"] = await fs.readFile(absPath, \"utf-8\")\n        } catch (err) {\n          console.error(\"Error reading file in registry build:\", absPath, err)\n          continue\n        }\n      }\n\n      const result = registryItemSchema.safeParse(registryItem)\n      if (!result.success) {\n        logger.error(\n          `Invalid registry item found for ${highlighter.info(\n            registryItem.name\n          )}.`\n        )\n        continue\n      }\n\n      // Write the registry item to the output directory.\n      await fs.writeFile(\n        path.resolve(resolvePaths.outputDir, `${result.data.name}.json`),\n        JSON.stringify(result.data, null, 2)\n      )\n    }\n\n    // Copy registry.json to the output directory.\n    await fs.copyFile(\n      resolvePaths.registryFile,\n      path.resolve(resolvePaths.outputDir, \"registry.json\")\n    )\n\n    buildSpinner.succeed(\"Building registry.\")\n\n    if (options.verbose) {\n      spinner(\n        `The registry has ${highlighter.info(\n          resolvedRegistry.items.length.toString()\n        )} items:`\n      ).succeed()\n      for (const item of resolvedRegistry.items) {\n        logger.log(`  - ${item.name} (${highlighter.info(item.type)})`)\n        for (const file of item.files ?? []) {\n          logger.log(`    - ${file.path}`)\n        }\n      }\n    }\n  } catch (error) {\n    logger.break()\n    handleError(error)\n  }\n}\n\n// This reads the registry and recursively resolves the file imports.\nasync function resolveRegistryItems(\n  registry: z.infer<typeof registrySchema>,\n  config: z.infer<typeof configSchema>,\n  projectInfo: ProjectInfo\n): Promise<z.infer<typeof registrySchema>> {\n  for (const item of registry.items) {\n    if (!item.files?.length) {\n      continue\n    }\n\n    // Process all files in the array instead of just the first one\n    for (const file of item.files) {\n      const results = await recursivelyResolveFileImports(\n        file.path,\n        config,\n        projectInfo\n      )\n\n      // Remove file from results.files\n      results.files = results.files?.filter((f) => f.path !== file.path)\n\n      if (results.files) {\n        item.files.push(...results.files)\n      }\n\n      if (results.dependencies) {\n        item.dependencies = item.dependencies\n          ? item.dependencies.concat(results.dependencies)\n          : results.dependencies\n      }\n    }\n  }\n\n  return registry\n}\n","import path from \"path\"\nimport { buildOptionsSchema } from \"@/src/commands/build\"\nimport * as ERRORS from \"@/src/utils/errors\"\nimport { getConfig } from \"@/src/utils/get-config\"\nimport { highlighter } from \"@/src/utils/highlighter\"\nimport { logger } from \"@/src/utils/logger\"\nimport fs from \"fs-extra\"\nimport { z } from \"zod\"\n\nexport async function preFlightRegistryBuild(\n  options: z.infer<typeof buildOptionsSchema>\n) {\n  const errors: Record<string, boolean> = {}\n\n  const resolvePaths = {\n    cwd: options.cwd,\n    registryFile: path.resolve(options.cwd, options.registryFile),\n    outputDir: path.resolve(options.cwd, options.outputDir),\n  }\n\n  // Ensure registry file exists.\n  if (!fs.existsSync(resolvePaths.registryFile)) {\n    errors[ERRORS.BUILD_MISSING_REGISTRY_FILE] = true\n    return {\n      errors,\n      resolvePaths: null,\n      config: null,\n    }\n  }\n\n  // Check for existing components.json file.\n  if (!fs.existsSync(path.resolve(options.cwd, \"components.json\"))) {\n    errors[ERRORS.MISSING_CONFIG] = true\n    return {\n      errors,\n      resolvePaths: null,\n      config: null,\n    }\n  }\n\n  // Create output directory if it doesn't exist.\n  await fs.mkdir(resolvePaths.outputDir, { recursive: true })\n\n  try {\n    const config = await getConfig(options.cwd)\n\n    return {\n      errors,\n      config: config!,\n      resolvePaths,\n    }\n  } catch (error) {\n    logger.break()\n    logger.error(\n      `An invalid ${highlighter.info(\n        \"components.json\"\n      )} file was found at ${highlighter.info(\n        options.cwd\n      )}.\\nBefore you can build the registry, you must create a valid ${highlighter.info(\n        \"components.json\"\n      )} file by running the ${highlighter.info(\"init\")} command.`\n    )\n    logger.break()\n    process.exit(1)\n  }\n}\n","import { server } from \"@/src/mcp\"\nimport { handleError } from \"@/src/utils/handle-error\"\nimport { logger } from \"@/src/utils/logger\"\nimport { StdioServerTransport } from \"@modelcontextprotocol/sdk/server/stdio.js\"\nimport { Command } from \"commander\"\n\nexport const mcp = new Command()\n  .name(\"registry:mcp\")\n  .description(\"starts the registry MCP server [EXPERIMENTAL]\")\n  .option(\n    \"-c, --cwd <cwd>\",\n    \"the working directory. defaults to the current directory.\",\n    process.cwd()\n  )\n  .action(async () => {\n    try {\n      const transport = new StdioServerTransport()\n      await server.connect(transport)\n    } catch (error) {\n      logger.break()\n      handleError(error)\n    }\n  })\n","#!/usr/bin/env node\nimport { add } from \"@/src/commands/add\"\nimport { build } from \"@/src/commands/build\"\nimport { diff } from \"@/src/commands/diff\"\nimport { info } from \"@/src/commands/info\"\nimport { init } from \"@/src/commands/init\"\nimport { migrate } from \"@/src/commands/migrate\"\nimport { build as registryBuild } from \"@/src/commands/registry/build\"\nimport { mcp as registryMcp } from \"@/src/commands/registry/mcp\"\nimport { Command } from \"commander\"\n\nimport packageJson from \"../package.json\"\n\nprocess.on(\"SIGINT\", () => process.exit(0))\nprocess.on(\"SIGTERM\", () => process.exit(0))\n\nasync function main() {\n  const program = new Command()\n    .name(\"shadcn\")\n    .description(\"add components and dependencies to your project\")\n    .version(\n      packageJson.version || \"1.0.0\",\n      \"-v, --version\",\n      \"display the version number\"\n    )\n\n  program\n    .addCommand(init)\n    .addCommand(add)\n    .addCommand(diff)\n    .addCommand(migrate)\n    .addCommand(info)\n    .addCommand(build)\n\n  // Registry commands\n  program.addCommand(registryBuild).addCommand(registryMcp)\n\n  program.parse()\n}\n\nmain()\n\nexport * from \"./registry/api\"\n","{\n  \"name\": \"shadcn\",\n  \"version\": \"2.10.0\",\n  \"description\": \"Add components to your apps.\",\n  \"publishConfig\": {\n    \"access\": \"public\"\n  },\n  \"license\": \"MIT\",\n  \"author\": {\n    \"name\": \"shadcn\",\n    \"url\": \"https://twitter.com/shadcn\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/shadcn/ui.git\",\n    \"directory\": \"packages/shadcn\"\n  },\n  \"files\": [\n    \"dist\"\n  ],\n  \"keywords\": [\n    \"components\",\n    \"ui\",\n    \"tailwind\",\n    \"radix-ui\",\n    \"shadcn\"\n  ],\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": {\n      \"types\": \"./dist/index.d.ts\",\n      \"default\": \"./dist/index.js\"\n    },\n    \"./registry\": {\n      \"types\": \"./dist/registry/index.d.ts\",\n      \"default\": \"./dist/registry/index.js\"\n    },\n    \"./mcp\": {\n      \"types\": \"./dist/mcp/index.d.ts\",\n      \"default\": \"./dist/mcp/index.js\"\n    }\n  },\n  \"bin\": \"./dist/index.js\",\n  \"scripts\": {\n    \"dev\": \"tsup --watch\",\n    \"build\": \"tsup\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"clean\": \"rimraf dist && rimraf components\",\n    \"start:dev\": \"cross-env REGISTRY_URL=http://localhost:4000/r node dist/index.js\",\n    \"start:prod\": \"cross-env REGISTRY_URL=https://ui.shadcn.com/r node dist/index.js\",\n    \"start\": \"node dist/index.js\",\n    \"format:write\": \"prettier --write \\\"**/*.{ts,tsx,mdx}\\\" --cache\",\n    \"format:check\": \"prettier --check \\\"**/*.{ts,tsx,mdx}\\\" --cache\",\n    \"release\": \"changeset version\",\n    \"pub:beta\": \"pnpm build && pnpm publish --no-git-checks --access public --tag beta\",\n    \"pub:next\": \"pnpm build && pnpm publish --no-git-checks --access public --tag next\",\n    \"pub:release\": \"pnpm build && pnpm publish --access public\",\n    \"test\": \"vitest run\",\n    \"test:dev\": \"REGISTRY_URL=http://localhost:4000/r vitest run\"\n  },\n  \"dependencies\": {\n    \"@antfu/ni\": \"^23.2.0\",\n    \"@babel/core\": \"^7.22.1\",\n    \"@babel/parser\": \"^7.22.6\",\n    \"@babel/plugin-transform-typescript\": \"^7.22.5\",\n    \"@modelcontextprotocol/sdk\": \"^1.10.2\",\n    \"commander\": \"^10.0.0\",\n    \"cosmiconfig\": \"^8.1.3\",\n    \"deepmerge\": \"^4.3.1\",\n    \"diff\": \"^5.1.0\",\n    \"execa\": \"^7.0.0\",\n    \"fast-glob\": \"^3.3.2\",\n    \"fs-extra\": \"^11.1.0\",\n    \"https-proxy-agent\": \"^6.2.0\",\n    \"kleur\": \"^4.1.5\",\n    \"msw\": \"^2.7.1\",\n    \"node-fetch\": \"^3.3.0\",\n    \"ora\": \"^6.1.2\",\n    \"postcss\": \"^8.4.24\",\n    \"prompts\": \"^2.4.2\",\n    \"recast\": \"^0.23.2\",\n    \"stringify-object\": \"^5.0.0\",\n    \"ts-morph\": \"^18.0.0\",\n    \"tsconfig-paths\": \"^4.2.0\",\n    \"zod\": \"^3.20.2\",\n    \"zod-to-json-schema\": \"^3.24.5\"\n  },\n  \"devDependencies\": {\n    \"@types/babel__core\": \"^7.20.1\",\n    \"@types/diff\": \"^5.0.3\",\n    \"@types/fs-extra\": \"^11.0.1\",\n    \"@types/prompts\": \"^2.4.2\",\n    \"@types/stringify-object\": \"^4.0.5\",\n    \"rimraf\": \"^6.0.1\",\n    \"tsup\": \"^6.6.3\",\n    \"type-fest\": \"^3.8.0\",\n    \"typescript\": \"^4.9.3\"\n  }\n}\n"]}